<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>venn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="venn_files/libs/clipboard/clipboard.min.js"></script>
<script src="venn_files/libs/quarto-html/quarto.js"></script>
<script src="venn_files/libs/quarto-html/popper.min.js"></script>
<script src="venn_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="venn_files/libs/quarto-html/anchor.min.js"></script>
<link href="venn_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="venn_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="venn_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="venn_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="venn_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script type="module" src="venn_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="venn_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="4" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3;"><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>viewof vennDiagramWithLegend <span class="op">=</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display: flex; justify-content: space-between;align-items: center;"&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span><span class="fu">draw_venn</span>()<span class="sc">}</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span><span class="fu">drawLegend</span>()<span class="sc">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="14" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 13;"><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>N_ALL <span class="op">=</span> N_A <span class="op">+</span> N_B <span class="op">-</span> nAAndB <span class="op">+</span> nNotOrAB<span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>mutable nAAndB <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>viewof interactiveA <span class="op">=</span> <span class="fu">html</span><span class="vs">`nA:&lt;br/&gt;</span><span class="sc">${</span>numberOfA<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>sliderA<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>viewof interactiveB <span class="op">=</span> <span class="fu">html</span><span class="vs">`nB:&lt;br/&gt;</span><span class="sc">${</span>numberOfB<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>sliderB<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>viewof interactiveNotOrAB <span class="op">=</span> <span class="fu">html</span><span class="vs">`nNotOr(AB): &lt;br/&gt;</span><span class="sc">${</span>numberOfNotOrAB<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>sliderC<span class="sc">}</span><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="23" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 22;"><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  viewof vennDiagramWithLegend<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"update"</span><span class="op">,</span> listener)<span class="op">;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> viewof vennDiagramWithLegend<span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"update"</span><span class="op">,</span> listener))<span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  viewof vennDiagramWithLegend<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"update"</span>))<span class="op">;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="32" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 31;"><span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">drawLegend</span>(){</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legend <span class="op">=</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div id="legend"&gt;</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div id="box" style="display:flex; flex-direction: column;"&gt;</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display:flex;align-items: center" &gt;</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="width:30px;height:30px;border-radius:3px; background-color: rgba(218, 218, 217, 0.57); cursor:pointer;border:3px solid transparent;" id="div-omega"&gt;&lt;/div&gt;</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="padding: 0px 7px;"&gt;Ω&lt;/p&gt;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display:flex;align-items: center" &gt;</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="width:30px;height:30px;border-radius:3px;background-color: rgba(31, 119, 180, 0.3); cursor:pointer;border:3px solid transparent;" id="div-A"&gt;&lt;/div&gt;</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="padding: 0px 7px;"&gt;A&lt;/p&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display:flex;align-items: center" &gt;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="width:30px;height:30px;border-radius:3px;background-color: rgba(255, 127, 14, 0.3); cursor:pointer;border:3px solid transparent;" id="div-B"&gt;&lt;/div&gt;</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="padding: 0px 7px;"&gt;B&lt;/p&gt;</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display:flex;align-items: center" &gt;</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="width:30px;height:30px;border-radius:3px;background-color: rgba(143, 123, 97, 0.3); cursor:pointer;border:3px solid transparent;" id="div-A-intersect-B"&gt;&lt;/div&gt;</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="padding: 0px 7px;"&gt;A ∩ B&lt;/p&gt;</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display:flex;align-items: center" &gt;</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="width:30px;height:30px;border-radius:3px;</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="vs">background: linear-gradient(90deg, rgba(31,119,180,0.3) 0%, rgba(255,127,14,0.3) 100%); cursor:pointer;border:3px solid transparent;" id="div-A-union-B"&gt;&lt;/div&gt;</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="padding: 0px 7px;"&gt;A ∪ B&lt;/p&gt;</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display:flex;align-items: center" &gt;</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="width:30px;height:30px;border-radius:3px;background-color: rgba(31, 119, 180, 0.3); cursor:pointer;border:3px solid transparent;" id="div-A-and-not-B"&gt;&lt;/div&gt;</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="padding: 0px 7px;"&gt;A ∩ B'&lt;/p&gt;</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display:flex;align-items: center" &gt;</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="width:30px;height:30px;border-radius:3px;background-color: rgba(255, 127, 14, 0.3); cursor:pointer;border:3px solid transparent;" id="div-not-A-and-B"&gt;&lt;/div&gt;</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="padding: 0px 7px;"&gt;B ∩ A'&lt;/p&gt;</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display:flex;align-items: center" &gt;</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="width:30px;height:30px;border-radius:3px; background-color: rgba(218, 218, 217, 0.57); cursor:pointer;border:3px solid transparent;" id="div-not-A-intersect-not-B"&gt;&lt;/div&gt;</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="padding: 0px 7px;"&gt;A' ∩ B'&lt;/p&gt;</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/div&gt;</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> legend<span class="op">;</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="79" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 78;"><span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">listener</span>() {</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> unionTemp <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'union-temp'</span>)<span class="op">;</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legendA <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'div-A'</span>)<span class="op">;</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> circleA <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'circle-A'</span>)<span class="op">;</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legendB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'div-B'</span>)<span class="op">;</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> circleB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'circle-B'</span>)<span class="op">;</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legendAAndB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"div-A-intersect-B"</span>)<span class="op">;</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> pathAAndB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"intersection-A-B"</span>)<span class="op">;</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legendNotAIntersectNotB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"div-not-A-intersect-not-B"</span>)<span class="op">;</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legendOmega <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"div-omega"</span>)<span class="op">;</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legendAIntersectNotB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"div-A-and-not-B"</span>)<span class="op">;</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legendNotAIntersectB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"div-not-A-and-B"</span>)<span class="op">;</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> venn <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"venn-id"</span>)<span class="op">;</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legendAUnionB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"div-A-union-B"</span>)<span class="op">;</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> pathAUnionB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"union-all"</span>)<span class="op">;</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> rightPathAAndB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"intersection-right-A-B"</span>)<span class="op">;</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> leftPathAAndB <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"intersection-left-A-B"</span>)<span class="op">;</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> circleBColor <span class="op">=</span> <span class="st">'rgb(255, 127, 14)'</span><span class="op">;</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> pathAAndBColor <span class="op">=</span> <span class="st">'#8f7b614d'</span><span class="op">;</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> legendDataInJson <span class="op">=</span> {</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A'</span><span class="op">:</span> <span class="st">'A'</span><span class="op">,</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B'</span><span class="op">:</span> <span class="st">'B'</span><span class="op">,</span></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A_AND_B'</span><span class="op">:</span> <span class="st">'A_AND_B'</span><span class="op">,</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A_UNION_B'</span><span class="op">:</span> <span class="st">'A_UNION_B'</span><span class="op">,</span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>    <span class="st">'NOT_A_AND_NOT_B'</span><span class="op">:</span> <span class="st">'NOT_A_AND_NOT_B'</span><span class="op">,</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A_AND_NOT_B'</span><span class="op">:</span> <span class="st">'A_AND_NOT_B'</span><span class="op">,</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="st">'NOT_A_AND_B'</span><span class="op">:</span> <span class="st">'NOT_A_AND_B'</span><span class="op">,</span></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    <span class="st">'OMEGA'</span><span class="op">:</span> <span class="st">'OMEGA'</span><span class="op">,</span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>    <span class="st">'NONE'</span><span class="op">:</span> <span class="st">''</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> selectedLegend <span class="op">=</span> <span class="st">''</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">moveToFront</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectAEventListener</span>()<span class="op">;</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectBEventListener</span>()<span class="op">;</span></span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectOmegaEventListener</span>()<span class="op">;</span></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectNotAAndNotBEventListener</span>()<span class="op">;</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectAAndNotBEventListener</span>()<span class="op">;</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectNotAAndBEventListener</span>()<span class="op">;</span></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectAAndBEventListener</span>()<span class="op">;</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectAUnionBEventListener</span>()<span class="op">;</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">isInsideBigCircle</span>(currentCircle){</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(N_A <span class="op">==</span> nAAndB <span class="op">&amp;&amp;</span> currentCircle <span class="op">==</span> <span class="st">'A'</span>) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(N_B <span class="op">==</span> nAAndB <span class="op">&amp;&amp;</span> currentCircle <span class="op">==</span> <span class="st">'B'</span>) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">selectAEventListener</span>(){</span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>    legendA<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectA</span>()<span class="op">;</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateLegend</span>(legendA<span class="op">,</span> <span class="st">'rgba(31, 119, 180, 1)'</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>    legendA<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectA</span>()<span class="op">;</span></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateLegend</span>(legendA<span class="op">,</span> <span class="st">'rgba(31, 119, 180, 0.3)'</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>    legendA<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(selectedLegend <span class="op">==</span> legendDataInJson[<span class="st">'A'</span>]){</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NONE'</span>]<span class="op">;</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectA</span>()<span class="op">;</span></span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateLegend</span>(legendA<span class="op">,</span> <span class="st">'rgba(31, 119, 180, 0.3)'</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>          <span class="fu">handleSelectA</span>()<span class="op">;</span></span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>          <span class="fu">updateLegend</span>(legendA<span class="op">,</span> <span class="st">'rgba(31, 119, 180, 1)'</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>          selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'A'</span>]<span class="op">;</span></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>   <span class="kw">function</span> <span class="fu">selectBEventListener</span>(){</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>    legendB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectB</span>()<span class="op">;</span></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateLegend</span>(legendB<span class="op">,</span> <span class="st">'rgba(255, 127, 14, 1)'</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>    legendB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectB</span>()<span class="op">;</span></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateLegend</span>(legendB<span class="op">,</span> <span class="st">'rgba(255, 127, 14, 0.3)'</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>     legendB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(selectedLegend <span class="op">==</span> legendDataInJson[<span class="st">'B'</span>]){</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NONE'</span>]<span class="op">;</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectB</span>()<span class="op">;</span></span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateLegend</span>(legendB<span class="op">,</span> <span class="st">'rgba(255, 127, 14, 0.3)'</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'B'</span>]<span class="op">;</span></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectB</span>()<span class="op">;</span></span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateLegend</span>(legendB<span class="op">,</span> <span class="st">'rgba(255, 127, 14, 1)'</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">isNotClickedLegend</span>(){</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> selectedLegend <span class="op">===</span> <span class="st">''</span></span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleSelectA</span>(){</span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(circleA)</span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showCircle</span>(circleA)</span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hidePathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hidePathAndLabel</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleDeselectA</span>(){</span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showPathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showPathAndLabel</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>      <span class="fu">resetCircle</span>(circleA)<span class="op">;</span></span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleSelectB</span>(){</span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(circleB)</span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hidePathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hidePathAndLabel</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleDeselectB</span>(){</span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showPathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showPathAndLabel</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>      <span class="fu">resetCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">selectAAndBEventListener</span>(){</span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a>    legendAAndB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectAAndB</span>()<span class="op">;</span></span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a>    legendAAndB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectAAndB</span>()<span class="op">;</span></span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>    legendAAndB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(selectedLegend <span class="op">==</span> legendDataInJson[<span class="st">'A_AND_B'</span>]){</span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NONE'</span>]<span class="op">;</span></span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectAAndB</span>()<span class="op">;</span></span>
<span id="cb5-232"><a href="#cb5-232" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-233"><a href="#cb5-233" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'A_AND_B'</span>]<span class="op">;</span></span>
<span id="cb5-234"><a href="#cb5-234" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectAAndB</span>()<span class="op">;</span></span>
<span id="cb5-235"><a href="#cb5-235" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-236"><a href="#cb5-236" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-237"><a href="#cb5-237" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-238"><a href="#cb5-238" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-239"><a href="#cb5-239" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleSelectAAndB</span>(){</span>
<span id="cb5-240"><a href="#cb5-240" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-241"><a href="#cb5-241" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectA</span>()</span>
<span id="cb5-242"><a href="#cb5-242" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectB</span>()</span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-246"><a href="#cb5-246" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-247"><a href="#cb5-247" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(pathAAndB)</span>
<span id="cb5-248"><a href="#cb5-248" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hidePathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-249"><a href="#cb5-249" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hidePathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-250"><a href="#cb5-250" aria-hidden="true" tabindex="-1"></a>      pathAAndB<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">8</span>)<span class="op">;</span></span>
<span id="cb5-251"><a href="#cb5-251" aria-hidden="true" tabindex="-1"></a>      pathAAndB<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"fill"</span><span class="op">,</span> pathAAndBColor)<span class="op">;</span></span>
<span id="cb5-252"><a href="#cb5-252" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateStroke</span>(pathAAndB<span class="op">,</span> <span class="st">"white"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-253"><a href="#cb5-253" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-254"><a href="#cb5-254" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb5-255"><a href="#cb5-255" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendAAndB<span class="op">,</span> <span class="st">'rgba(143, 123, 97, 1)'</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb5-256"><a href="#cb5-256" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-257"><a href="#cb5-257" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-258"><a href="#cb5-258" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-259"><a href="#cb5-259" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleDeselectAAndB</span>(){</span>
<span id="cb5-260"><a href="#cb5-260" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-261"><a href="#cb5-261" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectA</span>()</span>
<span id="cb5-262"><a href="#cb5-262" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-263"><a href="#cb5-263" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-264"><a href="#cb5-264" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectB</span>()</span>
<span id="cb5-265"><a href="#cb5-265" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-266"><a href="#cb5-266" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-267"><a href="#cb5-267" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-268"><a href="#cb5-268" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-269"><a href="#cb5-269" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetIntersection</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-270"><a href="#cb5-270" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-271"><a href="#cb5-271" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendAAndB<span class="op">,</span> <span class="st">'rgba(143, 123, 97, 0.3)'</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb5-272"><a href="#cb5-272" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-273"><a href="#cb5-273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-274"><a href="#cb5-274" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">selectAUnionBEventListener</span>(){</span>
<span id="cb5-275"><a href="#cb5-275" aria-hidden="true" tabindex="-1"></a>    legendAUnionB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-276"><a href="#cb5-276" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-277"><a href="#cb5-277" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectAUnionB</span>()<span class="op">;</span></span>
<span id="cb5-278"><a href="#cb5-278" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-279"><a href="#cb5-279" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-280"><a href="#cb5-280" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-281"><a href="#cb5-281" aria-hidden="true" tabindex="-1"></a>    legendAUnionB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-282"><a href="#cb5-282" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-283"><a href="#cb5-283" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectAUnionB</span>()<span class="op">;</span></span>
<span id="cb5-284"><a href="#cb5-284" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-285"><a href="#cb5-285" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-286"><a href="#cb5-286" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-287"><a href="#cb5-287" aria-hidden="true" tabindex="-1"></a>    legendAUnionB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-288"><a href="#cb5-288" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(selectedLegend <span class="op">==</span> legendDataInJson[<span class="st">'A_UNION_B'</span>]){</span>
<span id="cb5-289"><a href="#cb5-289" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NONE'</span>]<span class="op">;</span></span>
<span id="cb5-290"><a href="#cb5-290" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectAUnionB</span>()<span class="op">;</span></span>
<span id="cb5-291"><a href="#cb5-291" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-292"><a href="#cb5-292" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'A_UNION_B'</span>]<span class="op">;</span></span>
<span id="cb5-293"><a href="#cb5-293" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectAUnionB</span>()<span class="op">;</span></span>
<span id="cb5-294"><a href="#cb5-294" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-295"><a href="#cb5-295" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-296"><a href="#cb5-296" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-297"><a href="#cb5-297" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-298"><a href="#cb5-298" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleSelectAUnionB</span>(){</span>
<span id="cb5-299"><a href="#cb5-299" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-300"><a href="#cb5-300" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectB</span>()<span class="op">;</span></span>
<span id="cb5-301"><a href="#cb5-301" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-302"><a href="#cb5-302" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectA</span>()<span class="op">;</span></span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showCircle</span>(circleA)<span class="op">;</span></span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(circleB)<span class="op">;</span></span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateColor</span>(pathAAndB<span class="op">,</span> circleBColor<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateStroke</span>(pathAAndB<span class="op">,</span> circleBColor<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true" tabindex="-1"></a>    legendAUnionB<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"background"</span><span class="op">,</span> <span class="st">'linear-gradient(90deg, rgba(31,119,180,1) 0%, rgba(255,127,14,1) 100%)'</span>)<span class="op">;</span></span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleDeselectAUnionB</span>(){</span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectB</span>()<span class="op">;</span></span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectA</span>()<span class="op">;</span></span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetCircle</span>(circleA)<span class="op">;</span></span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetIntersection</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true" tabindex="-1"></a>    legendAUnionB<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"background"</span><span class="op">,</span> <span class="st">'linear-gradient(90deg, rgba(31,119,180,0.3) 0%, rgba(255,127,14,0.3) 100%)'</span>)<span class="op">;</span></span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">selectNotAAndNotBEventListener</span>(){</span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true" tabindex="-1"></a>    legendNotAIntersectNotB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectNotAIntersectNotB</span>()<span class="op">;</span></span>
<span id="cb5-335"><a href="#cb5-335" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-336"><a href="#cb5-336" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-337"><a href="#cb5-337" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-338"><a href="#cb5-338" aria-hidden="true" tabindex="-1"></a>    legendNotAIntersectNotB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-339"><a href="#cb5-339" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-340"><a href="#cb5-340" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectNotAIntersectNotB</span>()<span class="op">;</span></span>
<span id="cb5-341"><a href="#cb5-341" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-342"><a href="#cb5-342" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-343"><a href="#cb5-343" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-344"><a href="#cb5-344" aria-hidden="true" tabindex="-1"></a>    legendNotAIntersectNotB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-345"><a href="#cb5-345" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(selectedLegend <span class="op">==</span> legendDataInJson[<span class="st">'NOT_A_AND_NOT_B'</span>]){</span>
<span id="cb5-346"><a href="#cb5-346" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NONE'</span>]<span class="op">;</span></span>
<span id="cb5-347"><a href="#cb5-347" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectNotAIntersectNotB</span>()<span class="op">;</span></span>
<span id="cb5-348"><a href="#cb5-348" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-349"><a href="#cb5-349" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NOT_A_AND_NOT_B'</span>]<span class="op">;</span></span>
<span id="cb5-350"><a href="#cb5-350" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectNotAIntersectNotB</span>()<span class="op">;</span></span>
<span id="cb5-351"><a href="#cb5-351" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-352"><a href="#cb5-352" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-353"><a href="#cb5-353" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleSelectNotAIntersectNotB</span>(){</span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hidePathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true" tabindex="-1"></a>        <span class="fu">moveToFront</span>(circleB)<span class="op">;</span></span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateStroke</span>(circleB<span class="op">,</span> <span class="st">"white"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hidePathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true" tabindex="-1"></a>        <span class="fu">moveToFront</span>(circleA)<span class="op">;</span></span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateStroke</span>(circleA<span class="op">,</span> <span class="st">"white"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateStroke</span>(circleA<span class="op">,</span> <span class="st">"white"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateStroke</span>(circleB<span class="op">,</span> <span class="st">"white"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateStroke</span>(pathAAndB<span class="op">,</span> <span class="st">"#8f7b61"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true" tabindex="-1"></a>      pathAAndB<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true" tabindex="-1"></a>      venn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">'1px ridge white'</span>)<span class="op">;</span></span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true" tabindex="-1"></a>      venn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"background-color"</span><span class="op">,</span> <span class="st">'#9a9a9aba'</span>)<span class="op">;</span></span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendNotAIntersectNotB<span class="op">,</span> <span class="st">'rgba(80, 80, 80, 1)'</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleDeselectNotAIntersectNotB</span>(){</span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetCircle</span>(circleB)</span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetCircle</span>(circleA)</span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true" tabindex="-1"></a>      <span class="fu">resetCircle</span>(circleA)</span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true" tabindex="-1"></a>      <span class="fu">resetCircle</span>(circleB)</span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true" tabindex="-1"></a>      venn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">'1px solid salmon'</span>)<span class="op">;</span></span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true" tabindex="-1"></a>      venn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"background-color"</span><span class="op">,</span> <span class="st">'#dadad991'</span>)<span class="op">;</span></span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true" tabindex="-1"></a>      pathAAndB<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"transparent"</span>)<span class="op">;</span></span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendNotAIntersectNotB<span class="op">,</span> <span class="st">'rgba(218, 218, 217, 0.57)'</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-397"><a href="#cb5-397" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-398"><a href="#cb5-398" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">selectAAndNotBEventListener</span>(){</span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true" tabindex="-1"></a>    legendAIntersectNotB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectAIntersectNotB</span>()<span class="op">;</span></span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true" tabindex="-1"></a>    legendAIntersectNotB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectAIntersectNotB</span>()<span class="op">;</span></span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true" tabindex="-1"></a>      }  </span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true" tabindex="-1"></a>    legendAIntersectNotB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(selectedLegend <span class="op">==</span> legendDataInJson[<span class="st">'A_AND_NOT_B'</span>]){</span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NONE'</span>]<span class="op">;</span></span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectAIntersectNotB</span>()<span class="op">;</span></span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'A_AND_NOT_B'</span>]<span class="op">;</span></span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectAIntersectNotB</span>()<span class="op">;</span></span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleSelectAIntersectNotB</span>(){</span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-424"><a href="#cb5-424" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hidePathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-425"><a href="#cb5-425" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hidePathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hidePathAndLabel</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-428"><a href="#cb5-428" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-429"><a href="#cb5-429" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showCircle</span>(circleA)<span class="op">;</span></span>
<span id="cb5-430"><a href="#cb5-430" aria-hidden="true" tabindex="-1"></a>        <span class="fu">moveToFront</span>(circleB)</span>
<span id="cb5-431"><a href="#cb5-431" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-432"><a href="#cb5-432" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-433"><a href="#cb5-433" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-434"><a href="#cb5-434" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showCircle</span>(circleA)<span class="op">;</span></span>
<span id="cb5-435"><a href="#cb5-435" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-436"><a href="#cb5-436" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(rightPathAAndB)<span class="op">;</span></span>
<span id="cb5-437"><a href="#cb5-437" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hidePathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-438"><a href="#cb5-438" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateColor</span>(pathAAndB<span class="op">,</span> <span class="st">"#dadadc"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-439"><a href="#cb5-439" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateStroke</span>(pathAAndB<span class="op">,</span> <span class="st">"white"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-440"><a href="#cb5-440" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateStroke</span>(rightPathAAndB<span class="op">,</span> <span class="st">"#dadadc"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-441"><a href="#cb5-441" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateColor</span>(rightPathAAndB<span class="op">,</span> <span class="st">"#dadadc"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-442"><a href="#cb5-442" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-443"><a href="#cb5-443" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendAIntersectNotB<span class="op">,</span> <span class="st">'rgba(31, 119, 180, 1)'</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb5-444"><a href="#cb5-444" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-445"><a href="#cb5-445" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-446"><a href="#cb5-446" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleDeselectAIntersectNotB</span>(){</span>
<span id="cb5-447"><a href="#cb5-447" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-448"><a href="#cb5-448" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-449"><a href="#cb5-449" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-450"><a href="#cb5-450" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-451"><a href="#cb5-451" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-452"><a href="#cb5-452" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-453"><a href="#cb5-453" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-454"><a href="#cb5-454" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetCircle</span>(circleA)<span class="op">;</span></span>
<span id="cb5-455"><a href="#cb5-455" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-456"><a href="#cb5-456" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-457"><a href="#cb5-457" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetCircle</span>(circleA)</span>
<span id="cb5-458"><a href="#cb5-458" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-459"><a href="#cb5-459" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetIntersection</span>(rightPathAAndB)<span class="op">;</span></span>
<span id="cb5-460"><a href="#cb5-460" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetIntersection</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-461"><a href="#cb5-461" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-462"><a href="#cb5-462" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendAIntersectNotB<span class="op">,</span> <span class="st">'rgba(31, 119, 180, 0.3)'</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb5-463"><a href="#cb5-463" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-464"><a href="#cb5-464" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-465"><a href="#cb5-465" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">selectNotAAndBEventListener</span>(){</span>
<span id="cb5-466"><a href="#cb5-466" aria-hidden="true" tabindex="-1"></a>    legendNotAIntersectB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-467"><a href="#cb5-467" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-468"><a href="#cb5-468" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectNotAIntersectB</span>()<span class="op">;</span></span>
<span id="cb5-469"><a href="#cb5-469" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-470"><a href="#cb5-470" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-471"><a href="#cb5-471" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-472"><a href="#cb5-472" aria-hidden="true" tabindex="-1"></a>    legendNotAIntersectB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-473"><a href="#cb5-473" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-474"><a href="#cb5-474" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectNotAIntersectB</span>()<span class="op">;</span></span>
<span id="cb5-475"><a href="#cb5-475" aria-hidden="true" tabindex="-1"></a>      }  </span>
<span id="cb5-476"><a href="#cb5-476" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-477"><a href="#cb5-477" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-478"><a href="#cb5-478" aria-hidden="true" tabindex="-1"></a>    legendNotAIntersectB<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-479"><a href="#cb5-479" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(selectedLegend <span class="op">==</span> legendDataInJson[<span class="st">'NOT_A_AND_B'</span>]){</span>
<span id="cb5-480"><a href="#cb5-480" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NONE'</span>]<span class="op">;</span></span>
<span id="cb5-481"><a href="#cb5-481" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectNotAIntersectB</span>()<span class="op">;</span></span>
<span id="cb5-482"><a href="#cb5-482" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-483"><a href="#cb5-483" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NOT_A_AND_B'</span>]<span class="op">;</span></span>
<span id="cb5-484"><a href="#cb5-484" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectNotAIntersectB</span>()<span class="op">;</span></span>
<span id="cb5-485"><a href="#cb5-485" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-486"><a href="#cb5-486" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-487"><a href="#cb5-487" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb5-488"><a href="#cb5-488" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-489"><a href="#cb5-489" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleSelectNotAIntersectB</span>(){</span>
<span id="cb5-490"><a href="#cb5-490" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-491"><a href="#cb5-491" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hidePathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-492"><a href="#cb5-492" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hidePathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-493"><a href="#cb5-493" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hidePathAndLabel</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-494"><a href="#cb5-494" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-495"><a href="#cb5-495" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-496"><a href="#cb5-496" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-497"><a href="#cb5-497" aria-hidden="true" tabindex="-1"></a>        <span class="fu">moveToFront</span>(circleA)</span>
<span id="cb5-498"><a href="#cb5-498" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showCircle</span>(circleA)<span class="op">;</span></span>
<span id="cb5-499"><a href="#cb5-499" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-500"><a href="#cb5-500" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-501"><a href="#cb5-501" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-502"><a href="#cb5-502" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-503"><a href="#cb5-503" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveToFront</span>(leftPathAAndB)<span class="op">;</span></span>
<span id="cb5-504"><a href="#cb5-504" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hidePathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-505"><a href="#cb5-505" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateColor</span>(pathAAndB<span class="op">,</span> <span class="st">"#dadadc"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-506"><a href="#cb5-506" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateColor</span>(leftPathAAndB<span class="op">,</span> <span class="st">"#dadadc"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-507"><a href="#cb5-507" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateStroke</span>(pathAAndB<span class="op">,</span> <span class="st">"white"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-508"><a href="#cb5-508" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateStroke</span>(leftPathAAndB<span class="op">,</span> <span class="st">"#dadadc"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-509"><a href="#cb5-509" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-510"><a href="#cb5-510" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendNotAIntersectB<span class="op">,</span> <span class="st">'rgba(255, 127, 14, 1)'</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb5-511"><a href="#cb5-511" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb5-512"><a href="#cb5-512" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-513"><a href="#cb5-513" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleDeselectNotAIntersectB</span>(){</span>
<span id="cb5-514"><a href="#cb5-514" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'B'</span>)){</span>
<span id="cb5-515"><a href="#cb5-515" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-516"><a href="#cb5-516" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(circleB)<span class="op">;</span></span>
<span id="cb5-517"><a href="#cb5-517" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showPathAndLabel</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-518"><a href="#cb5-518" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-519"><a href="#cb5-519" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isInsideBigCircle</span>(<span class="st">'A'</span>)){</span>
<span id="cb5-520"><a href="#cb5-520" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-521"><a href="#cb5-521" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resetCircle</span>(circleA)<span class="op">;</span></span>
<span id="cb5-522"><a href="#cb5-522" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-523"><a href="#cb5-523" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb5-524"><a href="#cb5-524" aria-hidden="true" tabindex="-1"></a>      <span class="fu">resetCircle</span>(circleB)<span class="op">;</span></span>
<span id="cb5-525"><a href="#cb5-525" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showPathAndLabel</span>(circleA)<span class="op">;</span></span>
<span id="cb5-526"><a href="#cb5-526" aria-hidden="true" tabindex="-1"></a>      <span class="fu">resetIntersection</span>(leftPathAAndB)<span class="op">;</span></span>
<span id="cb5-527"><a href="#cb5-527" aria-hidden="true" tabindex="-1"></a>      <span class="fu">resetIntersection</span>(pathAAndB)<span class="op">;</span></span>
<span id="cb5-528"><a href="#cb5-528" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-529"><a href="#cb5-529" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendNotAIntersectB<span class="op">,</span> <span class="st">'rgba(255, 127, 14, 0.3)'</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb5-530"><a href="#cb5-530" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-531"><a href="#cb5-531" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-532"><a href="#cb5-532" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">selectOmegaEventListener</span>(){</span>
<span id="cb5-533"><a href="#cb5-533" aria-hidden="true" tabindex="-1"></a>    legendOmega<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-534"><a href="#cb5-534" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-535"><a href="#cb5-535" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectOmega</span>()<span class="op">;</span></span>
<span id="cb5-536"><a href="#cb5-536" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-537"><a href="#cb5-537" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-538"><a href="#cb5-538" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-539"><a href="#cb5-539" aria-hidden="true" tabindex="-1"></a>    legendOmega<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-540"><a href="#cb5-540" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-541"><a href="#cb5-541" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectOmega</span>()<span class="op">;</span></span>
<span id="cb5-542"><a href="#cb5-542" aria-hidden="true" tabindex="-1"></a>      }  </span>
<span id="cb5-543"><a href="#cb5-543" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-544"><a href="#cb5-544" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-545"><a href="#cb5-545" aria-hidden="true" tabindex="-1"></a>    legendOmega<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-546"><a href="#cb5-546" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(selectedLegend <span class="op">==</span> legendDataInJson[<span class="st">'OMEGA'</span>]){</span>
<span id="cb5-547"><a href="#cb5-547" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'NONE'</span>]<span class="op">;</span></span>
<span id="cb5-548"><a href="#cb5-548" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleDeselectOmega</span>()<span class="op">;</span></span>
<span id="cb5-549"><a href="#cb5-549" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">isNotClickedLegend</span>()){</span>
<span id="cb5-550"><a href="#cb5-550" aria-hidden="true" tabindex="-1"></a>        selectedLegend <span class="op">=</span> legendDataInJson[<span class="st">'OMEGA'</span>]<span class="op">;</span></span>
<span id="cb5-551"><a href="#cb5-551" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handleSelectOmega</span>()<span class="op">;</span></span>
<span id="cb5-552"><a href="#cb5-552" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-553"><a href="#cb5-553" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-554"><a href="#cb5-554" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb5-555"><a href="#cb5-555" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-556"><a href="#cb5-556" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleSelectOmega</span>(){</span>
<span id="cb5-557"><a href="#cb5-557" aria-hidden="true" tabindex="-1"></a>      <span class="fu">changeParentNodeOpacity</span>(circleA<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">parentNode</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb5-558"><a href="#cb5-558" aria-hidden="true" tabindex="-1"></a>      venn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">'1px ridge white'</span>)<span class="op">;</span></span>
<span id="cb5-559"><a href="#cb5-559" aria-hidden="true" tabindex="-1"></a>      venn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"background-color"</span><span class="op">,</span> <span class="st">'#dcdcdc'</span>)<span class="op">;</span></span>
<span id="cb5-560"><a href="#cb5-560" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendOmega<span class="op">,</span> <span class="st">'rgba(80, 80, 80, 1)'</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb5-561"><a href="#cb5-561" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-562"><a href="#cb5-562" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-563"><a href="#cb5-563" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">handleDeselectOmega</span>(){</span>
<span id="cb5-564"><a href="#cb5-564" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showPathAndLabel</span>(circleA<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">parentNode</span>)<span class="op">;</span></span>
<span id="cb5-565"><a href="#cb5-565" aria-hidden="true" tabindex="-1"></a>      venn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">'1px solid salmon'</span>)<span class="op">;</span></span>
<span id="cb5-566"><a href="#cb5-566" aria-hidden="true" tabindex="-1"></a>      venn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"background-color"</span><span class="op">,</span> <span class="st">'#dadad991'</span>)<span class="op">;</span></span>
<span id="cb5-567"><a href="#cb5-567" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLegend</span>(legendOmega<span class="op">,</span> <span class="st">'rgba(218, 218, 217, 0.57)'</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb5-568"><a href="#cb5-568" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-569"><a href="#cb5-569" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-570"><a href="#cb5-570" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateLegend</span>(selectedNode<span class="op">,</span> color<span class="op">,</span> isSelect){</span>
<span id="cb5-571"><a href="#cb5-571" aria-hidden="true" tabindex="-1"></a>    selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"background-color"</span><span class="op">,</span> color)<span class="op">;</span></span>
<span id="cb5-572"><a href="#cb5-572" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(isSelect){</span>
<span id="cb5-573"><a href="#cb5-573" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">'3px outset white'</span>)<span class="op">;</span></span>
<span id="cb5-574"><a href="#cb5-574" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb5-575"><a href="#cb5-575" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">'3px solid transparent'</span>)<span class="op">;</span></span>
<span id="cb5-576"><a href="#cb5-576" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-577"><a href="#cb5-577" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-578"><a href="#cb5-578" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-579"><a href="#cb5-579" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateColor</span>(selectedNote<span class="op">,</span> color<span class="op">,</span> opacity){</span>
<span id="cb5-580"><a href="#cb5-580" aria-hidden="true" tabindex="-1"></a>      selectedNote<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"fill"</span><span class="op">,</span> color)<span class="op">;</span></span>
<span id="cb5-581"><a href="#cb5-581" aria-hidden="true" tabindex="-1"></a>      selectedNote<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> opacity)<span class="op">;</span></span>
<span id="cb5-582"><a href="#cb5-582" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-583"><a href="#cb5-583" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-584"><a href="#cb5-584" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-585"><a href="#cb5-585" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateStroke</span>(selectedNote<span class="op">,</span> color<span class="op">,</span> opacity){</span>
<span id="cb5-586"><a href="#cb5-586" aria-hidden="true" tabindex="-1"></a>      selectedNote<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"stroke"</span><span class="op">,</span> color)<span class="op">;</span></span>
<span id="cb5-587"><a href="#cb5-587" aria-hidden="true" tabindex="-1"></a>      selectedNote<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> opacity)<span class="op">;</span></span>
<span id="cb5-588"><a href="#cb5-588" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-589"><a href="#cb5-589" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-590"><a href="#cb5-590" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">showCircle</span>(selectedNode){</span>
<span id="cb5-591"><a href="#cb5-591" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="fl">0.8</span>)<span class="op">;</span></span>
<span id="cb5-592"><a href="#cb5-592" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb5-593"><a href="#cb5-593" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-594"><a href="#cb5-594" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-595"><a href="#cb5-595" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-596"><a href="#cb5-596" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">resetCircle</span>(selectedNode){</span>
<span id="cb5-597"><a href="#cb5-597" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb5-598"><a href="#cb5-598" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb5-599"><a href="#cb5-599" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-600"><a href="#cb5-600" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-601"><a href="#cb5-601" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">resetIntersection</span>(selectedNode){</span>
<span id="cb5-602"><a href="#cb5-602" aria-hidden="true" tabindex="-1"></a>    selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb5-603"><a href="#cb5-603" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb5-604"><a href="#cb5-604" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb5-605"><a href="#cb5-605" aria-hidden="true" tabindex="-1"></a>      selectedNode<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb5-606"><a href="#cb5-606" aria-hidden="true" tabindex="-1"></a>    <span class="fu">moveToFront</span>(circleB)<span class="op">;</span></span>
<span id="cb5-607"><a href="#cb5-607" aria-hidden="true" tabindex="-1"></a>    <span class="fu">moveToFront</span>(circleA)<span class="op">;</span></span>
<span id="cb5-608"><a href="#cb5-608" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-609"><a href="#cb5-609" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-610"><a href="#cb5-610" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">showPathAndLabel</span>(selectedNote) {</span>
<span id="cb5-611"><a href="#cb5-611" aria-hidden="true" tabindex="-1"></a>     <span class="fu">changeParentNodeOpacity</span>(selectedNote<span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb5-612"><a href="#cb5-612" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-613"><a href="#cb5-613" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-614"><a href="#cb5-614" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">hidePathAndLabel</span>(selectedNote) {</span>
<span id="cb5-615"><a href="#cb5-615" aria-hidden="true" tabindex="-1"></a>     <span class="fu">changeParentNodeOpacity</span>(selectedNote<span class="op">,</span> <span class="fl">0.2</span>)</span>
<span id="cb5-616"><a href="#cb5-616" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-617"><a href="#cb5-617" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-618"><a href="#cb5-618" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">changeParentNodeOpacity</span>(selectedNote<span class="op">,</span> opacity) {</span>
<span id="cb5-619"><a href="#cb5-619" aria-hidden="true" tabindex="-1"></a>     selectedNote<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="fu">setProperty</span>(<span class="st">"opacity"</span><span class="op">,</span> opacity)<span class="op">;</span></span>
<span id="cb5-620"><a href="#cb5-620" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-621"><a href="#cb5-621" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-622"><a href="#cb5-622" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveToFront</span>(selectedNote) {</span>
<span id="cb5-623"><a href="#cb5-623" aria-hidden="true" tabindex="-1"></a>     selectedNote<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="fu">appendChild</span>(selectedNote<span class="op">.</span><span class="at">parentNode</span>)<span class="op">;</span></span>
<span id="cb5-624"><a href="#cb5-624" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-625"><a href="#cb5-625" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-626"><a href="#cb5-626" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="634" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 633;"><span id="cb6-634"><a href="#cb6-634" aria-hidden="true" tabindex="-1"></a>S_MAX <span class="op">=</span> <span class="dv">500</span> <span class="op">*</span> <span class="dv">500</span></span>
<span id="cb6-635"><a href="#cb6-635" aria-hidden="true" tabindex="-1"></a>sA <span class="op">=</span> N_A <span class="op">/</span> N_ALL <span class="op">*</span> S_MAX</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="640" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 639;"><span id="cb7-640"><a href="#cb7-640" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">draw_venn</span>() {</span>
<span id="cb7-641"><a href="#cb7-641" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> node <span class="op">=</span> DOM<span class="op">.</span><span class="fu">svg</span>(hRect<span class="op">,</span> wRect)<span class="op">;</span></span>
<span id="cb7-642"><a href="#cb7-642" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> isMoveInChildElement <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb7-643"><a href="#cb7-643" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> diagram<span class="op">,</span></span>
<span id="cb7-644"><a href="#cb7-644" aria-hidden="true" tabindex="-1"></a>      init <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb7-645"><a href="#cb7-645" aria-hidden="true" tabindex="-1"></a>      elem <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(node)<span class="op">.</span><span class="fu">attr</span>(<span class="st">'style'</span><span class="op">,</span> <span class="st">'border: 1px solid salmon; background-color: #dadad991'</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"venn-id"</span>)<span class="op">,</span></span>
<span id="cb7-646"><a href="#cb7-646" aria-hidden="true" tabindex="-1"></a>      tooltip <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(node)<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"venntooltip"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">'style'</span><span class="op">,</span> <span class="st">'z-index: 100'</span>)<span class="op">;</span></span>
<span id="cb7-647"><a href="#cb7-647" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-648"><a href="#cb7-648" aria-hidden="true" tabindex="-1"></a>  elem<span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb7-649"><a href="#cb7-649" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="op">!</span>isMoveInChildElement){</span>
<span id="cb7-650"><a href="#cb7-650" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb7-651"><a href="#cb7-651" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">'1px solid white'</span>)</span>
<span id="cb7-652"><a href="#cb7-652" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> <span class="st">'#dcdcdc'</span>)<span class="op">;</span></span>
<span id="cb7-653"><a href="#cb7-653" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-654"><a href="#cb7-654" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-655"><a href="#cb7-655" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb7-656"><a href="#cb7-656" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) {</span>
<span id="cb7-657"><a href="#cb7-657" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> selection <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb7-658"><a href="#cb7-658" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">'style'</span><span class="op">,</span> <span class="st">'border: 1px solid salmon; background-color: #dadad991'</span>)</span>
<span id="cb7-659"><a href="#cb7-659" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb7-660"><a href="#cb7-660" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-661"><a href="#cb7-661" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(node)<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> hRect <span class="op">-</span> <span class="dv">50</span> <span class="op">-</span> fontSize )</span>
<span id="cb7-662"><a href="#cb7-662" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> wRect <span class="op">-</span> <span class="dv">20</span> <span class="op">-</span> fontSize )</span>
<span id="cb7-663"><a href="#cb7-663" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#003263"</span>)</span>
<span id="cb7-664"><a href="#cb7-664" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#003263"</span>)</span>
<span id="cb7-665"><a href="#cb7-665" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize)</span>
<span id="cb7-666"><a href="#cb7-666" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb7-667"><a href="#cb7-667" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">text</span>(<span class="kw">function</span>() { <span class="cf">return</span> data<span class="op">.</span><span class="at">sets</span><span class="op">.</span><span class="fu">reduce</span>((a <span class="op">,</span> b)<span class="kw">=&gt;</span> {</span>
<span id="cb7-668"><a href="#cb7-668" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> newCharacter <span class="op">=</span> a <span class="op">===</span><span class="st">'Not '</span> <span class="op">?</span>  <span class="st">'Not '</span> <span class="op">:</span> a <span class="op">+</span> <span class="st">"⋃"</span></span>
<span id="cb7-669"><a href="#cb7-669" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> newCharacter <span class="op">+</span> b<span class="op">.</span><span class="at">label</span></span>
<span id="cb7-670"><a href="#cb7-670" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span> <span class="st">'Not '</span>)})<span class="op">;</span></span>
<span id="cb7-671"><a href="#cb7-671" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-672"><a href="#cb7-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>()</span>
<span id="cb7-673"><a href="#cb7-673" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">load</span>() {</span>
<span id="cb7-674"><a href="#cb7-674" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> vennObj<span class="op">,</span> sets<span class="op">,</span> overlaps<span class="op">;</span></span>
<span id="cb7-675"><a href="#cb7-675" aria-hidden="true" tabindex="-1"></a>      sets <span class="op">=</span> data<span class="op">.</span><span class="at">sets</span><span class="op">;</span></span>
<span id="cb7-676"><a href="#cb7-676" aria-hidden="true" tabindex="-1"></a>      overlaps <span class="op">=</span> data<span class="op">.</span><span class="at">overlaps</span></span>
<span id="cb7-677"><a href="#cb7-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-678"><a href="#cb7-678" aria-hidden="true" tabindex="-1"></a>    <span class="co">// get positions for each set</span></span>
<span id="cb7-679"><a href="#cb7-679" aria-hidden="true" tabindex="-1"></a>    vennObj <span class="op">=</span> venn<span class="op">.</span><span class="fu">venn</span>(sets<span class="op">,</span> overlaps)<span class="op">;</span></span>
<span id="cb7-680"><a href="#cb7-680" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-681"><a href="#cb7-681" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (init) {</span>
<span id="cb7-682"><a href="#cb7-682" aria-hidden="true" tabindex="-1"></a>      <span class="co">// draw the diagram in the 'venn' div</span></span>
<span id="cb7-683"><a href="#cb7-683" aria-hidden="true" tabindex="-1"></a>      diagram <span class="op">=</span> venn<span class="op">.</span><span class="fu">drawD3Diagram</span>(elem<span class="op">,</span> vennObj<span class="op">,</span>wRect<span class="op">,</span> hRect)<span class="op">;</span></span>
<span id="cb7-684"><a href="#cb7-684" aria-hidden="true" tabindex="-1"></a>      init <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb7-685"><a href="#cb7-685" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-686"><a href="#cb7-686" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb7-687"><a href="#cb7-687" aria-hidden="true" tabindex="-1"></a>      venn<span class="op">.</span><span class="fu">updateD3Diagram</span>(elem<span class="op">,</span> vennObj)<span class="op">;</span></span>
<span id="cb7-688"><a href="#cb7-688" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-689"><a href="#cb7-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-690"><a href="#cb7-690" aria-hidden="true" tabindex="-1"></a>    <span class="co">// hover on all the circles</span></span>
<span id="cb7-691"><a href="#cb7-691" aria-hidden="true" tabindex="-1"></a>    diagram<span class="op">.</span><span class="at">circles</span></span>
<span id="cb7-692"><a href="#cb7-692" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb7-693"><a href="#cb7-693" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb7-694"><a href="#cb7-694" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"2"</span>)</span>
<span id="cb7-695"><a href="#cb7-695" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb7-696"><a href="#cb7-696" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> x <span class="op">=</span> d3<span class="op">.</span><span class="at">event</span><span class="op">.</span><span class="at">pageX</span><span class="op">;</span></span>
<span id="cb7-697"><a href="#cb7-697" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> y <span class="op">=</span> d3<span class="op">.</span><span class="at">event</span><span class="op">.</span><span class="at">pageY</span><span class="op">;</span></span>
<span id="cb7-698"><a href="#cb7-698" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> (x) <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb7-699"><a href="#cb7-699" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> (y) <span class="op">+</span> <span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb7-700"><a href="#cb7-700" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb7-701"><a href="#cb7-701" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) {</span>
<span id="cb7-702"><a href="#cb7-702" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> selection <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb7-703"><a href="#cb7-703" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">moveParentToFront</span>()</span>
<span id="cb7-704"><a href="#cb7-704" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb7-705"><a href="#cb7-705" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">5</span>)</span>
<span id="cb7-706"><a href="#cb7-706" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb7-707"><a href="#cb7-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-708"><a href="#cb7-708" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">9</span>)<span class="op">;</span></span>
<span id="cb7-709"><a href="#cb7-709" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">.</span><span class="fu">text</span>(d<span class="op">.</span><span class="at">number</span>)<span class="op">;</span></span>
<span id="cb7-710"><a href="#cb7-710" aria-hidden="true" tabindex="-1"></a>        isMoveInChildElement <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb7-711"><a href="#cb7-711" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">select</span>(node)<span class="op">.</span><span class="fu">attr</span>(<span class="st">'style'</span><span class="op">,</span> <span class="st">'border: 1px solid salmon; background-color: #dadad991'</span>)</span>
<span id="cb7-712"><a href="#cb7-712" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb7-713"><a href="#cb7-713" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) {</span>
<span id="cb7-714"><a href="#cb7-714" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb7-715"><a href="#cb7-715" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">3</span>)</span>
<span id="cb7-716"><a href="#cb7-716" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb7-717"><a href="#cb7-717" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb7-718"><a href="#cb7-718" aria-hidden="true" tabindex="-1"></a>      isMoveInChildElement <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb7-719"><a href="#cb7-719" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb7-720"><a href="#cb7-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-721"><a href="#cb7-721" aria-hidden="true" tabindex="-1"></a>    overlaps <span class="op">=</span> overlaps<span class="op">.</span><span class="fu">map</span>(value <span class="kw">=&gt;</span> {</span>
<span id="cb7-722"><a href="#cb7-722" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> dxO1O2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(data<span class="op">.</span><span class="at">sets</span>[value<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">.</span><span class="at">x</span><span class="op">-</span>data<span class="op">.</span><span class="at">sets</span>[value<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]]<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb7-723"><a href="#cb7-723" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> deltaX <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(data<span class="op">.</span><span class="at">sets</span>[value<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">.</span><span class="at">radius</span> <span class="op">+</span> data<span class="op">.</span><span class="at">sets</span>[value<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]]<span class="op">.</span><span class="at">radius</span> <span class="op">-</span> dxO1O2) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb7-724"><a href="#cb7-724" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb7-725"><a href="#cb7-725" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>value<span class="op">,</span></span>
<span id="cb7-726"><a href="#cb7-726" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> data<span class="op">.</span><span class="at">sets</span>[value<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">.</span><span class="at">x</span> <span class="op">+</span> data<span class="op">.</span><span class="at">sets</span>[value<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">.</span><span class="at">radius</span> <span class="op">-</span> deltaX <span class="op">,</span></span>
<span id="cb7-727"><a href="#cb7-727" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> value<span class="op">.</span><span class="at">sets</span><span class="op">.</span><span class="fu">reduce</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb7-728"><a href="#cb7-728" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> a <span class="op">+</span> data<span class="op">.</span><span class="at">sets</span>[b]<span class="op">.</span><span class="at">y</span></span>
<span id="cb7-729"><a href="#cb7-729" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb7-730"><a href="#cb7-730" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb7-731"><a href="#cb7-731" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-732"><a href="#cb7-732" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-733"><a href="#cb7-733" aria-hidden="true" tabindex="-1"></a>    <span class="co">// draw a path around each intersection area, add hover there as well</span></span>
<span id="cb7-734"><a href="#cb7-734" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> intersections <span class="op">=</span> diagram<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">select</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb7-735"><a href="#cb7-735" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(overlaps)</span>
<span id="cb7-736"><a href="#cb7-736" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> intersects <span class="op">=</span> intersections</span>
<span id="cb7-737"><a href="#cb7-737" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()<span class="op">;</span></span>
<span id="cb7-738"><a href="#cb7-738" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-739"><a href="#cb7-739" aria-hidden="true" tabindex="-1"></a>    intersects<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb7-740"><a href="#cb7-740" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="vs">`intersection-text-</span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">`</span> })</span>
<span id="cb7-741"><a href="#cb7-741" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> d<span class="op">.</span><span class="at">x</span> })</span>
<span id="cb7-742"><a href="#cb7-742" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> d<span class="op">.</span><span class="at">y</span> })</span>
<span id="cb7-743"><a href="#cb7-743" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#9D4057"</span>)</span>
<span id="cb7-744"><a href="#cb7-744" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#9D4057"</span>)</span>
<span id="cb7-745"><a href="#cb7-745" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize)</span>
<span id="cb7-746"><a href="#cb7-746" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb7-747"><a href="#cb7-747" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="kw">function</span>(d) { </span>
<span id="cb7-748"><a href="#cb7-748" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">size</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs"> ∩ </span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb7-749"><a href="#cb7-749" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">''</span></span>
<span id="cb7-750"><a href="#cb7-750" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb7-751"><a href="#cb7-751" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-752"><a href="#cb7-752" aria-hidden="true" tabindex="-1"></a>      intersects<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb7-753"><a href="#cb7-753" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="vs">`intersection-</span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">`</span> })</span>
<span id="cb7-754"><a href="#cb7-754" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill-opacity"</span><span class="op">,</span><span class="st">"0"</span>)</span>
<span id="cb7-755"><a href="#cb7-755" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb7-756"><a href="#cb7-756" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb7-757"><a href="#cb7-757" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb7-758"><a href="#cb7-758" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"2"</span>)</span>
<span id="cb7-759"><a href="#cb7-759" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-760"><a href="#cb7-760" aria-hidden="true" tabindex="-1"></a>    intersections</span>
<span id="cb7-761"><a href="#cb7-761" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="kw">function</span>(d) { </span>
<span id="cb7-762"><a href="#cb7-762" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> venn<span class="op">.</span><span class="fu">intersectionAreaSplitPath</span>(d<span class="op">.</span><span class="at">sets</span><span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(j) { <span class="cf">return</span> vennObj[j]<span class="op">;</span> })<span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span> </span>
<span id="cb7-763"><a href="#cb7-763" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb7-764"><a href="#cb7-764" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) {</span>
<span id="cb7-765"><a href="#cb7-765" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">moveParentToFront</span>()</span>
<span id="cb7-766"><a href="#cb7-766" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb7-767"><a href="#cb7-767" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">1</span>)</span>
<span id="cb7-768"><a href="#cb7-768" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb7-769"><a href="#cb7-769" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb7-770"><a href="#cb7-770" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">.</span><span class="fu">text</span>(d<span class="op">.</span><span class="at">number</span>)<span class="op">;</span></span>
<span id="cb7-771"><a href="#cb7-771" aria-hidden="true" tabindex="-1"></a>        isMoveInChildElement <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb7-772"><a href="#cb7-772" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb7-773"><a href="#cb7-773" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) {</span>
<span id="cb7-774"><a href="#cb7-774" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">moveParentToFront</span>()<span class="op">;</span></span>
<span id="cb7-775"><a href="#cb7-775" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb7-776"><a href="#cb7-776" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb7-777"><a href="#cb7-777" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb7-778"><a href="#cb7-778" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb7-779"><a href="#cb7-779" aria-hidden="true" tabindex="-1"></a>        isMoveInChildElement <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb7-780"><a href="#cb7-780" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">select</span>(node)<span class="op">.</span><span class="fu">attr</span>(<span class="st">'style'</span><span class="op">,</span> <span class="st">'border: 1px solid salmon; background-color: #dadad991'</span>)</span>
<span id="cb7-781"><a href="#cb7-781" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb7-782"><a href="#cb7-782" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb7-783"><a href="#cb7-783" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> (d3<span class="op">.</span><span class="at">event</span><span class="op">.</span><span class="at">pageX</span>) <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb7-784"><a href="#cb7-784" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> (d3<span class="op">.</span><span class="at">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">-</span> <span class="dv">28</span>) <span class="op">+</span> <span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb7-785"><a href="#cb7-785" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb7-786"><a href="#cb7-786" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-787"><a href="#cb7-787" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb7-788"><a href="#cb7-788" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> rightIntersections <span class="op">=</span> diagram<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">select</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb7-789"><a href="#cb7-789" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(overlaps)</span>
<span id="cb7-790"><a href="#cb7-790" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> rightIntersects <span class="op">=</span> rightIntersections</span>
<span id="cb7-791"><a href="#cb7-791" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()<span class="op">;</span></span>
<span id="cb7-792"><a href="#cb7-792" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-793"><a href="#cb7-793" aria-hidden="true" tabindex="-1"></a>    rightIntersects<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb7-794"><a href="#cb7-794" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="vs">`intersection-right-</span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">`</span> })</span>
<span id="cb7-795"><a href="#cb7-795" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill-opacity"</span><span class="op">,</span><span class="st">"0"</span>)</span>
<span id="cb7-796"><a href="#cb7-796" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb7-797"><a href="#cb7-797" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb7-798"><a href="#cb7-798" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb7-799"><a href="#cb7-799" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"2"</span>)</span>
<span id="cb7-800"><a href="#cb7-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-801"><a href="#cb7-801" aria-hidden="true" tabindex="-1"></a>    rightIntersections</span>
<span id="cb7-802"><a href="#cb7-802" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="kw">function</span>(d) { </span>
<span id="cb7-803"><a href="#cb7-803" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> venn<span class="op">.</span><span class="fu">intersectionAreaSplitPath</span>(d<span class="op">.</span><span class="at">sets</span><span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(j) { <span class="cf">return</span> vennObj[j]<span class="op">;</span> })<span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span> </span>
<span id="cb7-804"><a href="#cb7-804" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb7-805"><a href="#cb7-805" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-806"><a href="#cb7-806" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb7-807"><a href="#cb7-807" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> leftIntersections <span class="op">=</span> diagram<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">select</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb7-808"><a href="#cb7-808" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(overlaps)</span>
<span id="cb7-809"><a href="#cb7-809" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> leftIntersects <span class="op">=</span> leftIntersections</span>
<span id="cb7-810"><a href="#cb7-810" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()<span class="op">;</span></span>
<span id="cb7-811"><a href="#cb7-811" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-812"><a href="#cb7-812" aria-hidden="true" tabindex="-1"></a>    leftIntersects<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb7-813"><a href="#cb7-813" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="vs">`intersection-left-</span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>data<span class="op">.</span><span class="at">sets</span>[d<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]]<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">`</span> })</span>
<span id="cb7-814"><a href="#cb7-814" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill-opacity"</span><span class="op">,</span><span class="st">"0"</span>)</span>
<span id="cb7-815"><a href="#cb7-815" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb7-816"><a href="#cb7-816" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb7-817"><a href="#cb7-817" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb7-818"><a href="#cb7-818" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"2"</span>)</span>
<span id="cb7-819"><a href="#cb7-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-820"><a href="#cb7-820" aria-hidden="true" tabindex="-1"></a>    leftIntersections</span>
<span id="cb7-821"><a href="#cb7-821" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="kw">function</span>(d) { </span>
<span id="cb7-822"><a href="#cb7-822" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> venn<span class="op">.</span><span class="fu">intersectionAreaSplitPath</span>(d<span class="op">.</span><span class="at">sets</span><span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(j) { <span class="cf">return</span> vennObj[j]<span class="op">;</span> })<span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span> </span>
<span id="cb7-823"><a href="#cb7-823" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb7-824"><a href="#cb7-824" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-825"><a href="#cb7-825" aria-hidden="true" tabindex="-1"></a>    intersections<span class="op">.</span><span class="fu">exit</span>()<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb7-826"><a href="#cb7-826" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb7-827"><a href="#cb7-827" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-828"><a href="#cb7-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-829"><a href="#cb7-829" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="at">selection</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">moveParentToFront</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb7-830"><a href="#cb7-830" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>(){</span>
<span id="cb7-831"><a href="#cb7-831" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="fu">appendChild</span>(<span class="kw">this</span><span class="op">.</span><span class="at">parentNode</span>)<span class="op">;</span></span>
<span id="cb7-832"><a href="#cb7-832" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb7-833"><a href="#cb7-833" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb7-834"><a href="#cb7-834" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-835"><a href="#cb7-835" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> elem<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb7-836"><a href="#cb7-836" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="843" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 842;"><span id="cb8-843"><a href="#cb8-843" aria-hidden="true" tabindex="-1"></a>rA <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(sA <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)</span>
<span id="cb8-844"><a href="#cb8-844" aria-hidden="true" tabindex="-1"></a>sB <span class="op">=</span> N_B <span class="op">/</span> N_ALL <span class="op">*</span> S_MAX</span>
<span id="cb8-845"><a href="#cb8-845" aria-hidden="true" tabindex="-1"></a>rB <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(sB <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)</span>
<span id="cb8-846"><a href="#cb8-846" aria-hidden="true" tabindex="-1"></a>sBoth <span class="op">=</span> nAAndB <span class="op">/</span> N_ALL <span class="op">*</span> S_MAX</span>
<span id="cb8-847"><a href="#cb8-847" aria-hidden="true" tabindex="-1"></a>delta <span class="op">=</span> (rA <span class="op">+</span> rB) <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb8-848"><a href="#cb8-848" aria-hidden="true" tabindex="-1"></a>hRect <span class="op">=</span> <span class="dv">800</span><span class="co">//( rA + rB ) * 2 + 2 * delta</span></span>
<span id="cb8-849"><a href="#cb8-849" aria-hidden="true" tabindex="-1"></a>wRect <span class="op">=</span> <span class="dv">400</span><span class="co">//2 * d3.max([rA, rB]) + 2 * delta</span></span>
<span id="cb8-850"><a href="#cb8-850" aria-hidden="true" tabindex="-1"></a>fontSize <span class="op">=</span> hRect <span class="op">/</span> <span class="dv">30</span></span>
<span id="cb8-851"><a href="#cb8-851" aria-hidden="true" tabindex="-1"></a>mutable N_A <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb8-852"><a href="#cb8-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-853"><a href="#cb8-853" aria-hidden="true" tabindex="-1"></a>numberOfA <span class="op">=</span> {</span>
<span id="cb8-854"><a href="#cb8-854" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;input type="number" max=100 style="width:50px;height:20px" /&gt;`</span></span>
<span id="cb8-855"><a href="#cb8-855" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">onchange</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb8-856"><a href="#cb8-856" aria-hidden="true" tabindex="-1"></a>      mutable N_A <span class="op">=</span> input<span class="op">.</span><span class="at">valueAsNumber</span><span class="op">;</span></span>
<span id="cb8-857"><a href="#cb8-857" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-858"><a href="#cb8-858" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>input<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-859"><a href="#cb8-859" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-860"><a href="#cb8-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-861"><a href="#cb8-861" aria-hidden="true" tabindex="-1"></a>numberOfB <span class="op">=</span> {</span>
<span id="cb8-862"><a href="#cb8-862" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;input type="number" max=100 style="width:50px;height:20px"/&gt;`</span></span>
<span id="cb8-863"><a href="#cb8-863" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">onchange</span> <span class="op">=</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb8-864"><a href="#cb8-864" aria-hidden="true" tabindex="-1"></a>    mutable N_B <span class="op">=</span> input<span class="op">.</span><span class="at">valueAsNumber</span><span class="op">;</span></span>
<span id="cb8-865"><a href="#cb8-865" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-866"><a href="#cb8-866" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>input<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-867"><a href="#cb8-867" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-868"><a href="#cb8-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-869"><a href="#cb8-869" aria-hidden="true" tabindex="-1"></a>numberOfNotOrAB <span class="op">=</span> {</span>
<span id="cb8-870"><a href="#cb8-870" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;input type="number" max=100 style="width:50px;height:20px"/&gt;`</span></span>
<span id="cb8-871"><a href="#cb8-871" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">onchange</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb8-872"><a href="#cb8-872" aria-hidden="true" tabindex="-1"></a>    mutable nNotOrAB <span class="op">=</span> input<span class="op">.</span><span class="at">valueAsNumber</span><span class="op">;</span></span>
<span id="cb8-873"><a href="#cb8-873" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-874"><a href="#cb8-874" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>input<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-875"><a href="#cb8-875" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-876"><a href="#cb8-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-877"><a href="#cb8-877" aria-hidden="true" tabindex="-1"></a>sliderA <span class="op">=</span> {</span>
<span id="cb8-878"><a href="#cb8-878" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;input type="range" min="0" max=</span><span class="sc">${</span>N_A<span class="sc">}</span><span class="vs"> step="1" value=</span><span class="sc">${</span>nAAndB<span class="sc">}</span><span class="vs"> /&gt;`</span></span>
<span id="cb8-879"><a href="#cb8-879" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb8-880"><a href="#cb8-880" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(input<span class="op">.</span><span class="at">valueAsNumber</span> <span class="op">&lt;=</span> maxNAAndB){</span>
<span id="cb8-881"><a href="#cb8-881" aria-hidden="true" tabindex="-1"></a>      mutable nAAndB <span class="op">=</span> input<span class="op">.</span><span class="at">valueAsNumber</span><span class="op">;</span></span>
<span id="cb8-882"><a href="#cb8-882" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-883"><a href="#cb8-883" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb8-884"><a href="#cb8-884" aria-hidden="true" tabindex="-1"></a>     mutable nAAndB <span class="op">=</span> maxNAAndB<span class="op">;</span></span>
<span id="cb8-885"><a href="#cb8-885" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-886"><a href="#cb8-886" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb8-887"><a href="#cb8-887" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`0 </span><span class="sc">${</span>input<span class="sc">}</span><span class="vs"> nA`</span><span class="op">;</span></span>
<span id="cb8-888"><a href="#cb8-888" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-13" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="894" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 893;"><span id="cb9-894"><a href="#cb9-894" aria-hidden="true" tabindex="-1"></a>nAAndNotB <span class="op">=</span> N_A <span class="op">-</span> nAAndB<span class="op">;</span></span>
<span id="cb9-895"><a href="#cb9-895" aria-hidden="true" tabindex="-1"></a>mutable N_B <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb9-896"><a href="#cb9-896" aria-hidden="true" tabindex="-1"></a>nBAndNotA <span class="op">=</span> N_B <span class="op">-</span> nAAndB</span>
<span id="cb9-897"><a href="#cb9-897" aria-hidden="true" tabindex="-1"></a>maxNAAndB <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(N_A<span class="op">,</span> N_B)</span>
<span id="cb9-898"><a href="#cb9-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-899"><a href="#cb9-899" aria-hidden="true" tabindex="-1"></a>sliderB <span class="op">=</span> {</span>
<span id="cb9-900"><a href="#cb9-900" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;input type="range" min="0" max=</span><span class="sc">${</span>N_B<span class="sc">}</span><span class="vs"> step="1" value=</span><span class="sc">${</span>nAAndB<span class="sc">}</span><span class="vs"> /&gt;`</span></span>
<span id="cb9-901"><a href="#cb9-901" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb9-902"><a href="#cb9-902" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(input<span class="op">.</span><span class="at">valueAsNumber</span> <span class="op">&lt;=</span> maxNAAndB){</span>
<span id="cb9-903"><a href="#cb9-903" aria-hidden="true" tabindex="-1"></a>      mutable nAAndB <span class="op">=</span> input<span class="op">.</span><span class="at">valueAsNumber</span><span class="op">;</span></span>
<span id="cb9-904"><a href="#cb9-904" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-905"><a href="#cb9-905" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb9-906"><a href="#cb9-906" aria-hidden="true" tabindex="-1"></a>     mutable nAAndB <span class="op">=</span> maxNAAndB<span class="op">;</span></span>
<span id="cb9-907"><a href="#cb9-907" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-908"><a href="#cb9-908" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb9-909"><a href="#cb9-909" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`0 </span><span class="sc">${</span>input<span class="sc">}</span><span class="vs"> nB`</span><span class="op">;</span></span>
<span id="cb9-910"><a href="#cb9-910" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-911"><a href="#cb9-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-912"><a href="#cb9-912" aria-hidden="true" tabindex="-1"></a>mutable nNotOrAB <span class="op">=</span><span class="dv">0</span></span>
<span id="cb9-913"><a href="#cb9-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-914"><a href="#cb9-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-915"><a href="#cb9-915" aria-hidden="true" tabindex="-1"></a>sliderC <span class="op">=</span> {</span>
<span id="cb9-916"><a href="#cb9-916" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;input type="range" min="0" max=</span><span class="sc">${</span>N_A <span class="op">+</span> N_B <span class="op">+</span> nNotOrAB<span class="sc">}</span><span class="vs"> step="1" value=</span><span class="sc">${</span>nAAndB<span class="sc">}</span><span class="vs"> /&gt;`</span></span>
<span id="cb9-917"><a href="#cb9-917" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb9-918"><a href="#cb9-918" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(input<span class="op">.</span><span class="at">valueAsNumber</span> <span class="op">&lt;=</span> maxNAAndB){</span>
<span id="cb9-919"><a href="#cb9-919" aria-hidden="true" tabindex="-1"></a>      mutable nAAndB <span class="op">=</span> input<span class="op">.</span><span class="at">valueAsNumber</span><span class="op">;</span></span>
<span id="cb9-920"><a href="#cb9-920" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-921"><a href="#cb9-921" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb9-922"><a href="#cb9-922" aria-hidden="true" tabindex="-1"></a>     mutable nAAndB <span class="op">=</span> maxNAAndB<span class="op">;</span></span>
<span id="cb9-923"><a href="#cb9-923" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-924"><a href="#cb9-924" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb9-925"><a href="#cb9-925" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`0 </span><span class="sc">${</span>input<span class="sc">}</span><span class="vs"> nA + nB + nNot(AorB)`</span><span class="op">;</span></span>
<span id="cb9-926"><a href="#cb9-926" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-927"><a href="#cb9-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-928"><a href="#cb9-928" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {</span>
<span id="cb9-929"><a href="#cb9-929" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>{</span>
<span id="cb9-930"><a href="#cb9-930" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sets"</span><span class="op">:</span> [</span>
<span id="cb9-931"><a href="#cb9-931" aria-hidden="true" tabindex="-1"></a>      {<span class="st">"label"</span><span class="op">:</span> <span class="st">"A"</span><span class="op">,</span> <span class="st">"size"</span><span class="op">:</span> sA<span class="op">,</span> <span class="st">"number"</span><span class="op">:</span> N_A}<span class="op">,</span></span>
<span id="cb9-932"><a href="#cb9-932" aria-hidden="true" tabindex="-1"></a>      {<span class="st">"label"</span><span class="op">:</span> <span class="st">"B"</span><span class="op">,</span> <span class="st">"size"</span><span class="op">:</span> sB<span class="op">,</span><span class="st">"number"</span><span class="op">:</span> N_B}<span class="op">,</span></span>
<span id="cb9-933"><a href="#cb9-933" aria-hidden="true" tabindex="-1"></a>      <span class="co">// {"label": "C", "size": 40000,"number": N_B},</span></span>
<span id="cb9-934"><a href="#cb9-934" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb9-935"><a href="#cb9-935" aria-hidden="true" tabindex="-1"></a>    <span class="st">"overlaps"</span><span class="op">:</span> [</span>
<span id="cb9-936"><a href="#cb9-936" aria-hidden="true" tabindex="-1"></a>      { <span class="st">"sets"</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> <span class="st">"size"</span><span class="op">:</span> sBoth<span class="op">,</span> <span class="st">"number"</span><span class="op">:</span> nAAndB}<span class="op">,</span></span>
<span id="cb9-937"><a href="#cb9-937" aria-hidden="true" tabindex="-1"></a>      <span class="co">// {"sets": [0, 2], "size": 10000, "number": nAAndB},</span></span>
<span id="cb9-938"><a href="#cb9-938" aria-hidden="true" tabindex="-1"></a>      <span class="co">// {"sets": [1, 2], "size": 10000, "number": nAAndB},</span></span>
<span id="cb9-939"><a href="#cb9-939" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb9-940"><a href="#cb9-940" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-941"><a href="#cb9-941" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-8" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="946" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 945;"><span id="cb10-946"><a href="#cb10-946" aria-hidden="true" tabindex="-1"></a>venn <span class="op">=</span> {</span>
<span id="cb10-947"><a href="#cb10-947" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> venn <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb10-948"><a href="#cb10-948" aria-hidden="true" tabindex="-1"></a>  <span class="co">/** given a list of set objects, and their corresponding overlaps.</span></span>
<span id="cb10-949"><a href="#cb10-949" aria-hidden="true" tabindex="-1"></a><span class="co">    updates the (x, y, radius) attribute on each set such that their positions</span></span>
<span id="cb10-950"><a href="#cb10-950" aria-hidden="true" tabindex="-1"></a><span class="co">    roughly correspond to the desired overlaps */</span></span>
<span id="cb10-951"><a href="#cb10-951" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">venn</span> <span class="op">=</span> <span class="kw">function</span>(sets<span class="op">,</span> overlaps<span class="op">,</span> parameters) {</span>
<span id="cb10-952"><a href="#cb10-952" aria-hidden="true" tabindex="-1"></a>        parameters <span class="op">=</span> parameters <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb10-953"><a href="#cb10-953" aria-hidden="true" tabindex="-1"></a>        parameters<span class="op">.</span><span class="at">maxIterations</span> <span class="op">=</span> parameters<span class="op">.</span><span class="at">maxIterations</span> <span class="op">||</span> <span class="dv">500</span><span class="op">;</span></span>
<span id="cb10-954"><a href="#cb10-954" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> lossFunction <span class="op">=</span> parameters<span class="op">.</span><span class="at">lossFunction</span> <span class="op">||</span> venn<span class="op">.</span><span class="at">lossFunction</span><span class="op">;</span></span>
<span id="cb10-955"><a href="#cb10-955" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> initialLayout <span class="op">=</span> parameters<span class="op">.</span><span class="at">layoutFunction</span> <span class="op">||</span> venn<span class="op">.</span><span class="at">greedyLayout</span><span class="op">;</span></span>
<span id="cb10-956"><a href="#cb10-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-957"><a href="#cb10-957" aria-hidden="true" tabindex="-1"></a>        <span class="co">// initial layout is done greedily</span></span>
<span id="cb10-958"><a href="#cb10-958" aria-hidden="true" tabindex="-1"></a>        sets <span class="op">=</span> <span class="fu">initialLayout</span>(sets<span class="op">,</span> overlaps)<span class="op">;</span></span>
<span id="cb10-959"><a href="#cb10-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-960"><a href="#cb10-960" aria-hidden="true" tabindex="-1"></a>        <span class="co">// transform x/y coordinates to a vector to optimize</span></span>
<span id="cb10-961"><a href="#cb10-961" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> initial <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(<span class="dv">2</span><span class="op">*</span>sets<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb10-962"><a href="#cb10-962" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> sets<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-963"><a href="#cb10-963" aria-hidden="true" tabindex="-1"></a>            initial[<span class="dv">2</span> <span class="op">*</span> i] <span class="op">=</span> sets[i]<span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb10-964"><a href="#cb10-964" aria-hidden="true" tabindex="-1"></a>            initial[<span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> sets[i]<span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb10-965"><a href="#cb10-965" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-966"><a href="#cb10-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-967"><a href="#cb10-967" aria-hidden="true" tabindex="-1"></a>        <span class="co">// optimize initial layout from our loss function</span></span>
<span id="cb10-968"><a href="#cb10-968" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> totalFunctionCalls <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-969"><a href="#cb10-969" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> solution <span class="op">=</span> venn<span class="op">.</span><span class="fu">fmin</span>(</span>
<span id="cb10-970"><a href="#cb10-970" aria-hidden="true" tabindex="-1"></a>            <span class="kw">function</span>(values) {</span>
<span id="cb10-971"><a href="#cb10-971" aria-hidden="true" tabindex="-1"></a>                totalFunctionCalls <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-972"><a href="#cb10-972" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> current <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(sets<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb10-973"><a href="#cb10-973" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> sets<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-974"><a href="#cb10-974" aria-hidden="true" tabindex="-1"></a>                    current[i] <span class="op">=</span> {<span class="dt">x</span><span class="op">:</span> values[<span class="dv">2</span> <span class="op">*</span> i]<span class="op">,</span></span>
<span id="cb10-975"><a href="#cb10-975" aria-hidden="true" tabindex="-1"></a>                                  <span class="dt">y</span><span class="op">:</span> values[<span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb10-976"><a href="#cb10-976" aria-hidden="true" tabindex="-1"></a>                                  <span class="dt">radius</span> <span class="op">:</span> sets[i]<span class="op">.</span><span class="at">radius</span><span class="op">,</span></span>
<span id="cb10-977"><a href="#cb10-977" aria-hidden="true" tabindex="-1"></a>                                  <span class="dt">size</span> <span class="op">:</span> sets[i]<span class="op">.</span><span class="at">size</span>}<span class="op">;</span></span>
<span id="cb10-978"><a href="#cb10-978" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-979"><a href="#cb10-979" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="fu">lossFunction</span>(current<span class="op">,</span> overlaps)<span class="op">;</span></span>
<span id="cb10-980"><a href="#cb10-980" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb10-981"><a href="#cb10-981" aria-hidden="true" tabindex="-1"></a>            initial<span class="op">,</span></span>
<span id="cb10-982"><a href="#cb10-982" aria-hidden="true" tabindex="-1"></a>            parameters)<span class="op">;</span></span>
<span id="cb10-983"><a href="#cb10-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-984"><a href="#cb10-984" aria-hidden="true" tabindex="-1"></a>        <span class="co">// transform solution vector back to x/y points</span></span>
<span id="cb10-985"><a href="#cb10-985" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> positions <span class="op">=</span> solution<span class="op">.</span><span class="at">solution</span><span class="op">;</span></span>
<span id="cb10-986"><a href="#cb10-986" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> sets<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-987"><a href="#cb10-987" aria-hidden="true" tabindex="-1"></a>            sets[i]<span class="op">.</span><span class="at">x</span> <span class="op">=</span> positions[<span class="dv">2</span> <span class="op">*</span> i]<span class="op">;</span></span>
<span id="cb10-988"><a href="#cb10-988" aria-hidden="true" tabindex="-1"></a>            sets[i]<span class="op">.</span><span class="at">y</span> <span class="op">=</span> positions[<span class="dv">2</span> <span class="op">*</span> i <span class="op">+</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb10-989"><a href="#cb10-989" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-990"><a href="#cb10-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-991"><a href="#cb10-991" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sets<span class="op">;</span></span>
<span id="cb10-992"><a href="#cb10-992" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-993"><a href="#cb10-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-994"><a href="#cb10-994" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Returns the distance necessary for two circles of radius r1 + r2 to</span></span>
<span id="cb10-995"><a href="#cb10-995" aria-hidden="true" tabindex="-1"></a><span class="co">    have the overlap area 'overlap' */</span></span>
<span id="cb10-996"><a href="#cb10-996" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">distanceFromIntersectArea</span> <span class="op">=</span> <span class="kw">function</span>(r1<span class="op">,</span> r2<span class="op">,</span> overlap) {</span>
<span id="cb10-997"><a href="#cb10-997" aria-hidden="true" tabindex="-1"></a>        <span class="co">// handle complete overlapped circles</span></span>
<span id="cb10-998"><a href="#cb10-998" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(r1<span class="op">,</span> r2) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(r1<span class="op">,</span>r2) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">&lt;=</span> overlap) {</span>
<span id="cb10-999"><a href="#cb10-999" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(r1 <span class="op">-</span> r2)<span class="op">;</span></span>
<span id="cb10-1000"><a href="#cb10-1000" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1001"><a href="#cb10-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1002"><a href="#cb10-1002" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> venn<span class="op">.</span><span class="fu">bisect</span>(<span class="kw">function</span>(distance) {</span>
<span id="cb10-1003"><a href="#cb10-1003" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> circleIntersection<span class="op">.</span><span class="fu">circleOverlap</span>(r1<span class="op">,</span> r2<span class="op">,</span> distance) <span class="op">-</span> overlap<span class="op">;</span></span>
<span id="cb10-1004"><a href="#cb10-1004" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> r1 <span class="op">+</span> r2)<span class="op">;</span></span>
<span id="cb10-1005"><a href="#cb10-1005" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1006"><a href="#cb10-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1007"><a href="#cb10-1007" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// gets a matrix of euclidean distances between all sets in venn diagram</span></span>
<span id="cb10-1008"><a href="#cb10-1008" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">getDistanceMatrix</span> <span class="op">=</span> <span class="kw">function</span>(sets<span class="op">,</span> overlaps) {</span>
<span id="cb10-1009"><a href="#cb10-1009" aria-hidden="true" tabindex="-1"></a>        <span class="co">// initialize an empty distance matrix between all the points</span></span>
<span id="cb10-1010"><a href="#cb10-1010" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> distances <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb10-1011"><a href="#cb10-1011" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> sets<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1012"><a href="#cb10-1012" aria-hidden="true" tabindex="-1"></a>            distances<span class="op">.</span><span class="fu">push</span>([])<span class="op">;</span></span>
<span id="cb10-1013"><a href="#cb10-1013" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> sets<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>j) {</span>
<span id="cb10-1014"><a href="#cb10-1014" aria-hidden="true" tabindex="-1"></a>                distances[i]<span class="op">.</span><span class="fu">push</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb10-1015"><a href="#cb10-1015" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1016"><a href="#cb10-1016" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1017"><a href="#cb10-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1018"><a href="#cb10-1018" aria-hidden="true" tabindex="-1"></a>        <span class="co">// compute distances between all the points</span></span>
<span id="cb10-1019"><a href="#cb10-1019" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> overlaps<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1020"><a href="#cb10-1020" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> current <span class="op">=</span> overlaps[i]<span class="op">;</span></span>
<span id="cb10-1021"><a href="#cb10-1021" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (current<span class="op">.</span><span class="at">sets</span><span class="op">.</span><span class="at">length</span> <span class="op">!==</span> <span class="dv">2</span>) {</span>
<span id="cb10-1022"><a href="#cb10-1022" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb10-1023"><a href="#cb10-1023" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1024"><a href="#cb10-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1025"><a href="#cb10-1025" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> left <span class="op">=</span> current<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb10-1026"><a href="#cb10-1026" aria-hidden="true" tabindex="-1"></a>                right <span class="op">=</span> current<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb10-1027"><a href="#cb10-1027" aria-hidden="true" tabindex="-1"></a>                r1 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(sets[left]<span class="op">.</span><span class="at">size</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)<span class="op">,</span></span>
<span id="cb10-1028"><a href="#cb10-1028" aria-hidden="true" tabindex="-1"></a>                r2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(sets[right]<span class="op">.</span><span class="at">size</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)<span class="op">,</span></span>
<span id="cb10-1029"><a href="#cb10-1029" aria-hidden="true" tabindex="-1"></a>                distance <span class="op">=</span> venn<span class="op">.</span><span class="fu">distanceFromIntersectArea</span>(r1<span class="op">,</span> r2<span class="op">,</span> current<span class="op">.</span><span class="at">size</span>)<span class="op">;</span></span>
<span id="cb10-1030"><a href="#cb10-1030" aria-hidden="true" tabindex="-1"></a>            distances[left][right] <span class="op">=</span> distances[right][left] <span class="op">=</span> distance<span class="op">;</span></span>
<span id="cb10-1031"><a href="#cb10-1031" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1032"><a href="#cb10-1032" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> distances<span class="op">;</span></span>
<span id="cb10-1033"><a href="#cb10-1033" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1034"><a href="#cb10-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1035"><a href="#cb10-1035" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Lays out a Venn diagram greedily, going from most overlapped sets to</span></span>
<span id="cb10-1036"><a href="#cb10-1036" aria-hidden="true" tabindex="-1"></a><span class="co">    least overlapped, attempting to position each new set such that the</span></span>
<span id="cb10-1037"><a href="#cb10-1037" aria-hidden="true" tabindex="-1"></a><span class="co">    overlapping areas to already positioned sets are basically right */</span></span>
<span id="cb10-1038"><a href="#cb10-1038" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">greedyLayout</span> <span class="op">=</span> <span class="kw">function</span>(sets<span class="op">,</span> overlaps) {</span>
<span id="cb10-1039"><a href="#cb10-1039" aria-hidden="true" tabindex="-1"></a>        <span class="co">// give each set a default position + radius</span></span>
<span id="cb10-1040"><a href="#cb10-1040" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> setOverlaps <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb10-1041"><a href="#cb10-1041" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> sets<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1042"><a href="#cb10-1042" aria-hidden="true" tabindex="-1"></a>            setOverlaps[i] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb10-1043"><a href="#cb10-1043" aria-hidden="true" tabindex="-1"></a>            sets[i]<span class="op">.</span><span class="at">radius</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(sets[i]<span class="op">.</span><span class="at">size</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)<span class="op">;</span></span>
<span id="cb10-1044"><a href="#cb10-1044" aria-hidden="true" tabindex="-1"></a>            sets[i]<span class="op">.</span><span class="at">x</span> <span class="op">=</span> sets[i]<span class="op">.</span><span class="at">y</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-1045"><a href="#cb10-1045" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1046"><a href="#cb10-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1047"><a href="#cb10-1047" aria-hidden="true" tabindex="-1"></a>        <span class="co">// map each set to a list of all the other sets that overlap it</span></span>
<span id="cb10-1048"><a href="#cb10-1048" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> overlaps<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1049"><a href="#cb10-1049" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> current <span class="op">=</span> overlaps[i]<span class="op">;</span></span>
<span id="cb10-1050"><a href="#cb10-1050" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (current<span class="op">.</span><span class="at">sets</span><span class="op">.</span><span class="at">length</span> <span class="op">!==</span> <span class="dv">2</span>) {</span>
<span id="cb10-1051"><a href="#cb10-1051" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb10-1052"><a href="#cb10-1052" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1053"><a href="#cb10-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1054"><a href="#cb10-1054" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> left <span class="op">=</span> current<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]<span class="op">,</span> right <span class="op">=</span> current<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb10-1055"><a href="#cb10-1055" aria-hidden="true" tabindex="-1"></a>            setOverlaps[left]<span class="op">.</span><span class="fu">push</span> ({<span class="kw">set</span><span class="op">:</span>right<span class="op">,</span> <span class="dt">size</span><span class="op">:</span>current<span class="op">.</span><span class="at">size</span>})<span class="op">;</span></span>
<span id="cb10-1056"><a href="#cb10-1056" aria-hidden="true" tabindex="-1"></a>            setOverlaps[right]<span class="op">.</span><span class="fu">push</span>({<span class="kw">set</span><span class="op">:</span>left<span class="op">,</span>  <span class="dt">size</span><span class="op">:</span>current<span class="op">.</span><span class="at">size</span>})<span class="op">;</span></span>
<span id="cb10-1057"><a href="#cb10-1057" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1058"><a href="#cb10-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1059"><a href="#cb10-1059" aria-hidden="true" tabindex="-1"></a>        <span class="co">// get list of most overlapped sets</span></span>
<span id="cb10-1060"><a href="#cb10-1060" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> mostOverlapped <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb10-1061"><a href="#cb10-1061" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> <span class="kw">set</span> <span class="kw">in</span> setOverlaps) {</span>
<span id="cb10-1062"><a href="#cb10-1062" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (setOverlaps<span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="kw">set</span>)) {</span>
<span id="cb10-1063"><a href="#cb10-1063" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> size <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-1064"><a href="#cb10-1064" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> setOverlaps[<span class="kw">set</span>]<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1065"><a href="#cb10-1065" aria-hidden="true" tabindex="-1"></a>                    size <span class="op">+=</span> setOverlaps[<span class="kw">set</span>][i]<span class="op">.</span><span class="at">size</span><span class="op">;</span></span>
<span id="cb10-1066"><a href="#cb10-1066" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1067"><a href="#cb10-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1068"><a href="#cb10-1068" aria-hidden="true" tabindex="-1"></a>                mostOverlapped<span class="op">.</span><span class="fu">push</span>({<span class="kw">set</span><span class="op">:</span> <span class="kw">set</span><span class="op">,</span> <span class="dt">size</span><span class="op">:</span>size})<span class="op">;</span></span>
<span id="cb10-1069"><a href="#cb10-1069" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1070"><a href="#cb10-1070" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1071"><a href="#cb10-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1072"><a href="#cb10-1072" aria-hidden="true" tabindex="-1"></a>        <span class="co">// sort by size desc</span></span>
<span id="cb10-1073"><a href="#cb10-1073" aria-hidden="true" tabindex="-1"></a>        <span class="kw">function</span> <span class="fu">sortOrder</span>(a<span class="op">,</span>b) {</span>
<span id="cb10-1074"><a href="#cb10-1074" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> b<span class="op">.</span><span class="at">size</span> <span class="op">-</span> a<span class="op">.</span><span class="at">size</span><span class="op">;</span></span>
<span id="cb10-1075"><a href="#cb10-1075" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1076"><a href="#cb10-1076" aria-hidden="true" tabindex="-1"></a>        mostOverlapped<span class="op">.</span><span class="fu">sort</span>(sortOrder)<span class="op">;</span></span>
<span id="cb10-1077"><a href="#cb10-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1078"><a href="#cb10-1078" aria-hidden="true" tabindex="-1"></a>        <span class="co">// keep track of what sets have been laid out</span></span>
<span id="cb10-1079"><a href="#cb10-1079" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> positioned <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb10-1080"><a href="#cb10-1080" aria-hidden="true" tabindex="-1"></a>        <span class="kw">function</span> <span class="fu">isPositioned</span>(element) {</span>
<span id="cb10-1081"><a href="#cb10-1081" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> element<span class="op">.</span><span class="at">set</span> <span class="kw">in</span> positioned<span class="op">;</span></span>
<span id="cb10-1082"><a href="#cb10-1082" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1083"><a href="#cb10-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1084"><a href="#cb10-1084" aria-hidden="true" tabindex="-1"></a>        <span class="co">// adds a point to the output</span></span>
<span id="cb10-1085"><a href="#cb10-1085" aria-hidden="true" tabindex="-1"></a>        <span class="kw">function</span> <span class="fu">positionSet</span>(point<span class="op">,</span> index) {</span>
<span id="cb10-1086"><a href="#cb10-1086" aria-hidden="true" tabindex="-1"></a>            sets[index]<span class="op">.</span><span class="at">x</span> <span class="op">=</span> point<span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb10-1087"><a href="#cb10-1087" aria-hidden="true" tabindex="-1"></a>            sets[index]<span class="op">.</span><span class="at">y</span> <span class="op">=</span> point<span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb10-1088"><a href="#cb10-1088" aria-hidden="true" tabindex="-1"></a>            positioned[index] <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb10-1089"><a href="#cb10-1089" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1090"><a href="#cb10-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1091"><a href="#cb10-1091" aria-hidden="true" tabindex="-1"></a>        <span class="co">// add most overlapped set at (0,0)</span></span>
<span id="cb10-1092"><a href="#cb10-1092" aria-hidden="true" tabindex="-1"></a>        <span class="fu">positionSet</span>({<span class="dt">x</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span>}<span class="op">,</span> mostOverlapped[<span class="dv">0</span>]<span class="op">.</span><span class="at">set</span>)<span class="op">;</span></span>
<span id="cb10-1093"><a href="#cb10-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1094"><a href="#cb10-1094" aria-hidden="true" tabindex="-1"></a>        <span class="co">// get distances between all points</span></span>
<span id="cb10-1095"><a href="#cb10-1095" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> distances <span class="op">=</span> venn<span class="op">.</span><span class="fu">getDistanceMatrix</span>(sets<span class="op">,</span> overlaps)<span class="op">;</span></span>
<span id="cb10-1096"><a href="#cb10-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1097"><a href="#cb10-1097" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> mostOverlapped<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1098"><a href="#cb10-1098" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> setIndex <span class="op">=</span> mostOverlapped[i]<span class="op">.</span><span class="at">set</span><span class="op">,</span></span>
<span id="cb10-1099"><a href="#cb10-1099" aria-hidden="true" tabindex="-1"></a>                overlap <span class="op">=</span> setOverlaps[setIndex]<span class="op">.</span><span class="fu">filter</span>(isPositioned)<span class="op">;</span></span>
<span id="cb10-1100"><a href="#cb10-1100" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> <span class="op">=</span> sets[setIndex]<span class="op">;</span></span>
<span id="cb10-1101"><a href="#cb10-1101" aria-hidden="true" tabindex="-1"></a>            overlap<span class="op">.</span><span class="fu">sort</span>(sortOrder)<span class="op">;</span></span>
<span id="cb10-1102"><a href="#cb10-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1103"><a href="#cb10-1103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (overlap<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb10-1104"><a href="#cb10-1104" aria-hidden="true" tabindex="-1"></a>                <span class="cf">throw</span> <span class="st">"Need overlap information for set "</span> <span class="op">+</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>( <span class="kw">set</span> )<span class="op">;</span></span>
<span id="cb10-1105"><a href="#cb10-1105" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1106"><a href="#cb10-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1107"><a href="#cb10-1107" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> points <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb10-1108"><a href="#cb10-1108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> overlap<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>j) {</span>
<span id="cb10-1109"><a href="#cb10-1109" aria-hidden="true" tabindex="-1"></a>                <span class="co">// get appropriate distance from most overlapped already added set</span></span>
<span id="cb10-1110"><a href="#cb10-1110" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> p1 <span class="op">=</span> sets[overlap[j]<span class="op">.</span><span class="at">set</span>]<span class="op">,</span></span>
<span id="cb10-1111"><a href="#cb10-1111" aria-hidden="true" tabindex="-1"></a>                    d1 <span class="op">=</span> distances[setIndex][overlap[j]<span class="op">.</span><span class="at">set</span>]<span class="op">;</span></span>
<span id="cb10-1112"><a href="#cb10-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1113"><a href="#cb10-1113" aria-hidden="true" tabindex="-1"></a>                <span class="co">// sample positions at 90 degrees for maximum aesthetics</span></span>
<span id="cb10-1114"><a href="#cb10-1114" aria-hidden="true" tabindex="-1"></a>                points<span class="op">.</span><span class="fu">push</span>({<span class="dt">x</span> <span class="op">:</span> p1<span class="op">.</span><span class="at">x</span> <span class="op">+</span> d1<span class="op">,</span> <span class="dt">y</span> <span class="op">:</span> p1<span class="op">.</span><span class="at">y</span>})<span class="op">;</span></span>
<span id="cb10-1115"><a href="#cb10-1115" aria-hidden="true" tabindex="-1"></a>                points<span class="op">.</span><span class="fu">push</span>({<span class="dt">x</span> <span class="op">:</span> p1<span class="op">.</span><span class="at">x</span> <span class="op">-</span> d1<span class="op">,</span> <span class="dt">y</span> <span class="op">:</span> p1<span class="op">.</span><span class="at">y</span>})<span class="op">;</span></span>
<span id="cb10-1116"><a href="#cb10-1116" aria-hidden="true" tabindex="-1"></a>                points<span class="op">.</span><span class="fu">push</span>({<span class="dt">y</span> <span class="op">:</span> p1<span class="op">.</span><span class="at">y</span> <span class="op">+</span> d1<span class="op">,</span> <span class="dt">x</span> <span class="op">:</span> p1<span class="op">.</span><span class="at">x</span>})<span class="op">;</span></span>
<span id="cb10-1117"><a href="#cb10-1117" aria-hidden="true" tabindex="-1"></a>                points<span class="op">.</span><span class="fu">push</span>({<span class="dt">y</span> <span class="op">:</span> p1<span class="op">.</span><span class="at">y</span> <span class="op">-</span> d1<span class="op">,</span> <span class="dt">x</span> <span class="op">:</span> p1<span class="op">.</span><span class="at">x</span>})<span class="op">;</span></span>
<span id="cb10-1118"><a href="#cb10-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1119"><a href="#cb10-1119" aria-hidden="true" tabindex="-1"></a>                <span class="co">// if we have at least 2 overlaps, then figure out where the</span></span>
<span id="cb10-1120"><a href="#cb10-1120" aria-hidden="true" tabindex="-1"></a>                <span class="co">// set should be positioned analytically and try those too</span></span>
<span id="cb10-1121"><a href="#cb10-1121" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> (<span class="kw">var</span> k <span class="op">=</span> j <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> k <span class="op">&lt;</span> overlap<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>k) {</span>
<span id="cb10-1122"><a href="#cb10-1122" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">var</span> p2 <span class="op">=</span> sets[overlap[k]<span class="op">.</span><span class="at">set</span>]<span class="op">,</span></span>
<span id="cb10-1123"><a href="#cb10-1123" aria-hidden="true" tabindex="-1"></a>                        d2 <span class="op">=</span> distances[setIndex][overlap[k]<span class="op">.</span><span class="at">set</span>]<span class="op">;</span></span>
<span id="cb10-1124"><a href="#cb10-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1125"><a href="#cb10-1125" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">var</span> extraPoints <span class="op">=</span> circleIntersection<span class="op">.</span><span class="fu">circleCircleIntersection</span>(</span>
<span id="cb10-1126"><a href="#cb10-1126" aria-hidden="true" tabindex="-1"></a>                        { <span class="dt">x</span><span class="op">:</span> p1<span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> p1<span class="op">.</span><span class="at">y</span><span class="op">,</span> <span class="dt">radius</span><span class="op">:</span> d1}<span class="op">,</span></span>
<span id="cb10-1127"><a href="#cb10-1127" aria-hidden="true" tabindex="-1"></a>                        { <span class="dt">x</span><span class="op">:</span> p2<span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> p2<span class="op">.</span><span class="at">y</span><span class="op">,</span> <span class="dt">radius</span><span class="op">:</span> d2})<span class="op">;</span></span>
<span id="cb10-1128"><a href="#cb10-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1129"><a href="#cb10-1129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> (<span class="kw">var</span> l <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> l <span class="op">&lt;</span> extraPoints<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>l) {</span>
<span id="cb10-1130"><a href="#cb10-1130" aria-hidden="true" tabindex="-1"></a>                        points<span class="op">.</span><span class="fu">push</span>(extraPoints[l])<span class="op">;</span></span>
<span id="cb10-1131"><a href="#cb10-1131" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb10-1132"><a href="#cb10-1132" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1133"><a href="#cb10-1133" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1134"><a href="#cb10-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1135"><a href="#cb10-1135" aria-hidden="true" tabindex="-1"></a>            <span class="co">// we have some candidate positions for the set, examine loss</span></span>
<span id="cb10-1136"><a href="#cb10-1136" aria-hidden="true" tabindex="-1"></a>            <span class="co">// at each position to figure out where to put it at</span></span>
<span id="cb10-1137"><a href="#cb10-1137" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> bestLoss <span class="op">=</span> <span class="fl">1e50</span><span class="op">,</span> bestPoint <span class="op">=</span> points[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb10-1138"><a href="#cb10-1138" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> points<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>j) {</span>
<span id="cb10-1139"><a href="#cb10-1139" aria-hidden="true" tabindex="-1"></a>                sets[setIndex]<span class="op">.</span><span class="at">x</span> <span class="op">=</span> points[j]<span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb10-1140"><a href="#cb10-1140" aria-hidden="true" tabindex="-1"></a>                sets[setIndex]<span class="op">.</span><span class="at">y</span> <span class="op">=</span> points[j]<span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb10-1141"><a href="#cb10-1141" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> loss <span class="op">=</span> venn<span class="op">.</span><span class="fu">lossFunction</span>(sets<span class="op">,</span> overlaps)<span class="op">;</span></span>
<span id="cb10-1142"><a href="#cb10-1142" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (loss <span class="op">&lt;</span> bestLoss) {</span>
<span id="cb10-1143"><a href="#cb10-1143" aria-hidden="true" tabindex="-1"></a>                    bestLoss <span class="op">=</span> loss<span class="op">;</span></span>
<span id="cb10-1144"><a href="#cb10-1144" aria-hidden="true" tabindex="-1"></a>                    bestPoint <span class="op">=</span> points[j]<span class="op">;</span></span>
<span id="cb10-1145"><a href="#cb10-1145" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1146"><a href="#cb10-1146" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1147"><a href="#cb10-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1148"><a href="#cb10-1148" aria-hidden="true" tabindex="-1"></a>            <span class="fu">positionSet</span>(bestPoint<span class="op">,</span> setIndex)<span class="op">;</span></span>
<span id="cb10-1149"><a href="#cb10-1149" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1150"><a href="#cb10-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1151"><a href="#cb10-1151" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sets<span class="op">;</span></span>
<span id="cb10-1152"><a href="#cb10-1152" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1153"><a href="#cb10-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1154"><a href="#cb10-1154" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Uses multidimensional scaling to approximate a first layout here</span></span>
<span id="cb10-1155"><a href="#cb10-1155" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">classicMDSLayout</span> <span class="op">=</span> <span class="kw">function</span>(sets<span class="op">,</span> overlaps) {</span>
<span id="cb10-1156"><a href="#cb10-1156" aria-hidden="true" tabindex="-1"></a>        <span class="co">// get the distance matrix</span></span>
<span id="cb10-1157"><a href="#cb10-1157" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> distances <span class="op">=</span> venn<span class="op">.</span><span class="fu">getDistanceMatrix</span>(sets<span class="op">,</span> overlaps)<span class="op">;</span></span>
<span id="cb10-1158"><a href="#cb10-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1159"><a href="#cb10-1159" aria-hidden="true" tabindex="-1"></a>        <span class="co">// get positions for each set</span></span>
<span id="cb10-1160"><a href="#cb10-1160" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> positions <span class="op">=</span> mds<span class="op">.</span><span class="fu">classic</span>(distances)<span class="op">;</span></span>
<span id="cb10-1161"><a href="#cb10-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1162"><a href="#cb10-1162" aria-hidden="true" tabindex="-1"></a>        <span class="co">// translate back to (x,y,radius) coordinates</span></span>
<span id="cb10-1163"><a href="#cb10-1163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> sets<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1164"><a href="#cb10-1164" aria-hidden="true" tabindex="-1"></a>            sets[i]<span class="op">.</span><span class="at">x</span> <span class="op">=</span> positions[i][<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb10-1165"><a href="#cb10-1165" aria-hidden="true" tabindex="-1"></a>            sets[i]<span class="op">.</span><span class="at">y</span> <span class="op">=</span> positions[i][<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb10-1166"><a href="#cb10-1166" aria-hidden="true" tabindex="-1"></a>            sets[i]<span class="op">.</span><span class="at">radius</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(sets[i]<span class="op">.</span><span class="at">size</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)<span class="op">;</span></span>
<span id="cb10-1167"><a href="#cb10-1167" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1168"><a href="#cb10-1168" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sets<span class="op">;</span></span>
<span id="cb10-1169"><a href="#cb10-1169" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1170"><a href="#cb10-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1171"><a href="#cb10-1171" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Given a bunch of sets, and the desired overlaps between these sets - computes</span></span>
<span id="cb10-1172"><a href="#cb10-1172" aria-hidden="true" tabindex="-1"></a><span class="co">    the distance from the actual overlaps to the desired overlaps. Note that</span></span>
<span id="cb10-1173"><a href="#cb10-1173" aria-hidden="true" tabindex="-1"></a><span class="co">    this method ignores overlaps of more than 2 circles */</span></span>
<span id="cb10-1174"><a href="#cb10-1174" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">lossFunction</span> <span class="op">=</span> <span class="kw">function</span>(sets<span class="op">,</span> overlaps) {</span>
<span id="cb10-1175"><a href="#cb10-1175" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> output <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-1176"><a href="#cb10-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1177"><a href="#cb10-1177" aria-hidden="true" tabindex="-1"></a>        <span class="kw">function</span> <span class="fu">getCircles</span>(indices) {</span>
<span id="cb10-1178"><a href="#cb10-1178" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> indices<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(i) { <span class="cf">return</span> sets[i]<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb10-1179"><a href="#cb10-1179" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1180"><a href="#cb10-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1181"><a href="#cb10-1181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> overlaps<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1182"><a href="#cb10-1182" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> area <span class="op">=</span> overlaps[i]<span class="op">,</span> overlap<span class="op">;</span></span>
<span id="cb10-1183"><a href="#cb10-1183" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (area<span class="op">.</span><span class="at">sets</span><span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">2</span>) {</span>
<span id="cb10-1184"><a href="#cb10-1184" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> left <span class="op">=</span> sets[area<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]]<span class="op">,</span></span>
<span id="cb10-1185"><a href="#cb10-1185" aria-hidden="true" tabindex="-1"></a>                    right <span class="op">=</span> sets[area<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]]<span class="op">;</span></span>
<span id="cb10-1186"><a href="#cb10-1186" aria-hidden="true" tabindex="-1"></a>                overlap <span class="op">=</span> circleIntersection<span class="op">.</span><span class="fu">circleOverlap</span>(left<span class="op">.</span><span class="at">radius</span><span class="op">,</span> right<span class="op">.</span><span class="at">radius</span><span class="op">,</span></span>
<span id="cb10-1187"><a href="#cb10-1187" aria-hidden="true" tabindex="-1"></a>                                circleIntersection<span class="op">.</span><span class="fu">distance</span>(left<span class="op">,</span> right))<span class="op">;</span></span>
<span id="cb10-1188"><a href="#cb10-1188" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb10-1189"><a href="#cb10-1189" aria-hidden="true" tabindex="-1"></a>                overlap <span class="op">=</span> circleIntersection<span class="op">.</span><span class="fu">intersectionArea</span>(<span class="fu">getCircles</span>(area<span class="op">.</span><span class="at">sets</span>))<span class="op">;</span></span>
<span id="cb10-1190"><a href="#cb10-1190" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1191"><a href="#cb10-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1192"><a href="#cb10-1192" aria-hidden="true" tabindex="-1"></a>            output <span class="op">+=</span> (overlap <span class="op">-</span> area<span class="op">.</span><span class="at">size</span>) <span class="op">*</span> (overlap <span class="op">-</span> area<span class="op">.</span><span class="at">size</span>)<span class="op">;</span></span>
<span id="cb10-1193"><a href="#cb10-1193" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1194"><a href="#cb10-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1195"><a href="#cb10-1195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> output<span class="op">;</span></span>
<span id="cb10-1196"><a href="#cb10-1196" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1197"><a href="#cb10-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1198"><a href="#cb10-1198" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Scales a solution from venn.venn or venn.greedyLayout such that it fits in</span></span>
<span id="cb10-1199"><a href="#cb10-1199" aria-hidden="true" tabindex="-1"></a><span class="co">    a rectangle of width/height - with padding around the borders. */</span></span>
<span id="cb10-1200"><a href="#cb10-1200" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">scaleSolution</span> <span class="op">=</span> <span class="kw">function</span>(solution<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> padding) {</span>
<span id="cb10-1201"><a href="#cb10-1201" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> minMax <span class="op">=</span> <span class="kw">function</span>(d) {</span>
<span id="cb10-1202"><a href="#cb10-1202" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> hi <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span><span class="op">.</span><span class="fu">apply</span>(<span class="kw">null</span><span class="op">,</span> solution<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb10-1203"><a href="#cb10-1203" aria-hidden="true" tabindex="-1"></a>                                    <span class="kw">function</span>(c) { <span class="cf">return</span> c[d] <span class="op">+</span> c<span class="op">.</span><span class="at">radius</span><span class="op">;</span> } ))<span class="op">,</span></span>
<span id="cb10-1204"><a href="#cb10-1204" aria-hidden="true" tabindex="-1"></a>                lo <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span><span class="op">.</span><span class="fu">apply</span>(<span class="kw">null</span><span class="op">,</span> solution<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb10-1205"><a href="#cb10-1205" aria-hidden="true" tabindex="-1"></a>                                    <span class="kw">function</span>(c) { <span class="cf">return</span> c[d] <span class="op">-</span> c<span class="op">.</span><span class="at">radius</span><span class="op">;</span>} ))<span class="op">;</span></span>
<span id="cb10-1206"><a href="#cb10-1206" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="dt">max</span><span class="op">:</span>hi<span class="op">,</span> <span class="dt">min</span><span class="op">:</span>lo}<span class="op">;</span></span>
<span id="cb10-1207"><a href="#cb10-1207" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb10-1208"><a href="#cb10-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1209"><a href="#cb10-1209" aria-hidden="true" tabindex="-1"></a>        width <span class="op">-=</span> <span class="dv">2</span><span class="op">*</span>padding<span class="op">;</span></span>
<span id="cb10-1210"><a href="#cb10-1210" aria-hidden="true" tabindex="-1"></a>        height <span class="op">-=</span> <span class="dv">2</span><span class="op">*</span>padding<span class="op">;</span></span>
<span id="cb10-1211"><a href="#cb10-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1212"><a href="#cb10-1212" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> xRange <span class="op">=</span> <span class="fu">minMax</span>(<span class="st">'x'</span>)<span class="op">,</span></span>
<span id="cb10-1213"><a href="#cb10-1213" aria-hidden="true" tabindex="-1"></a>            yRange <span class="op">=</span> <span class="fu">minMax</span>(<span class="st">'y'</span>)<span class="op">,</span></span>
<span id="cb10-1214"><a href="#cb10-1214" aria-hidden="true" tabindex="-1"></a>            xScaling <span class="op">=</span> width  <span class="op">/</span> (xRange<span class="op">.</span><span class="at">max</span> <span class="op">-</span> xRange<span class="op">.</span><span class="at">min</span>)<span class="op">,</span></span>
<span id="cb10-1215"><a href="#cb10-1215" aria-hidden="true" tabindex="-1"></a>            yScaling <span class="op">=</span> height <span class="op">/</span> (yRange<span class="op">.</span><span class="at">max</span> <span class="op">-</span> yRange<span class="op">.</span><span class="at">min</span>)<span class="op">,</span></span>
<span id="cb10-1216"><a href="#cb10-1216" aria-hidden="true" tabindex="-1"></a>            scaling <span class="op">=</span>  <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(yScaling<span class="op">,</span> xScaling)<span class="op">;</span></span>
<span id="cb10-1217"><a href="#cb10-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1218"><a href="#cb10-1218" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> solution<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1219"><a href="#cb10-1219" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> <span class="kw">set</span> <span class="op">=</span> solution[i]<span class="op">;</span></span>
<span id="cb10-1220"><a href="#cb10-1220" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span><span class="op">.</span><span class="at">radius</span> <span class="op">=</span> scaling <span class="op">*</span> <span class="kw">set</span><span class="op">.</span><span class="at">radius</span><span class="op">;</span></span>
<span id="cb10-1221"><a href="#cb10-1221" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span><span class="op">.</span><span class="at">x</span> <span class="op">=</span> padding <span class="op">+</span> (<span class="kw">set</span><span class="op">.</span><span class="at">x</span> <span class="op">-</span> xRange<span class="op">.</span><span class="at">min</span>) <span class="op">*</span> scaling<span class="op">;</span></span>
<span id="cb10-1222"><a href="#cb10-1222" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span><span class="op">.</span><span class="at">y</span> <span class="op">=</span> padding <span class="op">+</span> (<span class="kw">set</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> yRange<span class="op">.</span><span class="at">min</span>) <span class="op">*</span> scaling<span class="op">;</span></span>
<span id="cb10-1223"><a href="#cb10-1223" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1224"><a href="#cb10-1224" aria-hidden="true" tabindex="-1"></a>        solution<span class="op">.</span><span class="at">scaling</span> <span class="op">=</span> scaling<span class="op">;</span></span>
<span id="cb10-1225"><a href="#cb10-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1226"><a href="#cb10-1226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> solution<span class="op">;</span></span>
<span id="cb10-1227"><a href="#cb10-1227" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1228"><a href="#cb10-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1229"><a href="#cb10-1229" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">weightedSum</span>(a<span class="op">,</span> b) {</span>
<span id="cb10-1230"><a href="#cb10-1230" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> ret <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(a[<span class="dv">1</span>]<span class="op">.</span><span class="at">length</span> <span class="op">||</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb10-1231"><a href="#cb10-1231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> ret<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>j) {</span>
<span id="cb10-1232"><a href="#cb10-1232" aria-hidden="true" tabindex="-1"></a>            ret[j] <span class="op">=</span> a[<span class="dv">0</span>] <span class="op">*</span> a[<span class="dv">1</span>][j] <span class="op">+</span> b[<span class="dv">0</span>] <span class="op">*</span> b[<span class="dv">1</span>][j]<span class="op">;</span></span>
<span id="cb10-1233"><a href="#cb10-1233" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1234"><a href="#cb10-1234" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb10-1235"><a href="#cb10-1235" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-1236"><a href="#cb10-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1237"><a href="#cb10-1237" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">centerVennDiagram</span>( diagram<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> padding ) {</span>
<span id="cb10-1238"><a href="#cb10-1238" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> diagramBoundaries<span class="op">;</span></span>
<span id="cb10-1239"><a href="#cb10-1239" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> allowedWidth <span class="op">=</span> width <span class="op">-</span> ( <span class="dv">2</span> <span class="op">*</span> ( padding <span class="op">||</span> <span class="dv">10</span> ) )<span class="op">;</span></span>
<span id="cb10-1240"><a href="#cb10-1240" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> allowedHeight <span class="op">=</span> height <span class="op">-</span> ( <span class="dv">2</span> <span class="op">*</span> ( padding <span class="op">||</span> <span class="dv">10</span> ) )<span class="op">;</span></span>
<span id="cb10-1241"><a href="#cb10-1241" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> scale<span class="op">;</span></span>
<span id="cb10-1242"><a href="#cb10-1242" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> transformX<span class="op">,</span> transformY<span class="op">;</span></span>
<span id="cb10-1243"><a href="#cb10-1243" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> transform <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb10-1244"><a href="#cb10-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1245"><a href="#cb10-1245" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ( diagram ) {</span>
<span id="cb10-1246"><a href="#cb10-1246" aria-hidden="true" tabindex="-1"></a>            diagramBoundaries <span class="op">=</span> diagram[ <span class="dv">0</span> ][ <span class="dv">0</span> ]<span class="op">.</span><span class="fu">getBBox</span>()<span class="op">;</span></span>
<span id="cb10-1247"><a href="#cb10-1247" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> ( diagramBoundaries <span class="op">&amp;&amp;</span> width <span class="op">&amp;&amp;</span> height ) {</span>
<span id="cb10-1248"><a href="#cb10-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1249"><a href="#cb10-1249" aria-hidden="true" tabindex="-1"></a>                <span class="co">//  See if we need to scale to fit the width/height</span></span>
<span id="cb10-1250"><a href="#cb10-1250" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ( diagramBoundaries<span class="op">.</span><span class="at">width</span> <span class="op">&gt;</span> allowedWidth ) {</span>
<span id="cb10-1251"><a href="#cb10-1251" aria-hidden="true" tabindex="-1"></a>                    scale <span class="op">=</span> allowedWidth <span class="op">/</span> diagramBoundaries<span class="op">.</span><span class="at">width</span><span class="op">;</span></span>
<span id="cb10-1252"><a href="#cb10-1252" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1253"><a href="#cb10-1253" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ( diagramBoundaries<span class="op">.</span><span class="at">height</span> <span class="op">&gt;</span> allowedHeight ) {</span>
<span id="cb10-1254"><a href="#cb10-1254" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> ( <span class="op">!</span>scale <span class="op">||</span> ( allowedHeight <span class="op">/</span> diagramBoundaries<span class="op">.</span><span class="at">height</span> ) <span class="op">&lt;</span> scale ) {</span>
<span id="cb10-1255"><a href="#cb10-1255" aria-hidden="true" tabindex="-1"></a>                        scale <span class="op">=</span> allowedHeight <span class="op">/</span> diagramBoundaries<span class="op">.</span><span class="at">height</span><span class="op">;</span></span>
<span id="cb10-1256"><a href="#cb10-1256" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb10-1257"><a href="#cb10-1257" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1258"><a href="#cb10-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1259"><a href="#cb10-1259" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ( scale ) {</span>
<span id="cb10-1260"><a href="#cb10-1260" aria-hidden="true" tabindex="-1"></a>                    transform <span class="op">=</span> <span class="st">"scale("</span> <span class="op">+</span> scale <span class="op">+</span> <span class="st">")"</span><span class="op">;</span></span>
<span id="cb10-1261"><a href="#cb10-1261" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1262"><a href="#cb10-1262" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> {</span>
<span id="cb10-1263"><a href="#cb10-1263" aria-hidden="true" tabindex="-1"></a>                    scale <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-1264"><a href="#cb10-1264" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1265"><a href="#cb10-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1266"><a href="#cb10-1266" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-1267"><a href="#cb10-1267" aria-hidden="true" tabindex="-1"></a>              <span class="kw">let</span> vennWidth <span class="op">=</span> (data<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]<span class="op">.</span><span class="at">x</span> <span class="op">-</span> data<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">x</span>) <span class="op">+</span>  data<span class="op">.</span><span class="at">sets</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">radius</span> <span class="op">+</span> data<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]<span class="op">.</span><span class="at">radius</span></span>
<span id="cb10-1268"><a href="#cb10-1268" aria-hidden="true" tabindex="-1"></a>              transformX <span class="op">=</span> hRect <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> vennWidth <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb10-1269"><a href="#cb10-1269" aria-hidden="true" tabindex="-1"></a>              transformY <span class="op">=</span> wRect <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> data<span class="op">.</span><span class="at">sets</span>[<span class="dv">1</span>]<span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb10-1270"><a href="#cb10-1270" aria-hidden="true" tabindex="-1"></a>                diagram<span class="op">.</span><span class="fu">attr</span>( <span class="st">"transform"</span><span class="op">,</span> <span class="st">"translate("</span> <span class="op">+</span> transformX <span class="op">+</span> <span class="st">","</span>  <span class="op">+</span> transformY <span class="op">+</span> <span class="st">") "</span> <span class="op">+</span> transform )<span class="op">;</span></span>
<span id="cb10-1271"><a href="#cb10-1271" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1272"><a href="#cb10-1272" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1273"><a href="#cb10-1273" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-1274"><a href="#cb10-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1275"><a href="#cb10-1275" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** finds the zeros of a function, given two starting points (which must</span></span>
<span id="cb10-1276"><a href="#cb10-1276" aria-hidden="true" tabindex="-1"></a><span class="co">     * have opposite signs */</span></span>
<span id="cb10-1277"><a href="#cb10-1277" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">bisect</span> <span class="op">=</span> <span class="kw">function</span>(f<span class="op">,</span> a<span class="op">,</span> b<span class="op">,</span> parameters) {</span>
<span id="cb10-1278"><a href="#cb10-1278" aria-hidden="true" tabindex="-1"></a>        parameters <span class="op">=</span> parameters <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb10-1279"><a href="#cb10-1279" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> maxIterations <span class="op">=</span> parameters<span class="op">.</span><span class="at">maxIterations</span> <span class="op">||</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb10-1280"><a href="#cb10-1280" aria-hidden="true" tabindex="-1"></a>            tolerance <span class="op">=</span> parameters<span class="op">.</span><span class="at">tolerance</span> <span class="op">||</span> <span class="fl">1e-10</span><span class="op">,</span></span>
<span id="cb10-1281"><a href="#cb10-1281" aria-hidden="true" tabindex="-1"></a>            fA <span class="op">=</span> <span class="fu">f</span>(a)<span class="op">,</span></span>
<span id="cb10-1282"><a href="#cb10-1282" aria-hidden="true" tabindex="-1"></a>            fB <span class="op">=</span> <span class="fu">f</span>(b)<span class="op">,</span></span>
<span id="cb10-1283"><a href="#cb10-1283" aria-hidden="true" tabindex="-1"></a>            delta <span class="op">=</span> b <span class="op">-</span> a<span class="op">;</span></span>
<span id="cb10-1284"><a href="#cb10-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1285"><a href="#cb10-1285" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (fA <span class="op">*</span> fB <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb10-1286"><a href="#cb10-1286" aria-hidden="true" tabindex="-1"></a>            <span class="cf">throw</span> <span class="st">"Initial bisect points must have opposite signs"</span><span class="op">;</span></span>
<span id="cb10-1287"><a href="#cb10-1287" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1288"><a href="#cb10-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1289"><a href="#cb10-1289" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (fA <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb10-1290"><a href="#cb10-1290" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (fB <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> b<span class="op">;</span></span>
<span id="cb10-1291"><a href="#cb10-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1292"><a href="#cb10-1292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> maxIterations<span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1293"><a href="#cb10-1293" aria-hidden="true" tabindex="-1"></a>            delta <span class="op">/=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb10-1294"><a href="#cb10-1294" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> mid <span class="op">=</span> a <span class="op">+</span> delta<span class="op">,</span></span>
<span id="cb10-1295"><a href="#cb10-1295" aria-hidden="true" tabindex="-1"></a>                fMid <span class="op">=</span> <span class="fu">f</span>(mid)<span class="op">;</span></span>
<span id="cb10-1296"><a href="#cb10-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1297"><a href="#cb10-1297" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (fMid <span class="op">*</span> fA <span class="op">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb10-1298"><a href="#cb10-1298" aria-hidden="true" tabindex="-1"></a>                a <span class="op">=</span> mid<span class="op">;</span></span>
<span id="cb10-1299"><a href="#cb10-1299" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1300"><a href="#cb10-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1301"><a href="#cb10-1301" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> ((<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(delta) <span class="op">&lt;</span> tolerance) <span class="op">||</span> (fMid <span class="op">===</span> <span class="dv">0</span>)) {</span>
<span id="cb10-1302"><a href="#cb10-1302" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> mid<span class="op">;</span></span>
<span id="cb10-1303"><a href="#cb10-1303" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1304"><a href="#cb10-1304" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1305"><a href="#cb10-1305" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">+</span> delta<span class="op">;</span></span>
<span id="cb10-1306"><a href="#cb10-1306" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1307"><a href="#cb10-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1308"><a href="#cb10-1308" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** minimizes a function using the downhill simplex method */</span></span>
<span id="cb10-1309"><a href="#cb10-1309" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">fmin</span> <span class="op">=</span> <span class="kw">function</span>(f<span class="op">,</span> x0<span class="op">,</span> parameters) {</span>
<span id="cb10-1310"><a href="#cb10-1310" aria-hidden="true" tabindex="-1"></a>        parameters <span class="op">=</span> parameters <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb10-1311"><a href="#cb10-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1312"><a href="#cb10-1312" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> maxIterations <span class="op">=</span> parameters<span class="op">.</span><span class="at">maxIterations</span> <span class="op">||</span> x0<span class="op">.</span><span class="at">length</span> <span class="op">*</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb10-1313"><a href="#cb10-1313" aria-hidden="true" tabindex="-1"></a>            nonZeroDelta <span class="op">=</span> parameters<span class="op">.</span><span class="at">nonZeroDelta</span> <span class="op">||</span> <span class="fl">1.1</span><span class="op">,</span></span>
<span id="cb10-1314"><a href="#cb10-1314" aria-hidden="true" tabindex="-1"></a>            zeroDelta <span class="op">=</span> parameters<span class="op">.</span><span class="at">zeroDelta</span> <span class="op">||</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb10-1315"><a href="#cb10-1315" aria-hidden="true" tabindex="-1"></a>            minErrorDelta <span class="op">=</span> parameters<span class="op">.</span><span class="at">minErrorDelta</span> <span class="op">||</span> <span class="fl">1e-5</span><span class="op">,</span></span>
<span id="cb10-1316"><a href="#cb10-1316" aria-hidden="true" tabindex="-1"></a>            rho <span class="op">=</span> parameters<span class="op">.</span><span class="at">rho</span> <span class="op">||</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-1317"><a href="#cb10-1317" aria-hidden="true" tabindex="-1"></a>            chi <span class="op">=</span> parameters<span class="op">.</span><span class="at">chi</span> <span class="op">||</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb10-1318"><a href="#cb10-1318" aria-hidden="true" tabindex="-1"></a>            psi <span class="op">=</span> parameters<span class="op">.</span><span class="at">psi</span> <span class="op">||</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb10-1319"><a href="#cb10-1319" aria-hidden="true" tabindex="-1"></a>            sigma <span class="op">=</span> parameters<span class="op">.</span><span class="at">sigma</span> <span class="op">||</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb10-1320"><a href="#cb10-1320" aria-hidden="true" tabindex="-1"></a>            callback <span class="op">=</span> parameters<span class="op">.</span><span class="at">callback</span><span class="op">;</span></span>
<span id="cb10-1321"><a href="#cb10-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1322"><a href="#cb10-1322" aria-hidden="true" tabindex="-1"></a>        <span class="co">// initialize simplex.</span></span>
<span id="cb10-1323"><a href="#cb10-1323" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> N <span class="op">=</span> x0<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb10-1324"><a href="#cb10-1324" aria-hidden="true" tabindex="-1"></a>            simplex <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(N <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb10-1325"><a href="#cb10-1325" aria-hidden="true" tabindex="-1"></a>        simplex[<span class="dv">0</span>] <span class="op">=</span> x0<span class="op">;</span></span>
<span id="cb10-1326"><a href="#cb10-1326" aria-hidden="true" tabindex="-1"></a>        simplex[<span class="dv">0</span>]<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="fu">f</span>(x0)<span class="op">;</span></span>
<span id="cb10-1327"><a href="#cb10-1327" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1328"><a href="#cb10-1328" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> point <span class="op">=</span> x0<span class="op">.</span><span class="fu">slice</span>()<span class="op">;</span></span>
<span id="cb10-1329"><a href="#cb10-1329" aria-hidden="true" tabindex="-1"></a>            point[i] <span class="op">=</span> point[i] <span class="op">?</span> point[i] <span class="op">*</span> nonZeroDelta <span class="op">:</span> zeroDelta<span class="op">;</span></span>
<span id="cb10-1330"><a href="#cb10-1330" aria-hidden="true" tabindex="-1"></a>            simplex[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> point<span class="op">;</span></span>
<span id="cb10-1331"><a href="#cb10-1331" aria-hidden="true" tabindex="-1"></a>            simplex[i<span class="op">+</span><span class="dv">1</span>]<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="fu">f</span>(point)<span class="op">;</span></span>
<span id="cb10-1332"><a href="#cb10-1332" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1333"><a href="#cb10-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1334"><a href="#cb10-1334" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> sortOrder <span class="op">=</span> <span class="kw">function</span>(a<span class="op">,</span> b) { <span class="cf">return</span> a<span class="op">.</span><span class="at">fx</span> <span class="op">-</span> b<span class="op">.</span><span class="at">fx</span><span class="op">;</span> }<span class="op">;</span></span>
<span id="cb10-1335"><a href="#cb10-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1336"><a href="#cb10-1336" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> iteration <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> iteration <span class="op">&lt;</span> maxIterations<span class="op">;</span> <span class="op">++</span>iteration) {</span>
<span id="cb10-1337"><a href="#cb10-1337" aria-hidden="true" tabindex="-1"></a>            simplex<span class="op">.</span><span class="fu">sort</span>(sortOrder)<span class="op">;</span></span>
<span id="cb10-1338"><a href="#cb10-1338" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (callback) {</span>
<span id="cb10-1339"><a href="#cb10-1339" aria-hidden="true" tabindex="-1"></a>                <span class="fu">callback</span>(simplex)<span class="op">;</span></span>
<span id="cb10-1340"><a href="#cb10-1340" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1341"><a href="#cb10-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1342"><a href="#cb10-1342" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(simplex[<span class="dv">0</span>]<span class="op">.</span><span class="at">fx</span> <span class="op">-</span> simplex[N]<span class="op">.</span><span class="at">fx</span>) <span class="op">&lt;</span> minErrorDelta) {</span>
<span id="cb10-1343"><a href="#cb10-1343" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb10-1344"><a href="#cb10-1344" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1345"><a href="#cb10-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1346"><a href="#cb10-1346" aria-hidden="true" tabindex="-1"></a>            <span class="co">// compute the centroid of all but the worst point in the simplex</span></span>
<span id="cb10-1347"><a href="#cb10-1347" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> centroid <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(N)<span class="op">;</span></span>
<span id="cb10-1348"><a href="#cb10-1348" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1349"><a href="#cb10-1349" aria-hidden="true" tabindex="-1"></a>                centroid[i] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-1350"><a href="#cb10-1350" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> N<span class="op">;</span> <span class="op">++</span>j) {</span>
<span id="cb10-1351"><a href="#cb10-1351" aria-hidden="true" tabindex="-1"></a>                    centroid[i] <span class="op">+=</span> simplex[j][i]<span class="op">;</span></span>
<span id="cb10-1352"><a href="#cb10-1352" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1353"><a href="#cb10-1353" aria-hidden="true" tabindex="-1"></a>                centroid[i] <span class="op">/=</span> N<span class="op">;</span></span>
<span id="cb10-1354"><a href="#cb10-1354" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1355"><a href="#cb10-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1356"><a href="#cb10-1356" aria-hidden="true" tabindex="-1"></a>            <span class="co">// reflect the worst point past the centroid  and compute loss at reflected</span></span>
<span id="cb10-1357"><a href="#cb10-1357" aria-hidden="true" tabindex="-1"></a>            <span class="co">// point</span></span>
<span id="cb10-1358"><a href="#cb10-1358" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> worst <span class="op">=</span> simplex[N]<span class="op">;</span></span>
<span id="cb10-1359"><a href="#cb10-1359" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> reflected <span class="op">=</span> <span class="fu">weightedSum</span>([<span class="dv">1</span><span class="op">+</span>rho<span class="op">,</span> centroid]<span class="op">,</span> [<span class="op">-</span>rho<span class="op">,</span> worst])<span class="op">;</span></span>
<span id="cb10-1360"><a href="#cb10-1360" aria-hidden="true" tabindex="-1"></a>            reflected<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="fu">f</span>(reflected)<span class="op">;</span></span>
<span id="cb10-1361"><a href="#cb10-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1362"><a href="#cb10-1362" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> replacement <span class="op">=</span> reflected<span class="op">;</span></span>
<span id="cb10-1363"><a href="#cb10-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1364"><a href="#cb10-1364" aria-hidden="true" tabindex="-1"></a>            <span class="co">// if the reflected point is the best seen, then possibly expand</span></span>
<span id="cb10-1365"><a href="#cb10-1365" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (reflected<span class="op">.</span><span class="at">fx</span> <span class="op">&lt;=</span> simplex[<span class="dv">0</span>]<span class="op">.</span><span class="at">fx</span>) {</span>
<span id="cb10-1366"><a href="#cb10-1366" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> expanded <span class="op">=</span> <span class="fu">weightedSum</span>([<span class="dv">1</span><span class="op">+</span>chi<span class="op">,</span> centroid]<span class="op">,</span> [<span class="op">-</span>chi<span class="op">,</span> worst])<span class="op">;</span></span>
<span id="cb10-1367"><a href="#cb10-1367" aria-hidden="true" tabindex="-1"></a>                expanded<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="fu">f</span>(expanded)<span class="op">;</span></span>
<span id="cb10-1368"><a href="#cb10-1368" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (expanded<span class="op">.</span><span class="at">fx</span> <span class="op">&lt;</span> reflected<span class="op">.</span><span class="at">fx</span>) {</span>
<span id="cb10-1369"><a href="#cb10-1369" aria-hidden="true" tabindex="-1"></a>                    replacement <span class="op">=</span> expanded<span class="op">;</span></span>
<span id="cb10-1370"><a href="#cb10-1370" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1371"><a href="#cb10-1371" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1372"><a href="#cb10-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1373"><a href="#cb10-1373" aria-hidden="true" tabindex="-1"></a>            <span class="co">// if the reflected point is worse than the second worst, we need to</span></span>
<span id="cb10-1374"><a href="#cb10-1374" aria-hidden="true" tabindex="-1"></a>            <span class="co">// contract</span></span>
<span id="cb10-1375"><a href="#cb10-1375" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> (reflected<span class="op">.</span><span class="at">fx</span> <span class="op">&gt;=</span> simplex[N<span class="op">-</span><span class="dv">1</span>]<span class="op">.</span><span class="at">fx</span>) {</span>
<span id="cb10-1376"><a href="#cb10-1376" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> shouldReduce <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb10-1377"><a href="#cb10-1377" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> contracted<span class="op">;</span></span>
<span id="cb10-1378"><a href="#cb10-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1379"><a href="#cb10-1379" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (reflected<span class="op">.</span><span class="at">fx</span> <span class="op">&lt;=</span> worst<span class="op">.</span><span class="at">fx</span>) {</span>
<span id="cb10-1380"><a href="#cb10-1380" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// do an inside contraction</span></span>
<span id="cb10-1381"><a href="#cb10-1381" aria-hidden="true" tabindex="-1"></a>                    contracted <span class="op">=</span> <span class="fu">weightedSum</span>([<span class="dv">1</span><span class="op">+</span>psi<span class="op">,</span> centroid]<span class="op">,</span> [<span class="op">-</span>psi<span class="op">,</span> worst])<span class="op">;</span></span>
<span id="cb10-1382"><a href="#cb10-1382" aria-hidden="true" tabindex="-1"></a>                    contracted<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="fu">f</span>(contracted)<span class="op">;</span></span>
<span id="cb10-1383"><a href="#cb10-1383" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (contracted<span class="op">.</span><span class="at">fx</span> <span class="op">&lt;</span> worst<span class="op">.</span><span class="at">fx</span>) {</span>
<span id="cb10-1384"><a href="#cb10-1384" aria-hidden="true" tabindex="-1"></a>                        replacement <span class="op">=</span> contracted<span class="op">;</span></span>
<span id="cb10-1385"><a href="#cb10-1385" aria-hidden="true" tabindex="-1"></a>                    } <span class="cf">else</span> {</span>
<span id="cb10-1386"><a href="#cb10-1386" aria-hidden="true" tabindex="-1"></a>                        shouldReduce <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb10-1387"><a href="#cb10-1387" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb10-1388"><a href="#cb10-1388" aria-hidden="true" tabindex="-1"></a>                } <span class="cf">else</span> {</span>
<span id="cb10-1389"><a href="#cb10-1389" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// do an outside contraction</span></span>
<span id="cb10-1390"><a href="#cb10-1390" aria-hidden="true" tabindex="-1"></a>                    contracted <span class="op">=</span> <span class="fu">weightedSum</span>([<span class="dv">1</span><span class="op">-</span>psi <span class="op">*</span> rho<span class="op">,</span> centroid]<span class="op">,</span> [psi<span class="op">*</span>rho<span class="op">,</span> worst])<span class="op">;</span></span>
<span id="cb10-1391"><a href="#cb10-1391" aria-hidden="true" tabindex="-1"></a>                    contracted<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="fu">f</span>(contracted)<span class="op">;</span></span>
<span id="cb10-1392"><a href="#cb10-1392" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (contracted<span class="op">.</span><span class="at">fx</span> <span class="op">&lt;=</span> reflected<span class="op">.</span><span class="at">fx</span>) {</span>
<span id="cb10-1393"><a href="#cb10-1393" aria-hidden="true" tabindex="-1"></a>                        replacement <span class="op">=</span> contracted<span class="op">;</span></span>
<span id="cb10-1394"><a href="#cb10-1394" aria-hidden="true" tabindex="-1"></a>                    } <span class="cf">else</span> {</span>
<span id="cb10-1395"><a href="#cb10-1395" aria-hidden="true" tabindex="-1"></a>                        shouldReduce <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb10-1396"><a href="#cb10-1396" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb10-1397"><a href="#cb10-1397" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1398"><a href="#cb10-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1399"><a href="#cb10-1399" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (shouldReduce) {</span>
<span id="cb10-1400"><a href="#cb10-1400" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// do reduction. doesn't actually happen that often</span></span>
<span id="cb10-1401"><a href="#cb10-1401" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> simplex<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1402"><a href="#cb10-1402" aria-hidden="true" tabindex="-1"></a>                        simplex[i] <span class="op">=</span> <span class="fu">weightedSum</span>([<span class="dv">1</span> <span class="op">-</span> sigma<span class="op">,</span> simplex[<span class="dv">0</span>]]<span class="op">,</span></span>
<span id="cb10-1403"><a href="#cb10-1403" aria-hidden="true" tabindex="-1"></a>                                                 [sigma <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> simplex[i]])<span class="op">;</span></span>
<span id="cb10-1404"><a href="#cb10-1404" aria-hidden="true" tabindex="-1"></a>                        simplex[i]<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="fu">f</span>(simplex[i])<span class="op">;</span></span>
<span id="cb10-1405"><a href="#cb10-1405" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb10-1406"><a href="#cb10-1406" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-1407"><a href="#cb10-1407" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1408"><a href="#cb10-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1409"><a href="#cb10-1409" aria-hidden="true" tabindex="-1"></a>            simplex[N] <span class="op">=</span> replacement<span class="op">;</span></span>
<span id="cb10-1410"><a href="#cb10-1410" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1411"><a href="#cb10-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1412"><a href="#cb10-1412" aria-hidden="true" tabindex="-1"></a>        simplex<span class="op">.</span><span class="fu">sort</span>(sortOrder)<span class="op">;</span></span>
<span id="cb10-1413"><a href="#cb10-1413" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="dt">f</span> <span class="op">:</span> simplex[<span class="dv">0</span>]<span class="op">.</span><span class="at">fx</span><span class="op">,</span></span>
<span id="cb10-1414"><a href="#cb10-1414" aria-hidden="true" tabindex="-1"></a>                <span class="dt">solution</span> <span class="op">:</span> simplex[<span class="dv">0</span>]}<span class="op">;</span></span>
<span id="cb10-1415"><a href="#cb10-1415" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1416"><a href="#cb10-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1417"><a href="#cb10-1417" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** returns a svg path of the intersection area of a bunch of circles */</span></span>
<span id="cb10-1418"><a href="#cb10-1418" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">intersectionAreaPath</span> <span class="op">=</span> <span class="kw">function</span>(circles) {</span>
<span id="cb10-1419"><a href="#cb10-1419" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> stats <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb10-1420"><a href="#cb10-1420" aria-hidden="true" tabindex="-1"></a>        circleIntersection<span class="op">.</span><span class="fu">intersectionArea</span>(circles<span class="op">,</span> stats)<span class="op">;</span></span>
<span id="cb10-1421"><a href="#cb10-1421" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> arcs <span class="op">=</span> stats<span class="op">.</span><span class="at">arcs</span><span class="op">;</span></span>
<span id="cb10-1422"><a href="#cb10-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1423"><a href="#cb10-1423" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (arcs<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb10-1424"><a href="#cb10-1424" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"M 0 0"</span><span class="op">;</span></span>
<span id="cb10-1425"><a href="#cb10-1425" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1426"><a href="#cb10-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1427"><a href="#cb10-1427" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> ret <span class="op">=</span> [<span class="st">"</span><span class="sc">\n</span><span class="st">M"</span><span class="op">,</span> arcs[<span class="dv">0</span>]<span class="op">.</span><span class="at">p2</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> arcs[<span class="dv">0</span>]<span class="op">.</span><span class="at">p2</span><span class="op">.</span><span class="at">y</span>]<span class="op">;</span></span>
<span id="cb10-1428"><a href="#cb10-1428" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> arcs<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1429"><a href="#cb10-1429" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> arc <span class="op">=</span> arcs[i]<span class="op">,</span> r <span class="op">=</span> arc<span class="op">.</span><span class="at">circle</span><span class="op">.</span><span class="at">radius</span><span class="op">,</span> wide <span class="op">=</span> arc<span class="op">.</span><span class="at">width</span> <span class="op">&gt;</span> r<span class="op">;</span></span>
<span id="cb10-1430"><a href="#cb10-1430" aria-hidden="true" tabindex="-1"></a>            ret<span class="op">.</span><span class="fu">push</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">A"</span><span class="op">,</span> r<span class="op">,</span> r<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wide <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> arc<span class="op">.</span><span class="at">p1</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> arc<span class="op">.</span><span class="at">p1</span><span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb10-1431"><a href="#cb10-1431" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1432"><a href="#cb10-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1433"><a href="#cb10-1433" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb10-1434"><a href="#cb10-1434" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-1435"><a href="#cb10-1435" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-1436"><a href="#cb10-1436" aria-hidden="true" tabindex="-1"></a>     venn<span class="op">.</span><span class="at">intersectionAreaSplitPath</span> <span class="op">=</span> <span class="kw">function</span>(circles<span class="op">,</span> isRightPath<span class="op">,</span> isLeftPath) {</span>
<span id="cb10-1437"><a href="#cb10-1437" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> stats <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb10-1438"><a href="#cb10-1438" aria-hidden="true" tabindex="-1"></a>        circleIntersection<span class="op">.</span><span class="fu">intersectionArea</span>(circles<span class="op">,</span> stats)<span class="op">;</span></span>
<span id="cb10-1439"><a href="#cb10-1439" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> arcs <span class="op">=</span> stats<span class="op">.</span><span class="at">arcs</span><span class="op">;</span></span>
<span id="cb10-1440"><a href="#cb10-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1441"><a href="#cb10-1441" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (arcs<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb10-1442"><a href="#cb10-1442" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"M 0 0"</span><span class="op">;</span></span>
<span id="cb10-1443"><a href="#cb10-1443" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1444"><a href="#cb10-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1445"><a href="#cb10-1445" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> ret <span class="op">=</span> [<span class="st">"</span><span class="sc">\n</span><span class="st">M"</span><span class="op">,</span> arcs[<span class="dv">0</span>]<span class="op">.</span><span class="at">p2</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> arcs[<span class="dv">0</span>]<span class="op">.</span><span class="at">p2</span><span class="op">.</span><span class="at">y</span>]<span class="op">;</span></span>
<span id="cb10-1446"><a href="#cb10-1446" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> arcs<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb10-1447"><a href="#cb10-1447" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> arc <span class="op">=</span> arcs[i]<span class="op">,</span> r <span class="op">=</span> arc<span class="op">.</span><span class="at">circle</span><span class="op">.</span><span class="at">radius</span><span class="op">,</span> wide <span class="op">=</span> arc<span class="op">.</span><span class="at">width</span> <span class="op">&gt;</span> r<span class="op">;</span></span>
<span id="cb10-1448"><a href="#cb10-1448" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>( (i<span class="op">==</span><span class="dv">1</span> <span class="op">&amp;&amp;</span> isRightPath) <span class="op">||</span> (i<span class="op">==</span><span class="dv">0</span> <span class="op">&amp;&amp;</span> isLeftPath)){</span>
<span id="cb10-1449"><a href="#cb10-1449" aria-hidden="true" tabindex="-1"></a>              ret<span class="op">.</span><span class="fu">push</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">A"</span><span class="op">,</span> r<span class="op">,</span> r<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wide <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> arc<span class="op">.</span><span class="at">p1</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> arc<span class="op">.</span><span class="at">p1</span><span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb10-1450"><a href="#cb10-1450" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1451"><a href="#cb10-1451" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>{</span>
<span id="cb10-1452"><a href="#cb10-1452" aria-hidden="true" tabindex="-1"></a>              ret<span class="op">.</span><span class="fu">push</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">A"</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wide <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> arc<span class="op">.</span><span class="at">p1</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> arc<span class="op">.</span><span class="at">p1</span><span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb10-1453"><a href="#cb10-1453" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-1454"><a href="#cb10-1454" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb10-1455"><a href="#cb10-1455" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-1456"><a href="#cb10-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1457"><a href="#cb10-1457" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb10-1458"><a href="#cb10-1458" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-1459"><a href="#cb10-1459" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-1460"><a href="#cb10-1460" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">drawD3Diagram</span> <span class="op">=</span> <span class="kw">function</span>(element<span class="op">,</span> dataset<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> parameters) {</span>
<span id="cb10-1461"><a href="#cb10-1461" aria-hidden="true" tabindex="-1"></a>        parameters <span class="op">=</span> parameters <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb10-1462"><a href="#cb10-1462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1463"><a href="#cb10-1463" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> colours <span class="op">=</span> d3<span class="op">.</span><span class="at">scale</span><span class="op">.</span><span class="fu">category10</span>()<span class="op">,</span></span>
<span id="cb10-1464"><a href="#cb10-1464" aria-hidden="true" tabindex="-1"></a>            circleFillColours <span class="op">=</span> parameters<span class="op">.</span><span class="at">circleFillColours</span> <span class="op">||</span> colours<span class="op">,</span></span>
<span id="cb10-1465"><a href="#cb10-1465" aria-hidden="true" tabindex="-1"></a>            circleStrokeColours <span class="op">=</span> parameters<span class="op">.</span><span class="at">circleStrokeColours</span> <span class="op">||</span> circleFillColours<span class="op">,</span></span>
<span id="cb10-1466"><a href="#cb10-1466" aria-hidden="true" tabindex="-1"></a>            circleStrokeWidth <span class="op">=</span> parameters<span class="op">.</span><span class="at">circleStrokeWidth</span> <span class="op">||</span> <span class="kw">function</span>(i) { <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> }<span class="op">,</span></span>
<span id="cb10-1467"><a href="#cb10-1467" aria-hidden="true" tabindex="-1"></a>            textFillColours <span class="op">=</span> parameters<span class="op">.</span><span class="at">textFillColours</span> <span class="op">||</span> colours<span class="op">,</span></span>
<span id="cb10-1468"><a href="#cb10-1468" aria-hidden="true" tabindex="-1"></a>            textStrokeColours <span class="op">=</span> parameters<span class="op">.</span><span class="at">textStrokeColours</span> <span class="op">||</span> textFillColours<span class="op">,</span></span>
<span id="cb10-1469"><a href="#cb10-1469" aria-hidden="true" tabindex="-1"></a>            nodeOpacity <span class="op">=</span> parameters<span class="op">.</span><span class="at">opacity</span> <span class="op">||</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb10-1470"><a href="#cb10-1470" aria-hidden="true" tabindex="-1"></a>            padding <span class="op">=</span> parameters<span class="op">.</span><span class="at">padding</span> <span class="op">||</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb10-1471"><a href="#cb10-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1472"><a href="#cb10-1472" aria-hidden="true" tabindex="-1"></a>        dataset <span class="op">=</span> venn<span class="op">.</span><span class="fu">scaleSolution</span>(dataset<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> padding)<span class="op">;</span></span>
<span id="cb10-1473"><a href="#cb10-1473" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> svg <span class="op">=</span> element<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">'id'</span><span class="op">,</span> <span class="st">'svg-wrapper'</span>)<span class="op">;</span></span>
<span id="cb10-1474"><a href="#cb10-1474" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> diagram <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>( <span class="st">"g"</span> )<span class="op">.</span><span class="fu">attr</span>(<span class="st">'id'</span><span class="op">,</span> <span class="st">'union-all'</span>)<span class="op">;</span></span>
<span id="cb10-1475"><a href="#cb10-1475" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> nodes <span class="op">=</span> diagram<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"g"</span>)</span>
<span id="cb10-1476"><a href="#cb10-1476" aria-hidden="true" tabindex="-1"></a>                         <span class="op">.</span><span class="fu">data</span>(dataset<span class="op">,</span> <span class="kw">function</span>(d) {</span>
<span id="cb10-1477"><a href="#cb10-1477" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">return</span> d<span class="op">.</span><span class="at">label</span><span class="op">;</span></span>
<span id="cb10-1478"><a href="#cb10-1478" aria-hidden="true" tabindex="-1"></a>                         })<span class="op">;</span></span>
<span id="cb10-1479"><a href="#cb10-1479" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> nodeEnter <span class="op">=</span> nodes<span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb10-1480"><a href="#cb10-1480" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"transition: opacity 2s"</span>)</span>
<span id="cb10-1481"><a href="#cb10-1481" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'node'</span>)<span class="op">;</span></span>
<span id="cb10-1482"><a href="#cb10-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1483"><a href="#cb10-1483" aria-hidden="true" tabindex="-1"></a>        nodeEnter<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span>  <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="vs">`circle-</span><span class="sc">${</span>d<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">`</span> })</span>
<span id="cb10-1484"><a href="#cb10-1484" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span>  <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">radius</span><span class="op">;</span> })</span>
<span id="cb10-1485"><a href="#cb10-1485" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> nodeOpacity)</span>
<span id="cb10-1486"><a href="#cb10-1486" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">x</span><span class="op">;</span> })</span>
<span id="cb10-1487"><a href="#cb10-1487" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">y</span><span class="op">;</span> })</span>
<span id="cb10-1488"><a href="#cb10-1488" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">circleStrokeColours</span>(i)<span class="op">;</span> })</span>
<span id="cb10-1489"><a href="#cb10-1489" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">circleStrokeWidth</span>(i)<span class="op">;</span> })</span>
<span id="cb10-1490"><a href="#cb10-1490" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">circleFillColours</span>(i)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb10-1491"><a href="#cb10-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1492"><a href="#cb10-1492" aria-hidden="true" tabindex="-1"></a>        nodeEnter<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb10-1493"><a href="#cb10-1493" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">radius</span> <span class="op">+</span> <span class="dv">20</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">3</span> <span class="op">+</span> i <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span>  <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">3</span>)<span class="op">;</span> })</span>
<span id="cb10-1494"><a href="#cb10-1494" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> d<span class="op">.</span><span class="at">y</span> <span class="op">-</span> (d<span class="op">.</span><span class="at">radius</span> <span class="op">+</span> <span class="dv">20</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">3</span> <span class="op">+</span> i <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span>  <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">3</span>)<span class="op">;</span> })</span>
<span id="cb10-1495"><a href="#cb10-1495" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb10-1496"><a href="#cb10-1496" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"0.35em"</span>)</span>
<span id="cb10-1497"><a href="#cb10-1497" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize)</span>
<span id="cb10-1498"><a href="#cb10-1498" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">textStrokeColours</span>(i)<span class="op">;</span> })</span>
<span id="cb10-1499"><a href="#cb10-1499" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">textFillColours</span>(i)<span class="op">;</span> })</span>
<span id="cb10-1500"><a href="#cb10-1500" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">text</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">label</span><span class="op">;</span> })<span class="op">;</span></span>
<span id="cb10-1501"><a href="#cb10-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1502"><a href="#cb10-1502" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> circles <span class="op">=</span> nodes<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)<span class="op">;</span></span>
<span id="cb10-1503"><a href="#cb10-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1504"><a href="#cb10-1504" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> text <span class="op">=</span> nodes<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)<span class="op">;</span></span>
<span id="cb10-1505"><a href="#cb10-1505" aria-hidden="true" tabindex="-1"></a>        <span class="fu">centerVennDiagram</span>( diagram<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> padding )<span class="op">;</span></span>
<span id="cb10-1506"><a href="#cb10-1506" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">'svg'</span> <span class="op">:</span> svg<span class="op">,</span></span>
<span id="cb10-1507"><a href="#cb10-1507" aria-hidden="true" tabindex="-1"></a>                <span class="st">'nodes'</span> <span class="op">:</span> nodes<span class="op">,</span></span>
<span id="cb10-1508"><a href="#cb10-1508" aria-hidden="true" tabindex="-1"></a>                <span class="st">'circles'</span> <span class="op">:</span> circles<span class="op">,</span></span>
<span id="cb10-1509"><a href="#cb10-1509" aria-hidden="true" tabindex="-1"></a>                <span class="st">'text'</span> <span class="op">:</span> text }<span class="op">;</span></span>
<span id="cb10-1510"><a href="#cb10-1510" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1511"><a href="#cb10-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1512"><a href="#cb10-1512" aria-hidden="true" tabindex="-1"></a>    venn<span class="op">.</span><span class="at">updateD3Diagram</span> <span class="op">=</span> <span class="kw">function</span>(element<span class="op">,</span> dataset<span class="op">,</span> parameters) {</span>
<span id="cb10-1513"><a href="#cb10-1513" aria-hidden="true" tabindex="-1"></a>        parameters <span class="op">=</span> parameters <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb10-1514"><a href="#cb10-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1515"><a href="#cb10-1515" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> colours <span class="op">=</span> d3<span class="op">.</span><span class="at">scale</span><span class="op">.</span><span class="fu">category10</span>()<span class="op">,</span></span>
<span id="cb10-1516"><a href="#cb10-1516" aria-hidden="true" tabindex="-1"></a>            circleFillColours <span class="op">=</span> parameters<span class="op">.</span><span class="at">circleFillColours</span> <span class="op">||</span> colours<span class="op">,</span></span>
<span id="cb10-1517"><a href="#cb10-1517" aria-hidden="true" tabindex="-1"></a>            circleStrokeColours <span class="op">=</span> parameters<span class="op">.</span><span class="at">circleStrokeColours</span> <span class="op">||</span> circleFillColours<span class="op">,</span></span>
<span id="cb10-1518"><a href="#cb10-1518" aria-hidden="true" tabindex="-1"></a>            circleStrokeWidth <span class="op">=</span> parameters<span class="op">.</span><span class="at">circleStrokeWidth</span> <span class="op">||</span> <span class="kw">function</span>(i) { <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> }<span class="op">,</span></span>
<span id="cb10-1519"><a href="#cb10-1519" aria-hidden="true" tabindex="-1"></a>            textFillColours <span class="op">=</span> parameters<span class="op">.</span><span class="at">textFillColours</span> <span class="op">||</span> colours<span class="op">,</span></span>
<span id="cb10-1520"><a href="#cb10-1520" aria-hidden="true" tabindex="-1"></a>            textStrokeColours <span class="op">=</span> parameters<span class="op">.</span><span class="at">textStrokeColours</span> <span class="op">||</span> textFillColours<span class="op">,</span></span>
<span id="cb10-1521"><a href="#cb10-1521" aria-hidden="true" tabindex="-1"></a>            nodeOpacity <span class="op">=</span> parameters<span class="op">.</span><span class="at">opacity</span> <span class="op">||</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb10-1522"><a href="#cb10-1522" aria-hidden="true" tabindex="-1"></a>            padding <span class="op">=</span> parameters<span class="op">.</span><span class="at">padding</span> <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-1523"><a href="#cb10-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1524"><a href="#cb10-1524" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> svg <span class="op">=</span> element<span class="op">.</span><span class="fu">select</span>(<span class="st">"svg"</span>)<span class="op">,</span></span>
<span id="cb10-1525"><a href="#cb10-1525" aria-hidden="true" tabindex="-1"></a>            width <span class="op">=</span> <span class="pp">parseInt</span>(svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span>)<span class="op">,</span> <span class="dv">10</span>)<span class="op">,</span></span>
<span id="cb10-1526"><a href="#cb10-1526" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> <span class="pp">parseInt</span>(svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span>)<span class="op">,</span> <span class="dv">10</span>)<span class="op">,</span></span>
<span id="cb10-1527"><a href="#cb10-1527" aria-hidden="true" tabindex="-1"></a>            circles<span class="op">,</span> texts<span class="op">;</span></span>
<span id="cb10-1528"><a href="#cb10-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1529"><a href="#cb10-1529" aria-hidden="true" tabindex="-1"></a>        dataset <span class="op">=</span> venn<span class="op">.</span><span class="fu">scaleSolution</span>(dataset<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb10-1530"><a href="#cb10-1530" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> nodes <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">'g'</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">'g'</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"g.node"</span>)</span>
<span id="cb10-1531"><a href="#cb10-1531" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">data</span>(dataset<span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">label</span><span class="op">;</span> })<span class="op">;</span></span>
<span id="cb10-1532"><a href="#cb10-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1533"><a href="#cb10-1533" aria-hidden="true" tabindex="-1"></a>        nodes<span class="op">.</span><span class="fu">exit</span>()<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb10-1534"><a href="#cb10-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1535"><a href="#cb10-1535" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> nodeEnter <span class="op">=</span> nodes<span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb10-1536"><a href="#cb10-1536" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-1537"><a href="#cb10-1537" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'node'</span>)<span class="op">;</span></span>
<span id="cb10-1538"><a href="#cb10-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1539"><a href="#cb10-1539" aria-hidden="true" tabindex="-1"></a>        nodeEnter<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb10-1540"><a href="#cb10-1540" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> nodeOpacity)</span>
<span id="cb10-1541"><a href="#cb10-1541" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">circleStrokeColours</span>(i)<span class="op">;</span> })</span>
<span id="cb10-1542"><a href="#cb10-1542" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">circleStrokeWidth</span>(i)<span class="op">;</span> })</span>
<span id="cb10-1543"><a href="#cb10-1543" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">circleFillColours</span>(i)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb10-1544"><a href="#cb10-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1545"><a href="#cb10-1545" aria-hidden="true" tabindex="-1"></a>        nodeEnter<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb10-1546"><a href="#cb10-1546" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb10-1547"><a href="#cb10-1547" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"0.35em"</span>)</span>
<span id="cb10-1548"><a href="#cb10-1548" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize)</span>
<span id="cb10-1549"><a href="#cb10-1549" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">textStrokeColours</span>(i)<span class="op">;</span> })</span>
<span id="cb10-1550"><a href="#cb10-1550" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i) { <span class="cf">return</span> <span class="fu">textFillColours</span>(i)<span class="op">;</span> })</span>
<span id="cb10-1551"><a href="#cb10-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1552"><a href="#cb10-1552" aria-hidden="true" tabindex="-1"></a>        nodes<span class="op">.</span><span class="fu">select</span>(<span class="st">"circle"</span>)</span>
<span id="cb10-1553"><a href="#cb10-1553" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb10-1554"><a href="#cb10-1554" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">duration</span>(<span class="dv">400</span>)</span>
<span id="cb10-1555"><a href="#cb10-1555" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">x</span><span class="op">;</span> })</span>
<span id="cb10-1556"><a href="#cb10-1556" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">y</span><span class="op">;</span> })</span>
<span id="cb10-1557"><a href="#cb10-1557" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span>  <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">radius</span><span class="op">;</span> })<span class="op">;</span></span>
<span id="cb10-1558"><a href="#cb10-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1559"><a href="#cb10-1559" aria-hidden="true" tabindex="-1"></a>        nodes<span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb10-1560"><a href="#cb10-1560" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb10-1561"><a href="#cb10-1561" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">duration</span>(<span class="dv">400</span>)</span>
<span id="cb10-1562"><a href="#cb10-1562" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">text</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">label</span><span class="op">;</span> })</span>
<span id="cb10-1563"><a href="#cb10-1563" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize)</span>
<span id="cb10-1564"><a href="#cb10-1564" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">x</span><span class="op">;</span> })</span>
<span id="cb10-1565"><a href="#cb10-1565" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">y</span><span class="op">;</span> })<span class="op">;</span></span>
<span id="cb10-1566"><a href="#cb10-1566" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-1567"><a href="#cb10-1567" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-1568"><a href="#cb10-1568" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> venn<span class="op">;</span></span>
<span id="cb10-1569"><a href="#cb10-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1570"><a href="#cb10-1570" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="1577" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1576;"><span id="cb11-1577"><a href="#cb11-1577" aria-hidden="true" tabindex="-1"></a>circleIntersection <span class="op">=</span> {</span>
<span id="cb11-1578"><a href="#cb11-1578" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> circleIntersection <span class="op">=</span> {}</span>
<span id="cb11-1579"><a href="#cb11-1579" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> SMALL <span class="op">=</span> <span class="fl">1e-10</span><span class="op">;</span></span>
<span id="cb11-1580"><a href="#cb11-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1581"><a href="#cb11-1581" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Returns the intersection area of a bunch of circles (where each circle</span></span>
<span id="cb11-1582"><a href="#cb11-1582" aria-hidden="true" tabindex="-1"></a><span class="co">     is an object having an x,y and radius property) */</span></span>
<span id="cb11-1583"><a href="#cb11-1583" aria-hidden="true" tabindex="-1"></a>    circleIntersection<span class="op">.</span><span class="at">intersectionArea</span> <span class="op">=</span> <span class="kw">function</span>(circles<span class="op">,</span> stats) {</span>
<span id="cb11-1584"><a href="#cb11-1584" aria-hidden="true" tabindex="-1"></a>        <span class="co">// get all the intersection points of the circles</span></span>
<span id="cb11-1585"><a href="#cb11-1585" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> intersectionPoints <span class="op">=</span> <span class="fu">getIntersectionPoints</span>(circles)<span class="op">;</span></span>
<span id="cb11-1586"><a href="#cb11-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1587"><a href="#cb11-1587" aria-hidden="true" tabindex="-1"></a>        <span class="co">// filter out points that aren't included in all the circles</span></span>
<span id="cb11-1588"><a href="#cb11-1588" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> innerPoints <span class="op">=</span> intersectionPoints<span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span> (p) {</span>
<span id="cb11-1589"><a href="#cb11-1589" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> circleIntersection<span class="op">.</span><span class="fu">containedInCircles</span>(p<span class="op">,</span> circles)<span class="op">;</span></span>
<span id="cb11-1590"><a href="#cb11-1590" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb11-1591"><a href="#cb11-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1592"><a href="#cb11-1592" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> arcArea <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> polygonArea <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> arcs <span class="op">=</span> []<span class="op">,</span> i<span class="op">;</span></span>
<span id="cb11-1593"><a href="#cb11-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1594"><a href="#cb11-1594" aria-hidden="true" tabindex="-1"></a>        <span class="co">// if we have intersection points that are within all the circles,</span></span>
<span id="cb11-1595"><a href="#cb11-1595" aria-hidden="true" tabindex="-1"></a>        <span class="co">// then figure out the area contained by them</span></span>
<span id="cb11-1596"><a href="#cb11-1596" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (innerPoints<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb11-1597"><a href="#cb11-1597" aria-hidden="true" tabindex="-1"></a>            <span class="co">// sort the points by angle from the center of the polygon, which lets</span></span>
<span id="cb11-1598"><a href="#cb11-1598" aria-hidden="true" tabindex="-1"></a>            <span class="co">// us just iterate over points to get the edges</span></span>
<span id="cb11-1599"><a href="#cb11-1599" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> center <span class="op">=</span> circleIntersection<span class="op">.</span><span class="fu">getCenter</span>(innerPoints)<span class="op">;</span></span>
<span id="cb11-1600"><a href="#cb11-1600" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> innerPoints<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i ) {</span>
<span id="cb11-1601"><a href="#cb11-1601" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> p <span class="op">=</span> innerPoints[i]<span class="op">;</span></span>
<span id="cb11-1602"><a href="#cb11-1602" aria-hidden="true" tabindex="-1"></a>                p<span class="op">.</span><span class="at">angle</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan2</span>(p<span class="op">.</span><span class="at">x</span> <span class="op">-</span> center<span class="op">.</span><span class="at">x</span><span class="op">,</span> p<span class="op">.</span><span class="at">y</span> <span class="op">-</span> center<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb11-1603"><a href="#cb11-1603" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-1604"><a href="#cb11-1604" aria-hidden="true" tabindex="-1"></a>            innerPoints<span class="op">.</span><span class="fu">sort</span>(<span class="kw">function</span>(a<span class="op">,</span>b) { <span class="cf">return</span> b<span class="op">.</span><span class="at">angle</span> <span class="op">-</span> a<span class="op">.</span><span class="at">angle</span><span class="op">;</span>})<span class="op">;</span></span>
<span id="cb11-1605"><a href="#cb11-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1606"><a href="#cb11-1606" aria-hidden="true" tabindex="-1"></a>            <span class="co">// iterate over all points, get arc between the points</span></span>
<span id="cb11-1607"><a href="#cb11-1607" aria-hidden="true" tabindex="-1"></a>            <span class="co">// and update the areas</span></span>
<span id="cb11-1608"><a href="#cb11-1608" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> p2 <span class="op">=</span> innerPoints[innerPoints<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb11-1609"><a href="#cb11-1609" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> innerPoints<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb11-1610"><a href="#cb11-1610" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> p1 <span class="op">=</span> innerPoints[i]<span class="op">;</span></span>
<span id="cb11-1611"><a href="#cb11-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1612"><a href="#cb11-1612" aria-hidden="true" tabindex="-1"></a>                <span class="co">// polygon area updates easily ...</span></span>
<span id="cb11-1613"><a href="#cb11-1613" aria-hidden="true" tabindex="-1"></a>                polygonArea <span class="op">+=</span> (p2<span class="op">.</span><span class="at">x</span> <span class="op">+</span> p1<span class="op">.</span><span class="at">x</span>) <span class="op">*</span> (p1<span class="op">.</span><span class="at">y</span> <span class="op">-</span> p2<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb11-1614"><a href="#cb11-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1615"><a href="#cb11-1615" aria-hidden="true" tabindex="-1"></a>                <span class="co">// updating the arc area is a little more involved</span></span>
<span id="cb11-1616"><a href="#cb11-1616" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> midPoint <span class="op">=</span> {<span class="dt">x</span> <span class="op">:</span> (p1<span class="op">.</span><span class="at">x</span> <span class="op">+</span> p2<span class="op">.</span><span class="at">x</span>) <span class="op">/</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb11-1617"><a href="#cb11-1617" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">y</span> <span class="op">:</span> (p1<span class="op">.</span><span class="at">y</span> <span class="op">+</span> p2<span class="op">.</span><span class="at">y</span>) <span class="op">/</span> <span class="dv">2</span>}<span class="op">,</span></span>
<span id="cb11-1618"><a href="#cb11-1618" aria-hidden="true" tabindex="-1"></a>                    arc <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb11-1619"><a href="#cb11-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1620"><a href="#cb11-1620" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> p1<span class="op">.</span><span class="at">parentIndex</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>j) {</span>
<span id="cb11-1621"><a href="#cb11-1621" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (p2<span class="op">.</span><span class="at">parentIndex</span><span class="op">.</span><span class="fu">indexOf</span>(p1<span class="op">.</span><span class="at">parentIndex</span>[j]) <span class="op">&gt;</span> <span class="op">-</span><span class="dv">1</span>) {</span>
<span id="cb11-1622"><a href="#cb11-1622" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// figure out the angle halfway between the two points</span></span>
<span id="cb11-1623"><a href="#cb11-1623" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// on the current circle</span></span>
<span id="cb11-1624"><a href="#cb11-1624" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">var</span> circle <span class="op">=</span> circles[p1<span class="op">.</span><span class="at">parentIndex</span>[j]]<span class="op">,</span></span>
<span id="cb11-1625"><a href="#cb11-1625" aria-hidden="true" tabindex="-1"></a>                            a1 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan2</span>(p1<span class="op">.</span><span class="at">x</span> <span class="op">-</span> circle<span class="op">.</span><span class="at">x</span><span class="op">,</span> p1<span class="op">.</span><span class="at">y</span> <span class="op">-</span> circle<span class="op">.</span><span class="at">y</span>)<span class="op">,</span></span>
<span id="cb11-1626"><a href="#cb11-1626" aria-hidden="true" tabindex="-1"></a>                            a2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan2</span>(p2<span class="op">.</span><span class="at">x</span> <span class="op">-</span> circle<span class="op">.</span><span class="at">x</span><span class="op">,</span> p2<span class="op">.</span><span class="at">y</span> <span class="op">-</span> circle<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb11-1627"><a href="#cb11-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1628"><a href="#cb11-1628" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">var</span> angleDiff <span class="op">=</span> (a2 <span class="op">-</span> a1)<span class="op">;</span></span>
<span id="cb11-1629"><a href="#cb11-1629" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> (angleDiff <span class="op">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb11-1630"><a href="#cb11-1630" aria-hidden="true" tabindex="-1"></a>                            angleDiff <span class="op">+=</span> <span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb11-1631"><a href="#cb11-1631" aria-hidden="true" tabindex="-1"></a>                        }</span>
<span id="cb11-1632"><a href="#cb11-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1633"><a href="#cb11-1633" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// and use that angle to figure out the width of the</span></span>
<span id="cb11-1634"><a href="#cb11-1634" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// arc</span></span>
<span id="cb11-1635"><a href="#cb11-1635" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">var</span> a <span class="op">=</span> a2 <span class="op">-</span> angleDiff<span class="op">/</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb11-1636"><a href="#cb11-1636" aria-hidden="true" tabindex="-1"></a>                            width <span class="op">=</span> circleIntersection<span class="op">.</span><span class="fu">distance</span>(midPoint<span class="op">,</span> {</span>
<span id="cb11-1637"><a href="#cb11-1637" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">x</span> <span class="op">:</span> circle<span class="op">.</span><span class="at">x</span> <span class="op">+</span> circle<span class="op">.</span><span class="at">radius</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(a)<span class="op">,</span></span>
<span id="cb11-1638"><a href="#cb11-1638" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">y</span> <span class="op">:</span> circle<span class="op">.</span><span class="at">y</span> <span class="op">+</span> circle<span class="op">.</span><span class="at">radius</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(a)</span>
<span id="cb11-1639"><a href="#cb11-1639" aria-hidden="true" tabindex="-1"></a>                            })<span class="op">;</span></span>
<span id="cb11-1640"><a href="#cb11-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1641"><a href="#cb11-1641" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// pick the circle whose arc has the smallest width</span></span>
<span id="cb11-1642"><a href="#cb11-1642" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> ((arc <span class="op">===</span> <span class="kw">null</span>) <span class="op">||</span> (arc<span class="op">.</span><span class="at">width</span> <span class="op">&gt;</span> width)) {</span>
<span id="cb11-1643"><a href="#cb11-1643" aria-hidden="true" tabindex="-1"></a>                            arc <span class="op">=</span> { <span class="dt">circle</span> <span class="op">:</span> circle<span class="op">,</span></span>
<span id="cb11-1644"><a href="#cb11-1644" aria-hidden="true" tabindex="-1"></a>                                    <span class="dt">width</span> <span class="op">:</span> width<span class="op">,</span></span>
<span id="cb11-1645"><a href="#cb11-1645" aria-hidden="true" tabindex="-1"></a>                                    <span class="dt">p1</span> <span class="op">:</span> p1<span class="op">,</span></span>
<span id="cb11-1646"><a href="#cb11-1646" aria-hidden="true" tabindex="-1"></a>                                    <span class="dt">p2</span> <span class="op">:</span> p2}<span class="op">;</span></span>
<span id="cb11-1647"><a href="#cb11-1647" aria-hidden="true" tabindex="-1"></a>                        }</span>
<span id="cb11-1648"><a href="#cb11-1648" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb11-1649"><a href="#cb11-1649" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb11-1650"><a href="#cb11-1650" aria-hidden="true" tabindex="-1"></a>                arcs<span class="op">.</span><span class="fu">push</span>(arc)<span class="op">;</span></span>
<span id="cb11-1651"><a href="#cb11-1651" aria-hidden="true" tabindex="-1"></a>                arcArea <span class="op">+=</span> circleIntersection<span class="op">.</span><span class="fu">circleArea</span>(arc<span class="op">.</span><span class="at">circle</span><span class="op">.</span><span class="at">radius</span><span class="op">,</span> arc<span class="op">.</span><span class="at">width</span>)<span class="op">;</span></span>
<span id="cb11-1652"><a href="#cb11-1652" aria-hidden="true" tabindex="-1"></a>                p2 <span class="op">=</span> p1<span class="op">;</span></span>
<span id="cb11-1653"><a href="#cb11-1653" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-1654"><a href="#cb11-1654" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb11-1655"><a href="#cb11-1655" aria-hidden="true" tabindex="-1"></a>            <span class="co">// no intersection points, is either disjoint - or is completely</span></span>
<span id="cb11-1656"><a href="#cb11-1656" aria-hidden="true" tabindex="-1"></a>            <span class="co">// overlapped. figure out which by examining the smallest circle</span></span>
<span id="cb11-1657"><a href="#cb11-1657" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> smallest <span class="op">=</span> circles[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb11-1658"><a href="#cb11-1658" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> circles<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb11-1659"><a href="#cb11-1659" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (circles[i]<span class="op">.</span><span class="at">radius</span> <span class="op">&lt;</span> smallest<span class="op">.</span><span class="at">radius</span>) {</span>
<span id="cb11-1660"><a href="#cb11-1660" aria-hidden="true" tabindex="-1"></a>                    smallest <span class="op">=</span> circles[i]<span class="op">;</span></span>
<span id="cb11-1661"><a href="#cb11-1661" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb11-1662"><a href="#cb11-1662" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-1663"><a href="#cb11-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1664"><a href="#cb11-1664" aria-hidden="true" tabindex="-1"></a>            <span class="co">// make sure the smallest circle is completely contained in all</span></span>
<span id="cb11-1665"><a href="#cb11-1665" aria-hidden="true" tabindex="-1"></a>            <span class="co">// the other circles</span></span>
<span id="cb11-1666"><a href="#cb11-1666" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> disjoint <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb11-1667"><a href="#cb11-1667" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> circles<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb11-1668"><a href="#cb11-1668" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (circleIntersection<span class="op">.</span><span class="fu">distance</span>(circles[i]<span class="op">,</span> smallest) <span class="op">&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(smallest<span class="op">.</span><span class="at">radius</span> <span class="op">-</span> circles[i]<span class="op">.</span><span class="at">radius</span>)) {</span>
<span id="cb11-1669"><a href="#cb11-1669" aria-hidden="true" tabindex="-1"></a>                    disjoint <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb11-1670"><a href="#cb11-1670" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-1671"><a href="#cb11-1671" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb11-1672"><a href="#cb11-1672" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-1673"><a href="#cb11-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1674"><a href="#cb11-1674" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (disjoint) {</span>
<span id="cb11-1675"><a href="#cb11-1675" aria-hidden="true" tabindex="-1"></a>                arcArea <span class="op">=</span> polygonArea <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb11-1676"><a href="#cb11-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1677"><a href="#cb11-1677" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb11-1678"><a href="#cb11-1678" aria-hidden="true" tabindex="-1"></a>                arcArea <span class="op">=</span> smallest<span class="op">.</span><span class="at">radius</span> <span class="op">*</span> smallest<span class="op">.</span><span class="at">radius</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb11-1679"><a href="#cb11-1679" aria-hidden="true" tabindex="-1"></a>                arcs<span class="op">.</span><span class="fu">push</span>({<span class="dt">circle</span> <span class="op">:</span> smallest<span class="op">,</span></span>
<span id="cb11-1680"><a href="#cb11-1680" aria-hidden="true" tabindex="-1"></a>                           <span class="dt">p1</span><span class="op">:</span> { <span class="dt">x</span><span class="op">:</span> smallest<span class="op">.</span><span class="at">x</span><span class="op">,</span>        <span class="dt">y</span> <span class="op">:</span> smallest<span class="op">.</span><span class="at">y</span> <span class="op">+</span> smallest<span class="op">.</span><span class="at">radius</span>}<span class="op">,</span></span>
<span id="cb11-1681"><a href="#cb11-1681" aria-hidden="true" tabindex="-1"></a>                           <span class="dt">p2</span><span class="op">:</span> { <span class="dt">x</span><span class="op">:</span> smallest<span class="op">.</span><span class="at">x</span> <span class="op">-</span> SMALL<span class="op">,</span> <span class="dt">y</span> <span class="op">:</span> smallest<span class="op">.</span><span class="at">y</span> <span class="op">+</span> smallest<span class="op">.</span><span class="at">radius</span>}<span class="op">,</span></span>
<span id="cb11-1682"><a href="#cb11-1682" aria-hidden="true" tabindex="-1"></a>                           <span class="dt">width</span> <span class="op">:</span> smallest<span class="op">.</span><span class="at">radius</span> <span class="op">*</span> <span class="dv">2</span> })<span class="op">;</span></span>
<span id="cb11-1683"><a href="#cb11-1683" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-1684"><a href="#cb11-1684" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-1685"><a href="#cb11-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1686"><a href="#cb11-1686" aria-hidden="true" tabindex="-1"></a>        polygonArea <span class="op">/=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb11-1687"><a href="#cb11-1687" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (stats) {</span>
<span id="cb11-1688"><a href="#cb11-1688" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="at">area</span> <span class="op">=</span> arcArea <span class="op">+</span> polygonArea<span class="op">;</span></span>
<span id="cb11-1689"><a href="#cb11-1689" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="at">arcArea</span> <span class="op">=</span> arcArea<span class="op">;</span></span>
<span id="cb11-1690"><a href="#cb11-1690" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="at">polygonArea</span> <span class="op">=</span> polygonArea<span class="op">;</span></span>
<span id="cb11-1691"><a href="#cb11-1691" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="at">arcs</span> <span class="op">=</span> arcs<span class="op">;</span></span>
<span id="cb11-1692"><a href="#cb11-1692" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="at">innerPoints</span> <span class="op">=</span> innerPoints<span class="op">;</span></span>
<span id="cb11-1693"><a href="#cb11-1693" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="at">intersectionPoints</span> <span class="op">=</span> intersectionPoints<span class="op">;</span></span>
<span id="cb11-1694"><a href="#cb11-1694" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-1695"><a href="#cb11-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1696"><a href="#cb11-1696" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> arcArea <span class="op">+</span> polygonArea<span class="op">;</span></span>
<span id="cb11-1697"><a href="#cb11-1697" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb11-1698"><a href="#cb11-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1699"><a href="#cb11-1699" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** returns whether a point is contained by all of a list of circles */</span></span>
<span id="cb11-1700"><a href="#cb11-1700" aria-hidden="true" tabindex="-1"></a>    circleIntersection<span class="op">.</span><span class="at">containedInCircles</span> <span class="op">=</span> <span class="kw">function</span>(point<span class="op">,</span> circles) {</span>
<span id="cb11-1701"><a href="#cb11-1701" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> circles<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb11-1702"><a href="#cb11-1702" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (circleIntersection<span class="op">.</span><span class="fu">distance</span>(point<span class="op">,</span> circles[i]) <span class="op">&gt;</span> circles[i]<span class="op">.</span><span class="at">radius</span> <span class="op">+</span> SMALL) {</span>
<span id="cb11-1703"><a href="#cb11-1703" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb11-1704"><a href="#cb11-1704" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-1705"><a href="#cb11-1705" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-1706"><a href="#cb11-1706" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb11-1707"><a href="#cb11-1707" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb11-1708"><a href="#cb11-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1709"><a href="#cb11-1709" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Gets all intersection points between a bunch of circles */</span></span>
<span id="cb11-1710"><a href="#cb11-1710" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">getIntersectionPoints</span>(circles) {</span>
<span id="cb11-1711"><a href="#cb11-1711" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> ret <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb11-1712"><a href="#cb11-1712" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> circles<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb11-1713"><a href="#cb11-1713" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> circles<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>j) {</span>
<span id="cb11-1714"><a href="#cb11-1714" aria-hidden="true" tabindex="-1"></a>                <span class="kw">var</span> intersect <span class="op">=</span> circleIntersection<span class="op">.</span><span class="fu">circleCircleIntersection</span>(circles[i]<span class="op">,</span></span>
<span id="cb11-1715"><a href="#cb11-1715" aria-hidden="true" tabindex="-1"></a>                                                              circles[j])<span class="op">;</span></span>
<span id="cb11-1716"><a href="#cb11-1716" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> (<span class="kw">var</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> intersect<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>k) {</span>
<span id="cb11-1717"><a href="#cb11-1717" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">var</span> p <span class="op">=</span> intersect[k]<span class="op">;</span></span>
<span id="cb11-1718"><a href="#cb11-1718" aria-hidden="true" tabindex="-1"></a>                    p<span class="op">.</span><span class="at">parentIndex</span> <span class="op">=</span> [i<span class="op">,</span>j]<span class="op">;</span></span>
<span id="cb11-1719"><a href="#cb11-1719" aria-hidden="true" tabindex="-1"></a>                    ret<span class="op">.</span><span class="fu">push</span>(p)<span class="op">;</span></span>
<span id="cb11-1720"><a href="#cb11-1720" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb11-1721"><a href="#cb11-1721" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-1722"><a href="#cb11-1722" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-1723"><a href="#cb11-1723" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb11-1724"><a href="#cb11-1724" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-1725"><a href="#cb11-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1726"><a href="#cb11-1726" aria-hidden="true" tabindex="-1"></a>    circleIntersection<span class="op">.</span><span class="at">circleIntegral</span> <span class="op">=</span> <span class="kw">function</span>(r<span class="op">,</span> x) {</span>
<span id="cb11-1727"><a href="#cb11-1727" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(r <span class="op">*</span> r <span class="op">-</span> x <span class="op">*</span> x)<span class="op">;</span></span>
<span id="cb11-1728"><a href="#cb11-1728" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x <span class="op">*</span> y <span class="op">+</span> r <span class="op">*</span> r <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan2</span>(x<span class="op">,</span> y)<span class="op">;</span></span>
<span id="cb11-1729"><a href="#cb11-1729" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb11-1730"><a href="#cb11-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1731"><a href="#cb11-1731" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Returns the area of a circle of radius r - up to width */</span></span>
<span id="cb11-1732"><a href="#cb11-1732" aria-hidden="true" tabindex="-1"></a>    circleIntersection<span class="op">.</span><span class="at">circleArea</span> <span class="op">=</span> <span class="kw">function</span>(r<span class="op">,</span> width) {</span>
<span id="cb11-1733"><a href="#cb11-1733" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> circleIntersection<span class="op">.</span><span class="fu">circleIntegral</span>(r<span class="op">,</span> width <span class="op">-</span> r) <span class="op">-</span> circleIntersection<span class="op">.</span><span class="fu">circleIntegral</span>(r<span class="op">,</span> <span class="op">-</span>r)<span class="op">;</span></span>
<span id="cb11-1734"><a href="#cb11-1734" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb11-1735"><a href="#cb11-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1736"><a href="#cb11-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1737"><a href="#cb11-1737" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** euclidean distance between two points */</span></span>
<span id="cb11-1738"><a href="#cb11-1738" aria-hidden="true" tabindex="-1"></a>    circleIntersection<span class="op">.</span><span class="at">distance</span> <span class="op">=</span> <span class="kw">function</span>(p1<span class="op">,</span> p2) {</span>
<span id="cb11-1739"><a href="#cb11-1739" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>((p1<span class="op">.</span><span class="at">x</span> <span class="op">-</span> p2<span class="op">.</span><span class="at">x</span>) <span class="op">*</span> (p1<span class="op">.</span><span class="at">x</span> <span class="op">-</span> p2<span class="op">.</span><span class="at">x</span>) <span class="op">+</span></span>
<span id="cb11-1740"><a href="#cb11-1740" aria-hidden="true" tabindex="-1"></a>                         (p1<span class="op">.</span><span class="at">y</span> <span class="op">-</span> p2<span class="op">.</span><span class="at">y</span>) <span class="op">*</span> (p1<span class="op">.</span><span class="at">y</span> <span class="op">-</span> p2<span class="op">.</span><span class="at">y</span>))<span class="op">;</span></span>
<span id="cb11-1741"><a href="#cb11-1741" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb11-1742"><a href="#cb11-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1743"><a href="#cb11-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1744"><a href="#cb11-1744" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Returns the overlap area of two circles of radius r1 and r2 - that</span></span>
<span id="cb11-1745"><a href="#cb11-1745" aria-hidden="true" tabindex="-1"></a><span class="co">    have their centers separated by distance d. Simpler faster</span></span>
<span id="cb11-1746"><a href="#cb11-1746" aria-hidden="true" tabindex="-1"></a><span class="co">    circle intersection for only two circles */</span></span>
<span id="cb11-1747"><a href="#cb11-1747" aria-hidden="true" tabindex="-1"></a>    circleIntersection<span class="op">.</span><span class="at">circleOverlap</span> <span class="op">=</span> <span class="kw">function</span>(r1<span class="op">,</span> r2<span class="op">,</span> d) {</span>
<span id="cb11-1748"><a href="#cb11-1748" aria-hidden="true" tabindex="-1"></a>        <span class="co">// no overlap</span></span>
<span id="cb11-1749"><a href="#cb11-1749" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d <span class="op">&gt;=</span> r1 <span class="op">+</span> r2) {</span>
<span id="cb11-1750"><a href="#cb11-1750" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb11-1751"><a href="#cb11-1751" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-1752"><a href="#cb11-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1753"><a href="#cb11-1753" aria-hidden="true" tabindex="-1"></a>        <span class="co">// completely overlapped</span></span>
<span id="cb11-1754"><a href="#cb11-1754" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d <span class="op">&lt;=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(r1 <span class="op">-</span> r2)) {</span>
<span id="cb11-1755"><a href="#cb11-1755" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(r1<span class="op">,</span> r2) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(r1<span class="op">,</span> r2)<span class="op">;</span></span>
<span id="cb11-1756"><a href="#cb11-1756" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-1757"><a href="#cb11-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1758"><a href="#cb11-1758" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> w1 <span class="op">=</span> r1 <span class="op">-</span> (d <span class="op">*</span> d <span class="op">-</span> r2 <span class="op">*</span> r2 <span class="op">+</span> r1 <span class="op">*</span> r1) <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> d)<span class="op">,</span></span>
<span id="cb11-1759"><a href="#cb11-1759" aria-hidden="true" tabindex="-1"></a>            w2 <span class="op">=</span> r2 <span class="op">-</span> (d <span class="op">*</span> d <span class="op">-</span> r1 <span class="op">*</span> r1 <span class="op">+</span> r2 <span class="op">*</span> r2) <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> d)<span class="op">;</span></span>
<span id="cb11-1760"><a href="#cb11-1760" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> circleIntersection<span class="op">.</span><span class="fu">circleArea</span>(r1<span class="op">,</span> w1) <span class="op">+</span> circleIntersection<span class="op">.</span><span class="fu">circleArea</span>(r2<span class="op">,</span> w2)<span class="op">;</span></span>
<span id="cb11-1761"><a href="#cb11-1761" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb11-1762"><a href="#cb11-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1763"><a href="#cb11-1763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1764"><a href="#cb11-1764" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Given two circles (containing a x/y/radius attributes),</span></span>
<span id="cb11-1765"><a href="#cb11-1765" aria-hidden="true" tabindex="-1"></a><span class="co">    returns the intersecting points if possible.</span></span>
<span id="cb11-1766"><a href="#cb11-1766" aria-hidden="true" tabindex="-1"></a><span class="co">    note: doesn't handle cases where there are infinitely many</span></span>
<span id="cb11-1767"><a href="#cb11-1767" aria-hidden="true" tabindex="-1"></a><span class="co">    intersection points (circles are equivalent):, or only one intersection point*/</span></span>
<span id="cb11-1768"><a href="#cb11-1768" aria-hidden="true" tabindex="-1"></a>    circleIntersection<span class="op">.</span><span class="at">circleCircleIntersection</span> <span class="op">=</span> <span class="kw">function</span>(p1<span class="op">,</span> p2) {</span>
<span id="cb11-1769"><a href="#cb11-1769" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> d <span class="op">=</span> circleIntersection<span class="op">.</span><span class="fu">distance</span>(p1<span class="op">,</span> p2)<span class="op">,</span></span>
<span id="cb11-1770"><a href="#cb11-1770" aria-hidden="true" tabindex="-1"></a>            r1 <span class="op">=</span> p1<span class="op">.</span><span class="at">radius</span><span class="op">,</span></span>
<span id="cb11-1771"><a href="#cb11-1771" aria-hidden="true" tabindex="-1"></a>            r2 <span class="op">=</span> p2<span class="op">.</span><span class="at">radius</span><span class="op">;</span></span>
<span id="cb11-1772"><a href="#cb11-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1773"><a href="#cb11-1773" aria-hidden="true" tabindex="-1"></a>        <span class="co">// if to far away, or self contained - can't be done</span></span>
<span id="cb11-1774"><a href="#cb11-1774" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ((d <span class="op">&gt;=</span> (r1 <span class="op">+</span> r2)) <span class="op">||</span> (d <span class="op">&lt;=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(r1 <span class="op">-</span> r2))) {</span>
<span id="cb11-1775"><a href="#cb11-1775" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb11-1776"><a href="#cb11-1776" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-1777"><a href="#cb11-1777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1778"><a href="#cb11-1778" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> a <span class="op">=</span> (r1 <span class="op">*</span> r1 <span class="op">-</span> r2 <span class="op">*</span> r2 <span class="op">+</span> d <span class="op">*</span> d) <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> d)<span class="op">,</span></span>
<span id="cb11-1779"><a href="#cb11-1779" aria-hidden="true" tabindex="-1"></a>            h <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(r1 <span class="op">*</span> r1 <span class="op">-</span> a <span class="op">*</span> a)<span class="op">,</span></span>
<span id="cb11-1780"><a href="#cb11-1780" aria-hidden="true" tabindex="-1"></a>            x0 <span class="op">=</span> p1<span class="op">.</span><span class="at">x</span> <span class="op">+</span> a <span class="op">*</span> (p2<span class="op">.</span><span class="at">x</span> <span class="op">-</span> p1<span class="op">.</span><span class="at">x</span>) <span class="op">/</span> d<span class="op">,</span></span>
<span id="cb11-1781"><a href="#cb11-1781" aria-hidden="true" tabindex="-1"></a>            y0 <span class="op">=</span> p1<span class="op">.</span><span class="at">y</span> <span class="op">+</span> a <span class="op">*</span> (p2<span class="op">.</span><span class="at">y</span> <span class="op">-</span> p1<span class="op">.</span><span class="at">y</span>) <span class="op">/</span> d<span class="op">,</span></span>
<span id="cb11-1782"><a href="#cb11-1782" aria-hidden="true" tabindex="-1"></a>            rx <span class="op">=</span> <span class="op">-</span>(p2<span class="op">.</span><span class="at">y</span> <span class="op">-</span> p1<span class="op">.</span><span class="at">y</span>) <span class="op">*</span> (h <span class="op">/</span> d)<span class="op">,</span></span>
<span id="cb11-1783"><a href="#cb11-1783" aria-hidden="true" tabindex="-1"></a>            ry <span class="op">=</span> <span class="op">-</span>(p2<span class="op">.</span><span class="at">x</span> <span class="op">-</span> p1<span class="op">.</span><span class="at">x</span>) <span class="op">*</span> (h <span class="op">/</span> d)<span class="op">;</span></span>
<span id="cb11-1784"><a href="#cb11-1784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1785"><a href="#cb11-1785" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [{ <span class="dt">x</span><span class="op">:</span> x0 <span class="op">+</span> rx<span class="op">,</span> <span class="dt">y</span> <span class="op">:</span> y0 <span class="op">-</span> ry }<span class="op">,</span></span>
<span id="cb11-1786"><a href="#cb11-1786" aria-hidden="true" tabindex="-1"></a>                { <span class="dt">x</span><span class="op">:</span> x0 <span class="op">-</span> rx<span class="op">,</span> <span class="dt">y</span> <span class="op">:</span> y0 <span class="op">+</span> ry }]<span class="op">;</span></span>
<span id="cb11-1787"><a href="#cb11-1787" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb11-1788"><a href="#cb11-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-1789"><a href="#cb11-1789" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Returns the center of a bunch of points */</span></span>
<span id="cb11-1790"><a href="#cb11-1790" aria-hidden="true" tabindex="-1"></a>    circleIntersection<span class="op">.</span><span class="at">getCenter</span> <span class="op">=</span> <span class="kw">function</span>(points) {</span>
<span id="cb11-1791"><a href="#cb11-1791" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> center <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span>}<span class="op">;</span></span>
<span id="cb11-1792"><a href="#cb11-1792" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span><span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> points<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i ) {</span>
<span id="cb11-1793"><a href="#cb11-1793" aria-hidden="true" tabindex="-1"></a>            center<span class="op">.</span><span class="at">x</span> <span class="op">+=</span> points[i]<span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb11-1794"><a href="#cb11-1794" aria-hidden="true" tabindex="-1"></a>            center<span class="op">.</span><span class="at">y</span> <span class="op">+=</span> points[i]<span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb11-1795"><a href="#cb11-1795" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-1796"><a href="#cb11-1796" aria-hidden="true" tabindex="-1"></a>        center<span class="op">.</span><span class="at">x</span> <span class="op">/=</span> points<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb11-1797"><a href="#cb11-1797" aria-hidden="true" tabindex="-1"></a>        center<span class="op">.</span><span class="at">y</span> <span class="op">/=</span> points<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb11-1798"><a href="#cb11-1798" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> center<span class="op">;</span></span>
<span id="cb11-1799"><a href="#cb11-1799" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb11-1800"><a href="#cb11-1800" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> circleIntersection<span class="op">;</span></span>
<span id="cb11-1801"><a href="#cb11-1801" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="1811" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1810;"><span id="cb12-1811"><a href="#cb12-1811" aria-hidden="true" tabindex="-1"></a>mds <span class="op">=</span> {</span>
<span id="cb12-1812"><a href="#cb12-1812" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> mds <span class="op">=</span> {}</span>
<span id="cb12-1813"><a href="#cb12-1813" aria-hidden="true" tabindex="-1"></a>  mds<span class="op">.</span><span class="at">classic</span> <span class="op">=</span> <span class="kw">function</span>(distances<span class="op">,</span> dimensions) {</span>
<span id="cb12-1814"><a href="#cb12-1814" aria-hidden="true" tabindex="-1"></a>    dimensions <span class="op">=</span> dimensions <span class="op">||</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb12-1815"><a href="#cb12-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1816"><a href="#cb12-1816" aria-hidden="true" tabindex="-1"></a>    <span class="co">// square distances</span></span>
<span id="cb12-1817"><a href="#cb12-1817" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> M <span class="op">=</span> numeric<span class="op">.</span><span class="fu">mul</span>(<span class="op">-.</span><span class="dv">5</span><span class="op">,</span> numeric<span class="op">.</span><span class="fu">pow</span>(distances<span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb12-1818"><a href="#cb12-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1819"><a href="#cb12-1819" aria-hidden="true" tabindex="-1"></a>    <span class="co">// double centre the rows/columns</span></span>
<span id="cb12-1820"><a href="#cb12-1820" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">mean</span>(A) { <span class="cf">return</span> numeric<span class="op">.</span><span class="fu">div</span>(numeric<span class="op">.</span><span class="at">add</span><span class="op">.</span><span class="fu">apply</span>(<span class="kw">null</span><span class="op">,</span> A)<span class="op">,</span> A<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> }</span>
<span id="cb12-1821"><a href="#cb12-1821" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> rowMeans <span class="op">=</span> <span class="fu">mean</span>(M)<span class="op">,</span></span>
<span id="cb12-1822"><a href="#cb12-1822" aria-hidden="true" tabindex="-1"></a>        colMeans <span class="op">=</span> <span class="fu">mean</span>(numeric<span class="op">.</span><span class="fu">transpose</span>(M))<span class="op">,</span></span>
<span id="cb12-1823"><a href="#cb12-1823" aria-hidden="true" tabindex="-1"></a>        totalMean <span class="op">=</span> <span class="fu">mean</span>(rowMeans)<span class="op">;</span></span>
<span id="cb12-1824"><a href="#cb12-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1825"><a href="#cb12-1825" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> M<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb12-1826"><a href="#cb12-1826" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span><span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> M[<span class="dv">0</span>]<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>j) {</span>
<span id="cb12-1827"><a href="#cb12-1827" aria-hidden="true" tabindex="-1"></a>            M[i][j] <span class="op">+=</span> totalMean <span class="op">-</span> rowMeans[i] <span class="op">-</span> colMeans[j]<span class="op">;</span></span>
<span id="cb12-1828"><a href="#cb12-1828" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb12-1829"><a href="#cb12-1829" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-1830"><a href="#cb12-1830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1831"><a href="#cb12-1831" aria-hidden="true" tabindex="-1"></a>    <span class="co">// take the SVD of the double centred matrix, and return the</span></span>
<span id="cb12-1832"><a href="#cb12-1832" aria-hidden="true" tabindex="-1"></a>    <span class="co">// points from it</span></span>
<span id="cb12-1833"><a href="#cb12-1833" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> ret <span class="op">=</span> numeric<span class="op">.</span><span class="fu">svd</span>(M)<span class="op">,</span></span>
<span id="cb12-1834"><a href="#cb12-1834" aria-hidden="true" tabindex="-1"></a>        eigenValues <span class="op">=</span> numeric<span class="op">.</span><span class="fu">sqrt</span>(ret<span class="op">.</span><span class="at">S</span>)<span class="op">;</span></span>
<span id="cb12-1835"><a href="#cb12-1835" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret<span class="op">.</span><span class="at">U</span><span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(row) {</span>
<span id="cb12-1836"><a href="#cb12-1836" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> numeric<span class="op">.</span><span class="fu">mul</span>(row<span class="op">,</span> eigenValues)<span class="op">.</span><span class="fu">splice</span>(<span class="dv">0</span><span class="op">,</span> dimensions)<span class="op">;</span></span>
<span id="cb12-1837"><a href="#cb12-1837" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb12-1838"><a href="#cb12-1838" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb12-1839"><a href="#cb12-1839" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> mds<span class="op">;</span></span>
<span id="cb12-1840"><a href="#cb12-1840" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb13" data-startfrom="1845" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1844;"><span id="cb13-1845"><a href="#cb13-1845" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">'d3@v3'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>

</main>
<!-- /main column -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiB2ZW5uRGlhZ3JhbVdpdGhMZWdlbmQgPSBodG1sYFxuICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6IGNlbnRlcjtcIj5cbiAgICAgICAgJHtkcmF3X3Zlbm4oKX1cbiAgICAgICAgJHtkcmF3TGVnZW5kKCl9XG4gICAgPC9kaXY+YFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiTl9BTEwgPSBOX0EgKyBOX0IgLSBuQUFuZEIgKyBuTm90T3JBQjtcbm11dGFibGUgbkFBbmRCID0gMjtcblxudmlld29mIGludGVyYWN0aXZlQSA9IGh0bWxgbkE6PGJyLz4ke251bWJlck9mQX0gJHtzbGlkZXJBfWA7XG52aWV3b2YgaW50ZXJhY3RpdmVCID0gaHRtbGBuQjo8YnIvPiR7bnVtYmVyT2ZCfSAke3NsaWRlckJ9YDtcbnZpZXdvZiBpbnRlcmFjdGl2ZU5vdE9yQUIgPSBodG1sYG5Ob3RPcihBQik6IDxici8+JHtudW1iZXJPZk5vdE9yQUJ9ICR7c2xpZGVyQ31gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIHZpZXdvZiB2ZW5uRGlhZ3JhbVdpdGhMZWdlbmQuYWRkRXZlbnRMaXN0ZW5lcihcInVwZGF0ZVwiLCBsaXN0ZW5lcik7XG4gIGludmFsaWRhdGlvbi50aGVuKCgpID0+IHZpZXdvZiB2ZW5uRGlhZ3JhbVdpdGhMZWdlbmQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInVwZGF0ZVwiLCBsaXN0ZW5lcikpO1xuICB2aWV3b2YgdmVubkRpYWdyYW1XaXRoTGVnZW5kLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwidXBkYXRlXCIpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGRyYXdMZWdlbmQoKXtcbiAgdmFyIGxlZ2VuZCA9IGh0bWxgXG48ZGl2IGlkPVwibGVnZW5kXCI+XG4gIDxkaXYgaWQ9XCJib3hcIiBzdHlsZT1cImRpc3BsYXk6ZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcIj5cbiAgICA8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOiBjZW50ZXJcIiA+XG4gICAgICA8ZGl2IHN0eWxlPVwid2lkdGg6MzBweDtoZWlnaHQ6MzBweDtib3JkZXItcmFkaXVzOjNweDsgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyMTgsIDIxOCwgMjE3LCAwLjU3KTsgY3Vyc29yOnBvaW50ZXI7Ym9yZGVyOjNweCBzb2xpZCB0cmFuc3BhcmVudDtcIiBpZD1cImRpdi1vbWVnYVwiPjwvZGl2PlxuICAgICAgPHAgc3R5bGU9XCJwYWRkaW5nOiAwcHggN3B4O1wiPs6pPC9wPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6IGNlbnRlclwiID5cbiAgICAgIDxkaXYgc3R5bGU9XCJ3aWR0aDozMHB4O2hlaWdodDozMHB4O2JvcmRlci1yYWRpdXM6M3B4O2JhY2tncm91bmQtY29sb3I6IHJnYmEoMzEsIDExOSwgMTgwLCAwLjMpOyBjdXJzb3I6cG9pbnRlcjtib3JkZXI6M3B4IHNvbGlkIHRyYW5zcGFyZW50O1wiIGlkPVwiZGl2LUFcIj48L2Rpdj5cbiAgICAgIDxwIHN0eWxlPVwicGFkZGluZzogMHB4IDdweDtcIj5BPC9wPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6IGNlbnRlclwiID5cbiAgICAgIDxkaXYgc3R5bGU9XCJ3aWR0aDozMHB4O2hlaWdodDozMHB4O2JvcmRlci1yYWRpdXM6M3B4O2JhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAxMjcsIDE0LCAwLjMpOyBjdXJzb3I6cG9pbnRlcjtib3JkZXI6M3B4IHNvbGlkIHRyYW5zcGFyZW50O1wiIGlkPVwiZGl2LUJcIj48L2Rpdj5cbiAgICAgIDxwIHN0eWxlPVwicGFkZGluZzogMHB4IDdweDtcIj5CPC9wPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6IGNlbnRlclwiID5cbiAgICAgIDxkaXYgc3R5bGU9XCJ3aWR0aDozMHB4O2hlaWdodDozMHB4O2JvcmRlci1yYWRpdXM6M3B4O2JhY2tncm91bmQtY29sb3I6IHJnYmEoMTQzLCAxMjMsIDk3LCAwLjMpOyBjdXJzb3I6cG9pbnRlcjtib3JkZXI6M3B4IHNvbGlkIHRyYW5zcGFyZW50O1wiIGlkPVwiZGl2LUEtaW50ZXJzZWN0LUJcIj48L2Rpdj5cbiAgICAgIDxwIHN0eWxlPVwicGFkZGluZzogMHB4IDdweDtcIj5BIOKIqSBCPC9wPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6IGNlbnRlclwiID5cbiAgICAgIDxkaXYgc3R5bGU9XCJ3aWR0aDozMHB4O2hlaWdodDozMHB4O2JvcmRlci1yYWRpdXM6M3B4O1xuYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDMxLDExOSwxODAsMC4zKSAwJSwgcmdiYSgyNTUsMTI3LDE0LDAuMykgMTAwJSk7IGN1cnNvcjpwb2ludGVyO2JvcmRlcjozcHggc29saWQgdHJhbnNwYXJlbnQ7XCIgaWQ9XCJkaXYtQS11bmlvbi1CXCI+PC9kaXY+XG4gICAgICA8cCBzdHlsZT1cInBhZGRpbmc6IDBweCA3cHg7XCI+QSDiiKogQjwvcD5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOiBjZW50ZXJcIiA+XG4gICAgICA8ZGl2IHN0eWxlPVwid2lkdGg6MzBweDtoZWlnaHQ6MzBweDtib3JkZXItcmFkaXVzOjNweDtiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDMxLCAxMTksIDE4MCwgMC4zKTsgY3Vyc29yOnBvaW50ZXI7Ym9yZGVyOjNweCBzb2xpZCB0cmFuc3BhcmVudDtcIiBpZD1cImRpdi1BLWFuZC1ub3QtQlwiPjwvZGl2PlxuICAgICAgPHAgc3R5bGU9XCJwYWRkaW5nOiAwcHggN3B4O1wiPkEg4oipIEInPC9wPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6IGNlbnRlclwiID5cbiAgICAgIDxkaXYgc3R5bGU9XCJ3aWR0aDozMHB4O2hlaWdodDozMHB4O2JvcmRlci1yYWRpdXM6M3B4O2JhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAxMjcsIDE0LCAwLjMpOyBjdXJzb3I6cG9pbnRlcjtib3JkZXI6M3B4IHNvbGlkIHRyYW5zcGFyZW50O1wiIGlkPVwiZGl2LW5vdC1BLWFuZC1CXCI+PC9kaXY+XG4gICAgICA8cCBzdHlsZT1cInBhZGRpbmc6IDBweCA3cHg7XCI+QiDiiKkgQSc8L3A+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczogY2VudGVyXCIgPlxuICAgICAgPGRpdiBzdHlsZT1cIndpZHRoOjMwcHg7aGVpZ2h0OjMwcHg7Ym9yZGVyLXJhZGl1czozcHg7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjE4LCAyMTgsIDIxNywgMC41Nyk7IGN1cnNvcjpwb2ludGVyO2JvcmRlcjozcHggc29saWQgdHJhbnNwYXJlbnQ7XCIgaWQ9XCJkaXYtbm90LUEtaW50ZXJzZWN0LW5vdC1CXCI+PC9kaXY+XG4gICAgICA8cCBzdHlsZT1cInBhZGRpbmc6IDBweCA3cHg7XCI+QScg4oipIEInPC9wPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuYFxuICAgIHJldHVybiBsZWdlbmQ7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBsaXN0ZW5lcigpIHtcbiAgdmFyIHVuaW9uVGVtcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1bmlvbi10ZW1wJyk7XG4gIHZhciBsZWdlbmRBID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpdi1BJyk7XG4gIHZhciBjaXJjbGVBID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NpcmNsZS1BJyk7XG4gIHZhciBsZWdlbmRCID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpdi1CJyk7XG4gIHZhciBjaXJjbGVCID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NpcmNsZS1CJyk7XG4gIHZhciBsZWdlbmRBQW5kQiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGl2LUEtaW50ZXJzZWN0LUJcIik7XG4gIHZhciBwYXRoQUFuZEIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImludGVyc2VjdGlvbi1BLUJcIik7XG4gIHZhciBsZWdlbmROb3RBSW50ZXJzZWN0Tm90QiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGl2LW5vdC1BLWludGVyc2VjdC1ub3QtQlwiKTtcbiAgdmFyIGxlZ2VuZE9tZWdhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaXYtb21lZ2FcIik7XG4gIHZhciBsZWdlbmRBSW50ZXJzZWN0Tm90QiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGl2LUEtYW5kLW5vdC1CXCIpO1xuICB2YXIgbGVnZW5kTm90QUludGVyc2VjdEIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRpdi1ub3QtQS1hbmQtQlwiKTtcbiAgdmFyIHZlbm4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZlbm4taWRcIik7XG4gIHZhciBsZWdlbmRBVW5pb25CID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaXYtQS11bmlvbi1CXCIpO1xuICB2YXIgcGF0aEFVbmlvbkIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInVuaW9uLWFsbFwiKTtcbiAgXG4gIHZhciByaWdodFBhdGhBQW5kQiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW50ZXJzZWN0aW9uLXJpZ2h0LUEtQlwiKTtcbiAgdmFyIGxlZnRQYXRoQUFuZEIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImludGVyc2VjdGlvbi1sZWZ0LUEtQlwiKTtcbiAgdmFyIGNpcmNsZUJDb2xvciA9ICdyZ2IoMjU1LCAxMjcsIDE0KSc7XG4gIHZhciBwYXRoQUFuZEJDb2xvciA9ICcjOGY3YjYxNGQnO1xuICB2YXIgbGVnZW5kRGF0YUluSnNvbiA9IHtcbiAgICAnQSc6ICdBJyxcbiAgICAnQic6ICdCJyxcbiAgICAnQV9BTkRfQic6ICdBX0FORF9CJyxcbiAgICAnQV9VTklPTl9CJzogJ0FfVU5JT05fQicsXG4gICAgJ05PVF9BX0FORF9OT1RfQic6ICdOT1RfQV9BTkRfTk9UX0InLFxuICAgICdBX0FORF9OT1RfQic6ICdBX0FORF9OT1RfQicsXG4gICAgJ05PVF9BX0FORF9CJzogJ05PVF9BX0FORF9CJyxcbiAgICAnT01FR0EnOiAnT01FR0EnLFxuICAgICdOT05FJzogJydcbiAgfVxuICBcbiAgdmFyIHNlbGVjdGVkTGVnZW5kID0gJydcbiAgXG4gIG1vdmVUb0Zyb250KHBhdGhBQW5kQik7XG4gIFxuICBzZWxlY3RBRXZlbnRMaXN0ZW5lcigpO1xuICBzZWxlY3RCRXZlbnRMaXN0ZW5lcigpO1xuICBzZWxlY3RPbWVnYUV2ZW50TGlzdGVuZXIoKTtcbiAgc2VsZWN0Tm90QUFuZE5vdEJFdmVudExpc3RlbmVyKCk7XG4gIHNlbGVjdEFBbmROb3RCRXZlbnRMaXN0ZW5lcigpO1xuICBzZWxlY3ROb3RBQW5kQkV2ZW50TGlzdGVuZXIoKTtcbiAgc2VsZWN0QUFuZEJFdmVudExpc3RlbmVyKCk7XG4gIHNlbGVjdEFVbmlvbkJFdmVudExpc3RlbmVyKCk7XG4gIFxuICBmdW5jdGlvbiBpc0luc2lkZUJpZ0NpcmNsZShjdXJyZW50Q2lyY2xlKXtcbiAgICBpZihOX0EgPT0gbkFBbmRCICYmIGN1cnJlbnRDaXJjbGUgPT0gJ0EnKSByZXR1cm4gdHJ1ZTtcbiAgICBpZihOX0IgPT0gbkFBbmRCICYmIGN1cnJlbnRDaXJjbGUgPT0gJ0InKSByZXR1cm4gdHJ1ZTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gc2VsZWN0QUV2ZW50TGlzdGVuZXIoKXtcbiAgICBsZWdlbmRBLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihpc05vdENsaWNrZWRMZWdlbmQoKSl7XG4gICAgICAgIGhhbmRsZVNlbGVjdEEoKTtcbiAgICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZEEsICdyZ2JhKDMxLCAxMTksIDE4MCwgMSknLCB0cnVlKVxuICAgICAgfVxuICAgIH0pXG4gIFxuICAgIGxlZ2VuZEEuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYoaXNOb3RDbGlja2VkTGVnZW5kKCkpe1xuICAgICAgICBoYW5kbGVEZXNlbGVjdEEoKTtcbiAgICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZEEsICdyZ2JhKDMxLCAxMTksIDE4MCwgMC4zKScsIGZhbHNlKVxuICAgICAgfVxuICAgIH0pXG4gICAgXG4gICAgbGVnZW5kQS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihzZWxlY3RlZExlZ2VuZCA9PSBsZWdlbmREYXRhSW5Kc29uWydBJ10pe1xuICAgICAgICBzZWxlY3RlZExlZ2VuZCA9IGxlZ2VuZERhdGFJbkpzb25bJ05PTkUnXTtcbiAgICAgICAgaGFuZGxlRGVzZWxlY3RBKCk7XG4gICAgICAgIHVwZGF0ZUxlZ2VuZChsZWdlbmRBLCAncmdiYSgzMSwgMTE5LCAxODAsIDAuMyknLCBmYWxzZSlcbiAgICAgIH1lbHNlIGlmKGlzTm90Q2xpY2tlZExlZ2VuZCgpKXtcbiAgICAgICAgICBoYW5kbGVTZWxlY3RBKCk7XG4gICAgICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZEEsICdyZ2JhKDMxLCAxMTksIDE4MCwgMSknLCB0cnVlKVxuICAgICAgICAgIHNlbGVjdGVkTGVnZW5kID0gbGVnZW5kRGF0YUluSnNvblsnQSddO1xuICAgICAgfVxuICAgIH0pXG4gICB9XG4gIFxuICAgZnVuY3Rpb24gc2VsZWN0QkV2ZW50TGlzdGVuZXIoKXtcbiAgICBsZWdlbmRCLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihpc05vdENsaWNrZWRMZWdlbmQoKSl7XG4gICAgICAgIGhhbmRsZVNlbGVjdEIoKTtcbiAgICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZEIsICdyZ2JhKDI1NSwgMTI3LCAxNCwgMSknLCB0cnVlKVxuICAgICAgfVxuICAgIH0pXG4gIFxuICAgIGxlZ2VuZEIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYoaXNOb3RDbGlja2VkTGVnZW5kKCkpe1xuICAgICAgICBoYW5kbGVEZXNlbGVjdEIoKTtcbiAgICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZEIsICdyZ2JhKDI1NSwgMTI3LCAxNCwgMC4zKScsIGZhbHNlKVxuICAgICAgfVxuICAgIH0pXG4gICAgIFxuICAgICBsZWdlbmRCLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmKHNlbGVjdGVkTGVnZW5kID09IGxlZ2VuZERhdGFJbkpzb25bJ0InXSl7XG4gICAgICAgIHNlbGVjdGVkTGVnZW5kID0gbGVnZW5kRGF0YUluSnNvblsnTk9ORSddO1xuICAgICAgICBoYW5kbGVEZXNlbGVjdEIoKTtcbiAgICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZEIsICdyZ2JhKDI1NSwgMTI3LCAxNCwgMC4zKScsIGZhbHNlKVxuICAgICAgfWVsc2UgaWYoaXNOb3RDbGlja2VkTGVnZW5kKCkpe1xuICAgICAgICBzZWxlY3RlZExlZ2VuZCA9IGxlZ2VuZERhdGFJbkpzb25bJ0InXTtcbiAgICAgICAgaGFuZGxlU2VsZWN0QigpO1xuICAgICAgICB1cGRhdGVMZWdlbmQobGVnZW5kQiwgJ3JnYmEoMjU1LCAxMjcsIDE0LCAxKScsIHRydWUpXG4gICAgICB9XG4gICAgfSlcbiAgfVxuICBcbiAgZnVuY3Rpb24gaXNOb3RDbGlja2VkTGVnZW5kKCl7XG4gICAgcmV0dXJuIHNlbGVjdGVkTGVnZW5kID09PSAnJ1xuICB9XG4gIFxuICBmdW5jdGlvbiBoYW5kbGVTZWxlY3RBKCl7XG4gICAgICBtb3ZlVG9Gcm9udChjaXJjbGVBKVxuICAgICAgc2hvd0NpcmNsZShjaXJjbGVBKVxuICAgICAgaGlkZVBhdGhBbmRMYWJlbChjaXJjbGVCKTtcbiAgICAgIGhpZGVQYXRoQW5kTGFiZWwocGF0aEFBbmRCKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gaGFuZGxlRGVzZWxlY3RBKCl7XG4gICAgICBzaG93UGF0aEFuZExhYmVsKGNpcmNsZUIpO1xuICAgICAgc2hvd1BhdGhBbmRMYWJlbChwYXRoQUFuZEIpO1xuICAgICAgcmVzZXRDaXJjbGUoY2lyY2xlQSk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGhhbmRsZVNlbGVjdEIoKXtcbiAgICAgIG1vdmVUb0Zyb250KGNpcmNsZUIpXG4gICAgICBzaG93Q2lyY2xlKGNpcmNsZUIpO1xuICAgICAgaGlkZVBhdGhBbmRMYWJlbChjaXJjbGVBKTtcbiAgICAgIGhpZGVQYXRoQW5kTGFiZWwocGF0aEFBbmRCKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gaGFuZGxlRGVzZWxlY3RCKCl7XG4gICAgICBzaG93UGF0aEFuZExhYmVsKGNpcmNsZUEpO1xuICAgICAgc2hvd1BhdGhBbmRMYWJlbChwYXRoQUFuZEIpO1xuICAgICAgcmVzZXRDaXJjbGUoY2lyY2xlQik7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIHNlbGVjdEFBbmRCRXZlbnRMaXN0ZW5lcigpe1xuICAgIGxlZ2VuZEFBbmRCLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihpc05vdENsaWNrZWRMZWdlbmQoKSl7XG4gICAgICAgIGhhbmRsZVNlbGVjdEFBbmRCKCk7XG4gICAgICB9XG4gICAgfSlcbiAgXG4gICAgbGVnZW5kQUFuZEIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYoaXNOb3RDbGlja2VkTGVnZW5kKCkpe1xuICAgICAgICBoYW5kbGVEZXNlbGVjdEFBbmRCKCk7XG4gICAgICB9XG4gICAgfSlcbiAgICBcbiAgICBsZWdlbmRBQW5kQi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihzZWxlY3RlZExlZ2VuZCA9PSBsZWdlbmREYXRhSW5Kc29uWydBX0FORF9CJ10pe1xuICAgICAgICBzZWxlY3RlZExlZ2VuZCA9IGxlZ2VuZERhdGFJbkpzb25bJ05PTkUnXTtcbiAgICAgICAgaGFuZGxlRGVzZWxlY3RBQW5kQigpO1xuICAgICAgfWVsc2UgaWYoaXNOb3RDbGlja2VkTGVnZW5kKCkpe1xuICAgICAgICBzZWxlY3RlZExlZ2VuZCA9IGxlZ2VuZERhdGFJbkpzb25bJ0FfQU5EX0InXTtcbiAgICAgICAgaGFuZGxlU2VsZWN0QUFuZEIoKTtcbiAgICAgIH1cbiAgICB9KVxuICB9XG4gIFxuICBmdW5jdGlvbiBoYW5kbGVTZWxlY3RBQW5kQigpe1xuICAgICAgaWYoaXNJbnNpZGVCaWdDaXJjbGUoJ0EnKSl7XG4gICAgICAgIGhhbmRsZVNlbGVjdEEoKVxuICAgICAgfVxuICAgICAgZWxzZSBpZihpc0luc2lkZUJpZ0NpcmNsZSgnQicpKXtcbiAgICAgICAgaGFuZGxlU2VsZWN0QigpXG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgIG1vdmVUb0Zyb250KHBhdGhBQW5kQilcbiAgICAgIGhpZGVQYXRoQW5kTGFiZWwoY2lyY2xlQSk7XG4gICAgICBoaWRlUGF0aEFuZExhYmVsKGNpcmNsZUIpO1xuICAgICAgcGF0aEFBbmRCLnN0eWxlLnNldFByb3BlcnR5KFwiZmlsbC1vcGFjaXR5XCIsIC44KTtcbiAgICAgIHBhdGhBQW5kQi5zdHlsZS5zZXRQcm9wZXJ0eShcImZpbGxcIiwgcGF0aEFBbmRCQ29sb3IpO1xuICAgICAgdXBkYXRlU3Ryb2tlKHBhdGhBQW5kQiwgXCJ3aGl0ZVwiLCAxKTtcbiAgICAgIFxuICAgICB9XG4gICAgICB1cGRhdGVMZWdlbmQobGVnZW5kQUFuZEIsICdyZ2JhKDE0MywgMTIzLCA5NywgMSknLCB0cnVlKVxuICAgICAgXG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGhhbmRsZURlc2VsZWN0QUFuZEIoKXtcbiAgICAgIGlmKGlzSW5zaWRlQmlnQ2lyY2xlKCdBJykpe1xuICAgICAgICBoYW5kbGVEZXNlbGVjdEEoKVxuICAgICAgfVxuICAgICAgZWxzZSBpZihpc0luc2lkZUJpZ0NpcmNsZSgnQicpKXtcbiAgICAgICAgaGFuZGxlRGVzZWxlY3RCKClcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBzaG93UGF0aEFuZExhYmVsKGNpcmNsZUEpO1xuICAgICAgICBzaG93UGF0aEFuZExhYmVsKGNpcmNsZUIpO1xuICAgICAgICByZXNldEludGVyc2VjdGlvbihwYXRoQUFuZEIpO1xuICAgICAgfVxuICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZEFBbmRCLCAncmdiYSgxNDMsIDEyMywgOTcsIDAuMyknLCBmYWxzZSk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIHNlbGVjdEFVbmlvbkJFdmVudExpc3RlbmVyKCl7XG4gICAgbGVnZW5kQVVuaW9uQi5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYoaXNOb3RDbGlja2VkTGVnZW5kKCkpe1xuICAgICAgICBoYW5kbGVTZWxlY3RBVW5pb25CKCk7XG4gICAgICB9XG4gICAgfSlcbiAgXG4gICAgbGVnZW5kQVVuaW9uQi5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihpc05vdENsaWNrZWRMZWdlbmQoKSl7XG4gICAgICAgIGhhbmRsZURlc2VsZWN0QVVuaW9uQigpO1xuICAgICAgfVxuICAgIH0pXG4gICAgXG4gICAgbGVnZW5kQVVuaW9uQi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihzZWxlY3RlZExlZ2VuZCA9PSBsZWdlbmREYXRhSW5Kc29uWydBX1VOSU9OX0InXSl7XG4gICAgICAgIHNlbGVjdGVkTGVnZW5kID0gbGVnZW5kRGF0YUluSnNvblsnTk9ORSddO1xuICAgICAgICBoYW5kbGVEZXNlbGVjdEFVbmlvbkIoKTtcbiAgICAgIH1lbHNlIGlmKGlzTm90Q2xpY2tlZExlZ2VuZCgpKXtcbiAgICAgICAgc2VsZWN0ZWRMZWdlbmQgPSBsZWdlbmREYXRhSW5Kc29uWydBX1VOSU9OX0InXTtcbiAgICAgICAgaGFuZGxlU2VsZWN0QVVuaW9uQigpO1xuICAgICAgfVxuICAgIH0pXG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGhhbmRsZVNlbGVjdEFVbmlvbkIoKXtcbiAgICAgIGlmKGlzSW5zaWRlQmlnQ2lyY2xlKCdBJykpe1xuICAgICAgICBoYW5kbGVTZWxlY3RCKCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmKGlzSW5zaWRlQmlnQ2lyY2xlKCdCJykpe1xuICAgICAgICBoYW5kbGVTZWxlY3RBKCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgIHNob3dDaXJjbGUoY2lyY2xlQSk7XG4gICAgICBzaG93Q2lyY2xlKGNpcmNsZUIpO1xuICAgICAgbW92ZVRvRnJvbnQoY2lyY2xlQik7XG4gICAgICBtb3ZlVG9Gcm9udChwYXRoQUFuZEIpO1xuICAgICAgdXBkYXRlQ29sb3IocGF0aEFBbmRCLCBjaXJjbGVCQ29sb3IsIDEpO1xuICAgICAgdXBkYXRlU3Ryb2tlKHBhdGhBQW5kQiwgY2lyY2xlQkNvbG9yLCAxKTtcbiAgICAgIH1cbiAgICBsZWdlbmRBVW5pb25CLnN0eWxlLnNldFByb3BlcnR5KFwiYmFja2dyb3VuZFwiLCAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDMxLDExOSwxODAsMSkgMCUsIHJnYmEoMjU1LDEyNywxNCwxKSAxMDAlKScpO1xuICB9XG4gIFxuICBmdW5jdGlvbiBoYW5kbGVEZXNlbGVjdEFVbmlvbkIoKXtcbiAgICAgIGlmKGlzSW5zaWRlQmlnQ2lyY2xlKCdBJykpe1xuICAgICAgICBoYW5kbGVEZXNlbGVjdEIoKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYoaXNJbnNpZGVCaWdDaXJjbGUoJ0InKSl7XG4gICAgICAgIGhhbmRsZURlc2VsZWN0QSgpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJlc2V0Q2lyY2xlKGNpcmNsZUIpO1xuICAgICAgICByZXNldENpcmNsZShjaXJjbGVBKTtcbiAgICAgICAgcmVzZXRJbnRlcnNlY3Rpb24ocGF0aEFBbmRCKTtcbiAgICAgIH1cbiAgICBsZWdlbmRBVW5pb25CLnN0eWxlLnNldFByb3BlcnR5KFwiYmFja2dyb3VuZFwiLCAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDMxLDExOSwxODAsMC4zKSAwJSwgcmdiYSgyNTUsMTI3LDE0LDAuMykgMTAwJSknKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gc2VsZWN0Tm90QUFuZE5vdEJFdmVudExpc3RlbmVyKCl7XG4gICAgbGVnZW5kTm90QUludGVyc2VjdE5vdEIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmKGlzTm90Q2xpY2tlZExlZ2VuZCgpKXtcbiAgICAgICAgaGFuZGxlU2VsZWN0Tm90QUludGVyc2VjdE5vdEIoKTtcbiAgICAgIH1cbiAgICB9KVxuICBcbiAgICBsZWdlbmROb3RBSW50ZXJzZWN0Tm90Qi5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihpc05vdENsaWNrZWRMZWdlbmQoKSl7XG4gICAgICAgIGhhbmRsZURlc2VsZWN0Tm90QUludGVyc2VjdE5vdEIoKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIFxuICAgIGxlZ2VuZE5vdEFJbnRlcnNlY3ROb3RCLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmKHNlbGVjdGVkTGVnZW5kID09IGxlZ2VuZERhdGFJbkpzb25bJ05PVF9BX0FORF9OT1RfQiddKXtcbiAgICAgICAgc2VsZWN0ZWRMZWdlbmQgPSBsZWdlbmREYXRhSW5Kc29uWydOT05FJ107XG4gICAgICAgIGhhbmRsZURlc2VsZWN0Tm90QUludGVyc2VjdE5vdEIoKTtcbiAgICAgIH1lbHNlIGlmKGlzTm90Q2xpY2tlZExlZ2VuZCgpKXtcbiAgICAgICAgc2VsZWN0ZWRMZWdlbmQgPSBsZWdlbmREYXRhSW5Kc29uWydOT1RfQV9BTkRfTk9UX0InXTtcbiAgICAgICAgaGFuZGxlU2VsZWN0Tm90QUludGVyc2VjdE5vdEIoKTtcbiAgICAgIH1cbiAgICB9KVxuICBcbiAgfVxuICBcbiAgZnVuY3Rpb24gaGFuZGxlU2VsZWN0Tm90QUludGVyc2VjdE5vdEIoKXtcbiAgICBpZihpc0luc2lkZUJpZ0NpcmNsZSgnQScpKXtcbiAgICAgICAgaGlkZVBhdGhBbmRMYWJlbChjaXJjbGVBKTtcbiAgICAgICAgbW92ZVRvRnJvbnQoY2lyY2xlQik7XG4gICAgICAgIHVwZGF0ZVN0cm9rZShjaXJjbGVCLCBcIndoaXRlXCIsIDEpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZihpc0luc2lkZUJpZ0NpcmNsZSgnQicpKXtcbiAgICAgICAgaGlkZVBhdGhBbmRMYWJlbChjaXJjbGVCKTtcbiAgICAgICAgbW92ZVRvRnJvbnQoY2lyY2xlQSk7XG4gICAgICAgIHVwZGF0ZVN0cm9rZShjaXJjbGVBLCBcIndoaXRlXCIsIDEpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICB1cGRhdGVTdHJva2UoY2lyY2xlQSwgXCJ3aGl0ZVwiLCAxKTtcbiAgICAgIHVwZGF0ZVN0cm9rZShjaXJjbGVCLCBcIndoaXRlXCIsIDEpO1xuICAgICAgdXBkYXRlU3Ryb2tlKHBhdGhBQW5kQiwgXCIjOGY3YjYxXCIsIDEpO1xuICAgICAgbW92ZVRvRnJvbnQocGF0aEFBbmRCKTtcbiAgICAgIH1cbiAgICAgIHBhdGhBQW5kQi5zdHlsZS5zZXRQcm9wZXJ0eShcImZpbGwtb3BhY2l0eVwiLCAwKTtcbiAgICAgIHZlbm4uc3R5bGUuc2V0UHJvcGVydHkoXCJib3JkZXJcIiwgJzFweCByaWRnZSB3aGl0ZScpO1xuICAgICAgdmVubi5zdHlsZS5zZXRQcm9wZXJ0eShcImJhY2tncm91bmQtY29sb3JcIiwgJyM5YTlhOWFiYScpO1xuICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZE5vdEFJbnRlcnNlY3ROb3RCLCAncmdiYSg4MCwgODAsIDgwLCAxKScsIHRydWUpO1xuICB9XG4gIFxuICBmdW5jdGlvbiBoYW5kbGVEZXNlbGVjdE5vdEFJbnRlcnNlY3ROb3RCKCl7XG4gICAgaWYoaXNJbnNpZGVCaWdDaXJjbGUoJ0EnKSl7XG4gICAgICAgIHNob3dQYXRoQW5kTGFiZWwoY2lyY2xlQSk7XG4gICAgICAgIHJlc2V0Q2lyY2xlKGNpcmNsZUIpXG4gICAgICB9XG4gICAgICBlbHNlIGlmKGlzSW5zaWRlQmlnQ2lyY2xlKCdCJykpe1xuICAgICAgICBzaG93UGF0aEFuZExhYmVsKGNpcmNsZUIpO1xuICAgICAgICByZXNldENpcmNsZShjaXJjbGVBKVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICByZXNldENpcmNsZShjaXJjbGVBKVxuICAgICAgcmVzZXRDaXJjbGUoY2lyY2xlQilcbiAgICAgfVxuICAgICAgdmVubi5zdHlsZS5zZXRQcm9wZXJ0eShcImJvcmRlclwiLCAnMXB4IHNvbGlkIHNhbG1vbicpO1xuICAgICAgdmVubi5zdHlsZS5zZXRQcm9wZXJ0eShcImJhY2tncm91bmQtY29sb3JcIiwgJyNkYWRhZDk5MScpO1xuICAgICAgcGF0aEFBbmRCLnN0eWxlLnNldFByb3BlcnR5KFwic3Ryb2tlXCIsIFwidHJhbnNwYXJlbnRcIik7XG4gICAgICB1cGRhdGVMZWdlbmQobGVnZW5kTm90QUludGVyc2VjdE5vdEIsICdyZ2JhKDIxOCwgMjE4LCAyMTcsIDAuNTcpJywgZmFsc2UpXG4gIH1cbiAgXG4gIGZ1bmN0aW9uIHNlbGVjdEFBbmROb3RCRXZlbnRMaXN0ZW5lcigpe1xuICAgIGxlZ2VuZEFJbnRlcnNlY3ROb3RCLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihpc05vdENsaWNrZWRMZWdlbmQoKSl7XG4gICAgICAgIGhhbmRsZVNlbGVjdEFJbnRlcnNlY3ROb3RCKCk7XG4gICAgICB9XG4gICAgfSlcbiAgXG4gICAgbGVnZW5kQUludGVyc2VjdE5vdEIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYoaXNOb3RDbGlja2VkTGVnZW5kKCkpe1xuICAgICAgICBoYW5kbGVEZXNlbGVjdEFJbnRlcnNlY3ROb3RCKCk7XG4gICAgICB9ICBcbiAgICB9KTtcbiAgICBcbiAgICBsZWdlbmRBSW50ZXJzZWN0Tm90Qi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihzZWxlY3RlZExlZ2VuZCA9PSBsZWdlbmREYXRhSW5Kc29uWydBX0FORF9OT1RfQiddKXtcbiAgICAgICAgc2VsZWN0ZWRMZWdlbmQgPSBsZWdlbmREYXRhSW5Kc29uWydOT05FJ107XG4gICAgICAgIGhhbmRsZURlc2VsZWN0QUludGVyc2VjdE5vdEIoKTtcbiAgICAgIH1lbHNlIGlmKGlzTm90Q2xpY2tlZExlZ2VuZCgpKXtcbiAgICAgICAgc2VsZWN0ZWRMZWdlbmQgPSBsZWdlbmREYXRhSW5Kc29uWydBX0FORF9OT1RfQiddO1xuICAgICAgICBoYW5kbGVTZWxlY3RBSW50ZXJzZWN0Tm90QigpO1xuICAgICAgfVxuICAgIH0pXG4gICB9XG4gIFxuICBmdW5jdGlvbiBoYW5kbGVTZWxlY3RBSW50ZXJzZWN0Tm90Qigpe1xuICAgIGlmKGlzSW5zaWRlQmlnQ2lyY2xlKCdBJykpe1xuICAgICAgICBoaWRlUGF0aEFuZExhYmVsKGNpcmNsZUEpO1xuICAgICAgICBoaWRlUGF0aEFuZExhYmVsKGNpcmNsZUIpO1xuICAgICAgICBoaWRlUGF0aEFuZExhYmVsKHBhdGhBQW5kQik7XG4gICAgICB9XG4gICAgICBlbHNlIGlmKGlzSW5zaWRlQmlnQ2lyY2xlKCdCJykpe1xuICAgICAgICBzaG93Q2lyY2xlKGNpcmNsZUEpO1xuICAgICAgICBtb3ZlVG9Gcm9udChjaXJjbGVCKVxuICAgICAgICBzaG93Q2lyY2xlKGNpcmNsZUIpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICBzaG93Q2lyY2xlKGNpcmNsZUEpO1xuICAgICAgbW92ZVRvRnJvbnQocGF0aEFBbmRCKTtcbiAgICAgIG1vdmVUb0Zyb250KHJpZ2h0UGF0aEFBbmRCKTtcbiAgICAgIGhpZGVQYXRoQW5kTGFiZWwoY2lyY2xlQik7XG4gICAgICB1cGRhdGVDb2xvcihwYXRoQUFuZEIsIFwiI2RhZGFkY1wiLCAxKTtcbiAgICAgIHVwZGF0ZVN0cm9rZShwYXRoQUFuZEIsIFwid2hpdGVcIiwgMSk7XG4gICAgICB1cGRhdGVTdHJva2UocmlnaHRQYXRoQUFuZEIsIFwiI2RhZGFkY1wiLCAxKTtcbiAgICAgIHVwZGF0ZUNvbG9yKHJpZ2h0UGF0aEFBbmRCLCBcIiNkYWRhZGNcIiwgMSk7XG4gICAgICB9XG4gICAgICB1cGRhdGVMZWdlbmQobGVnZW5kQUludGVyc2VjdE5vdEIsICdyZ2JhKDMxLCAxMTksIDE4MCwgMSknLCB0cnVlKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gaGFuZGxlRGVzZWxlY3RBSW50ZXJzZWN0Tm90Qigpe1xuICAgIGlmKGlzSW5zaWRlQmlnQ2lyY2xlKCdBJykpe1xuICAgICAgICBzaG93UGF0aEFuZExhYmVsKGNpcmNsZUEpO1xuICAgICAgICBzaG93UGF0aEFuZExhYmVsKGNpcmNsZUIpO1xuICAgICAgICBzaG93UGF0aEFuZExhYmVsKHBhdGhBQW5kQik7XG4gICAgICB9XG4gICAgICBlbHNlIGlmKGlzSW5zaWRlQmlnQ2lyY2xlKCdCJykpe1xuICAgICAgICByZXNldENpcmNsZShjaXJjbGVCKTtcbiAgICAgICAgcmVzZXRDaXJjbGUoY2lyY2xlQSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmVzZXRDaXJjbGUoY2lyY2xlQSlcbiAgICAgICAgc2hvd1BhdGhBbmRMYWJlbChjaXJjbGVCKTtcbiAgICAgICAgcmVzZXRJbnRlcnNlY3Rpb24ocmlnaHRQYXRoQUFuZEIpO1xuICAgICAgICByZXNldEludGVyc2VjdGlvbihwYXRoQUFuZEIpO1xuICAgICAgfVxuICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZEFJbnRlcnNlY3ROb3RCLCAncmdiYSgzMSwgMTE5LCAxODAsIDAuMyknLCBmYWxzZSlcbiAgfVxuICBcbiAgZnVuY3Rpb24gc2VsZWN0Tm90QUFuZEJFdmVudExpc3RlbmVyKCl7XG4gICAgbGVnZW5kTm90QUludGVyc2VjdEIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmKGlzTm90Q2xpY2tlZExlZ2VuZCgpKXtcbiAgICAgICAgaGFuZGxlU2VsZWN0Tm90QUludGVyc2VjdEIoKTtcbiAgICAgIH1cbiAgICB9KVxuICBcbiAgICBsZWdlbmROb3RBSW50ZXJzZWN0Qi5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZihpc05vdENsaWNrZWRMZWdlbmQoKSl7XG4gICAgICAgIGhhbmRsZURlc2VsZWN0Tm90QUludGVyc2VjdEIoKTtcbiAgICAgIH0gIFxuICAgIH0pO1xuICAgIFxuICAgIGxlZ2VuZE5vdEFJbnRlcnNlY3RCLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmKHNlbGVjdGVkTGVnZW5kID09IGxlZ2VuZERhdGFJbkpzb25bJ05PVF9BX0FORF9CJ10pe1xuICAgICAgICBzZWxlY3RlZExlZ2VuZCA9IGxlZ2VuZERhdGFJbkpzb25bJ05PTkUnXTtcbiAgICAgICAgaGFuZGxlRGVzZWxlY3ROb3RBSW50ZXJzZWN0QigpO1xuICAgICAgfWVsc2UgaWYoaXNOb3RDbGlja2VkTGVnZW5kKCkpe1xuICAgICAgICBzZWxlY3RlZExlZ2VuZCA9IGxlZ2VuZERhdGFJbkpzb25bJ05PVF9BX0FORF9CJ107XG4gICAgICAgIGhhbmRsZVNlbGVjdE5vdEFJbnRlcnNlY3RCKCk7XG4gICAgICB9XG4gICAgfSlcbiAgIH1cbiAgXG4gIGZ1bmN0aW9uIGhhbmRsZVNlbGVjdE5vdEFJbnRlcnNlY3RCKCl7XG4gICAgICBpZihpc0luc2lkZUJpZ0NpcmNsZSgnQicpKXtcbiAgICAgICAgaGlkZVBhdGhBbmRMYWJlbChjaXJjbGVBKTtcbiAgICAgICAgaGlkZVBhdGhBbmRMYWJlbChjaXJjbGVCKTtcbiAgICAgICAgaGlkZVBhdGhBbmRMYWJlbChwYXRoQUFuZEIpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZihpc0luc2lkZUJpZ0NpcmNsZSgnQScpKXtcbiAgICAgICAgc2hvd0NpcmNsZShjaXJjbGVCKTtcbiAgICAgICAgbW92ZVRvRnJvbnQoY2lyY2xlQSlcbiAgICAgICAgc2hvd0NpcmNsZShjaXJjbGVBKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgc2hvd0NpcmNsZShjaXJjbGVCKTtcbiAgICAgIG1vdmVUb0Zyb250KHBhdGhBQW5kQik7XG4gICAgICBtb3ZlVG9Gcm9udChsZWZ0UGF0aEFBbmRCKTtcbiAgICAgIGhpZGVQYXRoQW5kTGFiZWwoY2lyY2xlQSk7XG4gICAgICB1cGRhdGVDb2xvcihwYXRoQUFuZEIsIFwiI2RhZGFkY1wiLCAxKTtcbiAgICAgIHVwZGF0ZUNvbG9yKGxlZnRQYXRoQUFuZEIsIFwiI2RhZGFkY1wiLCAxKTtcbiAgICAgIHVwZGF0ZVN0cm9rZShwYXRoQUFuZEIsIFwid2hpdGVcIiwgMSk7XG4gICAgICB1cGRhdGVTdHJva2UobGVmdFBhdGhBQW5kQiwgXCIjZGFkYWRjXCIsIDEpO1xuICAgICAgfVxuICAgICAgdXBkYXRlTGVnZW5kKGxlZ2VuZE5vdEFJbnRlcnNlY3RCLCAncmdiYSgyNTUsIDEyNywgMTQsIDEpJywgdHJ1ZSlcbiAgIH1cbiAgXG4gIGZ1bmN0aW9uIGhhbmRsZURlc2VsZWN0Tm90QUludGVyc2VjdEIoKXtcbiAgICBpZihpc0luc2lkZUJpZ0NpcmNsZSgnQicpKXtcbiAgICAgICAgc2hvd1BhdGhBbmRMYWJlbChjaXJjbGVBKTtcbiAgICAgICAgc2hvd1BhdGhBbmRMYWJlbChjaXJjbGVCKTtcbiAgICAgICAgc2hvd1BhdGhBbmRMYWJlbChwYXRoQUFuZEIpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZihpc0luc2lkZUJpZ0NpcmNsZSgnQScpKXtcbiAgICAgICAgcmVzZXRDaXJjbGUoY2lyY2xlQik7XG4gICAgICAgIHJlc2V0Q2lyY2xlKGNpcmNsZUEpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICByZXNldENpcmNsZShjaXJjbGVCKTtcbiAgICAgIHNob3dQYXRoQW5kTGFiZWwoY2lyY2xlQSk7XG4gICAgICByZXNldEludGVyc2VjdGlvbihsZWZ0UGF0aEFBbmRCKTtcbiAgICAgIHJlc2V0SW50ZXJzZWN0aW9uKHBhdGhBQW5kQik7XG4gICAgICB9XG4gICAgICB1cGRhdGVMZWdlbmQobGVnZW5kTm90QUludGVyc2VjdEIsICdyZ2JhKDI1NSwgMTI3LCAxNCwgMC4zKScsIGZhbHNlKVxuICB9XG4gIFxuICBmdW5jdGlvbiBzZWxlY3RPbWVnYUV2ZW50TGlzdGVuZXIoKXtcbiAgICBsZWdlbmRPbWVnYS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYoaXNOb3RDbGlja2VkTGVnZW5kKCkpe1xuICAgICAgICBoYW5kbGVTZWxlY3RPbWVnYSgpO1xuICAgICAgfVxuICAgIH0pXG4gIFxuICAgIGxlZ2VuZE9tZWdhLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmKGlzTm90Q2xpY2tlZExlZ2VuZCgpKXtcbiAgICAgICAgaGFuZGxlRGVzZWxlY3RPbWVnYSgpO1xuICAgICAgfSAgXG4gICAgfSk7XG4gICAgXG4gICAgbGVnZW5kT21lZ2EuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYoc2VsZWN0ZWRMZWdlbmQgPT0gbGVnZW5kRGF0YUluSnNvblsnT01FR0EnXSl7XG4gICAgICAgIHNlbGVjdGVkTGVnZW5kID0gbGVnZW5kRGF0YUluSnNvblsnTk9ORSddO1xuICAgICAgICBoYW5kbGVEZXNlbGVjdE9tZWdhKCk7XG4gICAgICB9ZWxzZSBpZihpc05vdENsaWNrZWRMZWdlbmQoKSl7XG4gICAgICAgIHNlbGVjdGVkTGVnZW5kID0gbGVnZW5kRGF0YUluSnNvblsnT01FR0EnXTtcbiAgICAgICAgaGFuZGxlU2VsZWN0T21lZ2EoKTtcbiAgICAgIH1cbiAgICB9KVxuICAgfVxuICBcbiAgZnVuY3Rpb24gaGFuZGxlU2VsZWN0T21lZ2EoKXtcbiAgICAgIGNoYW5nZVBhcmVudE5vZGVPcGFjaXR5KGNpcmNsZUEucGFyZW50Tm9kZS5wYXJlbnROb2RlLCAwKTtcbiAgICAgIHZlbm4uc3R5bGUuc2V0UHJvcGVydHkoXCJib3JkZXJcIiwgJzFweCByaWRnZSB3aGl0ZScpO1xuICAgICAgdmVubi5zdHlsZS5zZXRQcm9wZXJ0eShcImJhY2tncm91bmQtY29sb3JcIiwgJyNkY2RjZGMnKTtcbiAgICAgIHVwZGF0ZUxlZ2VuZChsZWdlbmRPbWVnYSwgJ3JnYmEoODAsIDgwLCA4MCwgMSknLCB0cnVlKVxuICB9XG4gIFxuICBmdW5jdGlvbiBoYW5kbGVEZXNlbGVjdE9tZWdhKCl7XG4gICAgICBzaG93UGF0aEFuZExhYmVsKGNpcmNsZUEucGFyZW50Tm9kZS5wYXJlbnROb2RlKTtcbiAgICAgIHZlbm4uc3R5bGUuc2V0UHJvcGVydHkoXCJib3JkZXJcIiwgJzFweCBzb2xpZCBzYWxtb24nKTtcbiAgICAgIHZlbm4uc3R5bGUuc2V0UHJvcGVydHkoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsICcjZGFkYWQ5OTEnKTtcbiAgICAgIHVwZGF0ZUxlZ2VuZChsZWdlbmRPbWVnYSwgJ3JnYmEoMjE4LCAyMTgsIDIxNywgMC41NyknLCBmYWxzZSlcbiAgfVxuICBcbiAgZnVuY3Rpb24gdXBkYXRlTGVnZW5kKHNlbGVjdGVkTm9kZSwgY29sb3IsIGlzU2VsZWN0KXtcbiAgICBzZWxlY3RlZE5vZGUuc3R5bGUuc2V0UHJvcGVydHkoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIGNvbG9yKTtcbiAgICBpZihpc1NlbGVjdCl7XG4gICAgICBzZWxlY3RlZE5vZGUuc3R5bGUuc2V0UHJvcGVydHkoXCJib3JkZXJcIiwgJzNweCBvdXRzZXQgd2hpdGUnKTtcbiAgICB9ZWxzZXtcbiAgICAgIHNlbGVjdGVkTm9kZS5zdHlsZS5zZXRQcm9wZXJ0eShcImJvcmRlclwiLCAnM3B4IHNvbGlkIHRyYW5zcGFyZW50Jyk7XG4gICAgfVxuICB9XG4gIFxuICBmdW5jdGlvbiB1cGRhdGVDb2xvcihzZWxlY3RlZE5vdGUsIGNvbG9yLCBvcGFjaXR5KXtcbiAgICAgIHNlbGVjdGVkTm90ZS5zdHlsZS5zZXRQcm9wZXJ0eShcImZpbGxcIiwgY29sb3IpO1xuICAgICAgc2VsZWN0ZWROb3RlLnN0eWxlLnNldFByb3BlcnR5KFwiZmlsbC1vcGFjaXR5XCIsIG9wYWNpdHkpO1xuICB9XG4gIFxuICBcbiAgZnVuY3Rpb24gdXBkYXRlU3Ryb2tlKHNlbGVjdGVkTm90ZSwgY29sb3IsIG9wYWNpdHkpe1xuICAgICAgc2VsZWN0ZWROb3RlLnN0eWxlLnNldFByb3BlcnR5KFwic3Ryb2tlXCIsIGNvbG9yKTtcbiAgICAgIHNlbGVjdGVkTm90ZS5zdHlsZS5zZXRQcm9wZXJ0eShcInN0cm9rZS1vcGFjaXR5XCIsIG9wYWNpdHkpO1xuICB9XG4gIFxuICBmdW5jdGlvbiBzaG93Q2lyY2xlKHNlbGVjdGVkTm9kZSl7XG4gICAgICBzZWxlY3RlZE5vZGUuc3R5bGUuc2V0UHJvcGVydHkoXCJmaWxsLW9wYWNpdHlcIiwgMC44KTtcbiAgICAgIHNlbGVjdGVkTm9kZS5zdHlsZS5zZXRQcm9wZXJ0eShcInN0cm9rZVwiLCBcIndoaXRlXCIpO1xuICAgICAgc2VsZWN0ZWROb2RlLnN0eWxlLnNldFByb3BlcnR5KFwic3Ryb2tlLW9wYWNpdHlcIiwgMSk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIHJlc2V0Q2lyY2xlKHNlbGVjdGVkTm9kZSl7XG4gICAgICBzZWxlY3RlZE5vZGUuc3R5bGUuc2V0UHJvcGVydHkoXCJmaWxsLW9wYWNpdHlcIiwgLjMpO1xuICAgICAgc2VsZWN0ZWROb2RlLnN0eWxlLnNldFByb3BlcnR5KFwic3Ryb2tlLW9wYWNpdHlcIiwgMCk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIHJlc2V0SW50ZXJzZWN0aW9uKHNlbGVjdGVkTm9kZSl7XG4gICAgc2VsZWN0ZWROb2RlLnN0eWxlLnNldFByb3BlcnR5KFwiZmlsbC1vcGFjaXR5XCIsIDApO1xuICAgICAgc2VsZWN0ZWROb2RlLnN0eWxlLnNldFByb3BlcnR5KFwiZmlsbFwiLCBcIndoaXRlXCIpO1xuICAgICAgc2VsZWN0ZWROb2RlLnN0eWxlLnNldFByb3BlcnR5KFwic3Ryb2tlXCIsIFwid2hpdGVcIik7XG4gICAgICBzZWxlY3RlZE5vZGUuc3R5bGUuc2V0UHJvcGVydHkoXCJzdHJva2Utb3BhY2l0eVwiLCAwKTtcbiAgICBtb3ZlVG9Gcm9udChjaXJjbGVCKTtcbiAgICBtb3ZlVG9Gcm9udChjaXJjbGVBKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gc2hvd1BhdGhBbmRMYWJlbChzZWxlY3RlZE5vdGUpIHtcbiAgICAgY2hhbmdlUGFyZW50Tm9kZU9wYWNpdHkoc2VsZWN0ZWROb3RlLCAxKVxuICB9O1xuICBcbiAgZnVuY3Rpb24gaGlkZVBhdGhBbmRMYWJlbChzZWxlY3RlZE5vdGUpIHtcbiAgICAgY2hhbmdlUGFyZW50Tm9kZU9wYWNpdHkoc2VsZWN0ZWROb3RlLCAwLjIpXG4gIH07XG4gIFxuICBmdW5jdGlvbiBjaGFuZ2VQYXJlbnROb2RlT3BhY2l0eShzZWxlY3RlZE5vdGUsIG9wYWNpdHkpIHtcbiAgICAgc2VsZWN0ZWROb3RlLnBhcmVudE5vZGUuc3R5bGUuc2V0UHJvcGVydHkoXCJvcGFjaXR5XCIsIG9wYWNpdHkpO1xuICB9O1xuICBcbiAgZnVuY3Rpb24gbW92ZVRvRnJvbnQoc2VsZWN0ZWROb3RlKSB7XG4gICAgIHNlbGVjdGVkTm90ZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoc2VsZWN0ZWROb3RlLnBhcmVudE5vZGUpO1xuICB9O1xuICBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlNfTUFYID0gNTAwICogNTAwXG5zQSA9IE5fQSAvIE5fQUxMICogU19NQVhcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGRyYXdfdmVubigpIHtcbiAgY29uc3Qgbm9kZSA9IERPTS5zdmcoaFJlY3QsIHdSZWN0KTtcbiAgdmFyIGlzTW92ZUluQ2hpbGRFbGVtZW50ID0gZmFsc2U7XG4gIHZhciBkaWFncmFtLFxuICAgICAgaW5pdCA9IHRydWUsXG4gICAgICBlbGVtID0gZDMuc2VsZWN0KG5vZGUpLmF0dHIoJ3N0eWxlJywgJ2JvcmRlcjogMXB4IHNvbGlkIHNhbG1vbjsgYmFja2dyb3VuZC1jb2xvcjogI2RhZGFkOTkxJykuYXR0cihcImlkXCIsIFwidmVubi1pZFwiKSxcbiAgICAgIHRvb2x0aXAgPSBkMy5zZWxlY3Qobm9kZSkuYXBwZW5kKFwiZGl2XCIpLmF0dHIoXCJjbGFzc1wiLCBcInZlbm50b29sdGlwXCIpLmF0dHIoJ3N0eWxlJywgJ3otaW5kZXg6IDEwMCcpO1xuICBcbiAgZWxlbS5vbihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoIWlzTW92ZUluQ2hpbGRFbGVtZW50KXtcbiAgICAgICAgICBkMy5zZWxlY3QodGhpcylcbiAgICAgICAgICAgIC5zdHlsZShcImJvcmRlclwiLCAnMXB4IHNvbGlkIHdoaXRlJylcbiAgICAgICAgICAgIC5zdHlsZShcImJhY2tncm91bmQtY29sb3JcIiwgJyNkY2RjZGMnKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgIH0pXG4gICAgICAub24oXCJtb3VzZWxlYXZlXCIsIGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgdmFyIHNlbGVjdGlvbiA9IGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAuYXR0cignc3R5bGUnLCAnYm9yZGVyOiAxcHggc29saWQgc2FsbW9uOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZGFkYWQ5OTEnKVxuICAgfSlcbiAgICBcbiAgZDMuc2VsZWN0KG5vZGUpLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIiwgaFJlY3QgLSA1MCAtIGZvbnRTaXplIClcbiAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCB3UmVjdCAtIDIwIC0gZm9udFNpemUgKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjMDAzMjYzXCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiIzAwMzI2M1wiKVxuICAgICAgICAgICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgZm9udFNpemUpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oKSB7IHJldHVybiBkYXRhLnNldHMucmVkdWNlKChhICwgYik9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBuZXdDaGFyYWN0ZXIgPSBhID09PSdOb3QgJyA/ICAnTm90ICcgOiBhICsgXCLii4NcIlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0NoYXJhY3RlciArIGIubGFiZWxcbiAgICAgICAgICAgICAgICB9LCAnTm90ICcpfSk7XG4gIFxuICBsb2FkKClcbiAgZnVuY3Rpb24gbG9hZCgpIHtcbiAgICB2YXIgdmVubk9iaiwgc2V0cywgb3ZlcmxhcHM7XG4gICAgICBzZXRzID0gZGF0YS5zZXRzO1xuICAgICAgb3ZlcmxhcHMgPSBkYXRhLm92ZXJsYXBzXG5cbiAgICAvLyBnZXQgcG9zaXRpb25zIGZvciBlYWNoIHNldFxuICAgIHZlbm5PYmogPSB2ZW5uLnZlbm4oc2V0cywgb3ZlcmxhcHMpO1xuICBcbiAgICBpZiAoaW5pdCkge1xuICAgICAgLy8gZHJhdyB0aGUgZGlhZ3JhbSBpbiB0aGUgJ3Zlbm4nIGRpdlxuICAgICAgZGlhZ3JhbSA9IHZlbm4uZHJhd0QzRGlhZ3JhbShlbGVtLCB2ZW5uT2JqLHdSZWN0LCBoUmVjdCk7XG4gICAgICBpbml0ID0gZmFsc2U7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdmVubi51cGRhdGVEM0RpYWdyYW0oZWxlbSwgdmVubk9iaik7XG4gICAgfVxuXG4gICAgLy8gaG92ZXIgb24gYWxsIHRoZSBjaXJjbGVzXG4gICAgZGlhZ3JhbS5jaXJjbGVzXG4gICAgICAuc3R5bGUoXCJzdHJva2Utb3BhY2l0eVwiLCAwKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwid2hpdGVcIilcbiAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjJcIilcbiAgICAgIC5vbihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHggPSBkMy5ldmVudC5wYWdlWDtcbiAgICAgICAgdmFyIHkgPSBkMy5ldmVudC5wYWdlWTtcbiAgICAgICAgdG9vbHRpcC5zdHlsZShcImxlZnRcIiwgKHgpICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgKHkpICsgXCJweFwiKTtcbiAgICAgIH0pXG4gICAgICAub24oXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICB2YXIgc2VsZWN0aW9uID0gZDMuc2VsZWN0KHRoaXMpO1xuICAgICAgICBkMy5zZWxlY3QodGhpcykubW92ZVBhcmVudFRvRnJvbnQoKVxuICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgIC5zdHlsZShcImZpbGwtb3BhY2l0eVwiLCAuNSlcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlLW9wYWNpdHlcIiwgMSk7XG5cbiAgICAgICAgdG9vbHRpcC50cmFuc2l0aW9uKCkuc3R5bGUoXCJvcGFjaXR5XCIsIC45KTtcbiAgICAgICAgdG9vbHRpcC50ZXh0KGQubnVtYmVyKTtcbiAgICAgICAgaXNNb3ZlSW5DaGlsZEVsZW1lbnQgPSB0cnVlO1xuICAgICAgICBkMy5zZWxlY3Qobm9kZSkuYXR0cignc3R5bGUnLCAnYm9yZGVyOiAxcHggc29saWQgc2FsbW9uOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZGFkYWQ5OTEnKVxuICAgICAgfSlcbiAgICAgIC5vbihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgZDMuc2VsZWN0KHRoaXMpLnRyYW5zaXRpb24oKVxuICAgICAgICAuc3R5bGUoXCJmaWxsLW9wYWNpdHlcIiwgLjMpXG4gICAgICAgIC5zdHlsZShcInN0cm9rZS1vcGFjaXR5XCIsIDApO1xuICAgICAgICB0b29sdGlwLnRyYW5zaXRpb24oKS5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XG4gICAgICBpc01vdmVJbkNoaWxkRWxlbWVudCA9IGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICBvdmVybGFwcyA9IG92ZXJsYXBzLm1hcCh2YWx1ZSA9PiB7XG4gICAgICBjb25zdCBkeE8xTzIgPSBNYXRoLmFicyhkYXRhLnNldHNbdmFsdWUuc2V0c1swXV0ueC1kYXRhLnNldHNbdmFsdWUuc2V0c1sxXV0ueClcbiAgICAgIGxldCBkZWx0YVggPSBNYXRoLmFicyhkYXRhLnNldHNbdmFsdWUuc2V0c1swXV0ucmFkaXVzICsgZGF0YS5zZXRzW3ZhbHVlLnNldHNbMV1dLnJhZGl1cyAtIGR4TzFPMikgLyAyXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi52YWx1ZSxcbiAgICAgICAgeDogZGF0YS5zZXRzW3ZhbHVlLnNldHNbMF1dLnggKyBkYXRhLnNldHNbdmFsdWUuc2V0c1swXV0ucmFkaXVzIC0gZGVsdGFYICxcbiAgICAgICAgeTogdmFsdWUuc2V0cy5yZWR1Y2UoKGEsIGIpID0+IHtcbiAgICAgICAgICByZXR1cm4gYSArIGRhdGEuc2V0c1tiXS55XG4gICAgICAgIH0sIDApIC8gMixcbiAgICAgIH1cbiAgICB9KVxuICAgIFxuICAgIC8vIGRyYXcgYSBwYXRoIGFyb3VuZCBlYWNoIGludGVyc2VjdGlvbiBhcmVhLCBhZGQgaG92ZXIgdGhlcmUgYXMgd2VsbFxuICAgIHZhciBpbnRlcnNlY3Rpb25zID0gZGlhZ3JhbS5zdmcuc2VsZWN0KFwiZ1wiKS5hcHBlbmQoXCJnXCIpLnNlbGVjdEFsbChcInBhdGhcIilcbiAgICAgIC5kYXRhKG92ZXJsYXBzKVxuICAgIHZhciBpbnRlcnNlY3RzID0gaW50ZXJzZWN0aW9uc1xuICAgICAgLmVudGVyKCk7XG4gICAgXG4gICAgaW50ZXJzZWN0cy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAuYXR0cihcImlkXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGBpbnRlcnNlY3Rpb24tdGV4dC0ke2RhdGEuc2V0c1tkLnNldHNbMF1dLmxhYmVsfS0ke2RhdGEuc2V0c1tkLnNldHNbMV1dLmxhYmVsfWAgfSlcbiAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiBkLnggfSlcbiAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiBkLnkgfSlcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjOUQ0MDU3XCIpXG4gICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCIjOUQ0MDU3XCIpXG4gICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSlcbiAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgXG4gICAgICAgIGlmIChkLnNpemUgPiAwKSByZXR1cm4gYCR7ZGF0YS5zZXRzW2Quc2V0c1swXV0ubGFiZWx9IOKIqSAke2RhdGEuc2V0c1tkLnNldHNbMV1dLmxhYmVsfWBcbiAgICAgICAgcmV0dXJuICcnXG4gICAgICB9KTtcbiAgICBcbiAgICAgIGludGVyc2VjdHMuYXBwZW5kKFwicGF0aFwiKVxuICAgICAgLmF0dHIoXCJpZFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBgaW50ZXJzZWN0aW9uLSR7ZGF0YS5zZXRzW2Quc2V0c1swXV0ubGFiZWx9LSR7ZGF0YS5zZXRzW2Quc2V0c1sxXV0ubGFiZWx9YCB9KVxuICAgICAgLnN0eWxlKFwiZmlsbC1vcGFjaXR5XCIsXCIwXCIpXG4gICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiYmxhY2tcIilcbiAgICAgIC5zdHlsZShcInN0cm9rZS1vcGFjaXR5XCIsIDApXG4gICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCJ3aGl0ZVwiKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMlwiKVxuICAgIFxuICAgIGludGVyc2VjdGlvbnNcbiAgICAgIC5hdHRyKFwiZFwiLCBmdW5jdGlvbihkKSB7IFxuICAgICAgICByZXR1cm4gdmVubi5pbnRlcnNlY3Rpb25BcmVhU3BsaXRQYXRoKGQuc2V0cy5tYXAoZnVuY3Rpb24oaikgeyByZXR1cm4gdmVubk9ialtqXTsgfSksIHRydWUsIHRydWUpOyBcbiAgICAgIH0pXG4gICAgICAub24oXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICBkMy5zZWxlY3QodGhpcykubW92ZVBhcmVudFRvRnJvbnQoKVxuICAgICAgICBkMy5zZWxlY3QodGhpcykudHJhbnNpdGlvbigpXG4gICAgICAgIC5zdHlsZShcImZpbGwtb3BhY2l0eVwiLCAuMSlcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlLW9wYWNpdHlcIiwgMSk7XG4gICAgICAgIHRvb2x0aXAudHJhbnNpdGlvbigpLnN0eWxlKFwib3BhY2l0eVwiLCAxKTtcbiAgICAgICAgdG9vbHRpcC50ZXh0KGQubnVtYmVyKTtcbiAgICAgICAgaXNNb3ZlSW5DaGlsZEVsZW1lbnQgPSB0cnVlO1xuICAgICAgfSlcbiAgICAgIC5vbihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgZDMuc2VsZWN0KHRoaXMpLm1vdmVQYXJlbnRUb0Zyb250KCk7XG4gICAgICAgIGQzLnNlbGVjdCh0aGlzKS50cmFuc2l0aW9uKClcbiAgICAgICAgLnN0eWxlKFwiZmlsbC1vcGFjaXR5XCIsIDApXG4gICAgICAgIC5zdHlsZShcInN0cm9rZS1vcGFjaXR5XCIsIDApO1xuICAgICAgICB0b29sdGlwLnRyYW5zaXRpb24oKS5zdHlsZShcIm9wYWNpdHlcIiwgMSk7XG4gICAgICAgIGlzTW92ZUluQ2hpbGRFbGVtZW50ID0gZmFsc2U7XG4gICAgICAgIGQzLnNlbGVjdChub2RlKS5hdHRyKCdzdHlsZScsICdib3JkZXI6IDFweCBzb2xpZCBzYWxtb247IGJhY2tncm91bmQtY29sb3I6ICNkYWRhZDk5MScpXG4gICAgICB9KVxuICAgICAgLm9uKFwibW91c2Vtb3ZlXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICB0b29sdGlwLnN0eWxlKFwibGVmdFwiLCAoZDMuZXZlbnQucGFnZVgpICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgKGQzLmV2ZW50LnBhZ2VZIC0gMjgpICsgXCJweFwiKTtcbiAgICAgIH0pO1xuICAgIFxuICAgIC8vXG4gICAgdmFyIHJpZ2h0SW50ZXJzZWN0aW9ucyA9IGRpYWdyYW0uc3ZnLnNlbGVjdChcImdcIikuYXBwZW5kKFwiZ1wiKS5zZWxlY3RBbGwoXCJwYXRoXCIpXG4gICAgICAuZGF0YShvdmVybGFwcylcbiAgICB2YXIgcmlnaHRJbnRlcnNlY3RzID0gcmlnaHRJbnRlcnNlY3Rpb25zXG4gICAgICAuZW50ZXIoKTtcbiAgICBcbiAgICByaWdodEludGVyc2VjdHMuYXBwZW5kKFwicGF0aFwiKVxuICAgICAgLmF0dHIoXCJpZFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBgaW50ZXJzZWN0aW9uLXJpZ2h0LSR7ZGF0YS5zZXRzW2Quc2V0c1swXV0ubGFiZWx9LSR7ZGF0YS5zZXRzW2Quc2V0c1sxXV0ubGFiZWx9YCB9KVxuICAgICAgLnN0eWxlKFwiZmlsbC1vcGFjaXR5XCIsXCIwXCIpXG4gICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiYmxhY2tcIilcbiAgICAgIC5zdHlsZShcInN0cm9rZS1vcGFjaXR5XCIsIDApXG4gICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCJ3aGl0ZVwiKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMlwiKVxuXG4gICAgcmlnaHRJbnRlcnNlY3Rpb25zXG4gICAgICAuYXR0cihcImRcIiwgZnVuY3Rpb24oZCkgeyBcbiAgICAgICAgcmV0dXJuIHZlbm4uaW50ZXJzZWN0aW9uQXJlYVNwbGl0UGF0aChkLnNldHMubWFwKGZ1bmN0aW9uKGopIHsgcmV0dXJuIHZlbm5PYmpbal07IH0pLCB0cnVlLCBmYWxzZSk7IFxuICAgICAgfSlcbiAgICBcbiAgICAvL1xuICAgIHZhciBsZWZ0SW50ZXJzZWN0aW9ucyA9IGRpYWdyYW0uc3ZnLnNlbGVjdChcImdcIikuYXBwZW5kKFwiZ1wiKS5zZWxlY3RBbGwoXCJwYXRoXCIpXG4gICAgICAuZGF0YShvdmVybGFwcylcbiAgICB2YXIgbGVmdEludGVyc2VjdHMgPSBsZWZ0SW50ZXJzZWN0aW9uc1xuICAgICAgLmVudGVyKCk7XG4gICAgXG4gICAgbGVmdEludGVyc2VjdHMuYXBwZW5kKFwicGF0aFwiKVxuICAgICAgLmF0dHIoXCJpZFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBgaW50ZXJzZWN0aW9uLWxlZnQtJHtkYXRhLnNldHNbZC5zZXRzWzBdXS5sYWJlbH0tJHtkYXRhLnNldHNbZC5zZXRzWzFdXS5sYWJlbH1gIH0pXG4gICAgICAuc3R5bGUoXCJmaWxsLW9wYWNpdHlcIixcIjBcIilcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJibGFja1wiKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlLW9wYWNpdHlcIiwgMClcbiAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcIndoaXRlXCIpXG4gICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIyXCIpXG5cbiAgICBsZWZ0SW50ZXJzZWN0aW9uc1xuICAgICAgLmF0dHIoXCJkXCIsIGZ1bmN0aW9uKGQpIHsgXG4gICAgICAgIHJldHVybiB2ZW5uLmludGVyc2VjdGlvbkFyZWFTcGxpdFBhdGgoZC5zZXRzLm1hcChmdW5jdGlvbihqKSB7IHJldHVybiB2ZW5uT2JqW2pdOyB9KSwgZmFsc2UsIHRydWUpOyBcbiAgICAgIH0pXG4gICAgXG4gICAgaW50ZXJzZWN0aW9ucy5leGl0KCkucmVtb3ZlKCk7XG4gIH0gIFxuICBcblxuICBkMy5zZWxlY3Rpb24ucHJvdG90eXBlLm1vdmVQYXJlbnRUb0Zyb250ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgdGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQodGhpcy5wYXJlbnROb2RlKTtcbiAgICB9KTtcbiAgfTtcbiAgXG4gIHJldHVybiBlbGVtLm5vZGUoKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoickEgPSBNYXRoLnNxcnQoc0EgLyBNYXRoLlBJKVxuc0IgPSBOX0IgLyBOX0FMTCAqIFNfTUFYXG5yQiA9IE1hdGguc3FydChzQiAvIE1hdGguUEkpXG5zQm90aCA9IG5BQW5kQiAvIE5fQUxMICogU19NQVhcbmRlbHRhID0gKHJBICsgckIpIC8gMTBcbmhSZWN0ID0gODAwLy8oIHJBICsgckIgKSAqIDIgKyAyICogZGVsdGFcbndSZWN0ID0gNDAwLy8yICogZDMubWF4KFtyQSwgckJdKSArIDIgKiBkZWx0YVxuZm9udFNpemUgPSBoUmVjdCAvIDMwXG5tdXRhYmxlIE5fQSA9IDEwXG5cbm51bWJlck9mQSA9IHtcbiAgY29uc3QgaW5wdXQgPSBodG1sYDxpbnB1dCB0eXBlPVwibnVtYmVyXCIgbWF4PTEwMCBzdHlsZT1cIndpZHRoOjUwcHg7aGVpZ2h0OjIwcHhcIiAvPmBcbiAgaW5wdXQub25jaGFuZ2UgPSAoKSA9PiB7XG4gICAgICBtdXRhYmxlIE5fQSA9IGlucHV0LnZhbHVlQXNOdW1iZXI7XG4gIH1cbiAgcmV0dXJuIGh0bWxgJHtpbnB1dH1gO1xufVxuXG5udW1iZXJPZkIgPSB7XG4gIGNvbnN0IGlucHV0ID0gaHRtbGA8aW5wdXQgdHlwZT1cIm51bWJlclwiIG1heD0xMDAgc3R5bGU9XCJ3aWR0aDo1MHB4O2hlaWdodDoyMHB4XCIvPmBcbiAgaW5wdXQub25jaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICBtdXRhYmxlIE5fQiA9IGlucHV0LnZhbHVlQXNOdW1iZXI7XG4gIH1cbiAgcmV0dXJuIGh0bWxgJHtpbnB1dH1gO1xufVxuXG5udW1iZXJPZk5vdE9yQUIgPSB7XG4gIGNvbnN0IGlucHV0ID0gaHRtbGA8aW5wdXQgdHlwZT1cIm51bWJlclwiIG1heD0xMDAgc3R5bGU9XCJ3aWR0aDo1MHB4O2hlaWdodDoyMHB4XCIvPmBcbiAgaW5wdXQub25jaGFuZ2UgPSAoKSA9PiB7XG4gICAgbXV0YWJsZSBuTm90T3JBQiA9IGlucHV0LnZhbHVlQXNOdW1iZXI7XG4gIH1cbiAgcmV0dXJuIGh0bWxgJHtpbnB1dH1gO1xufVxuXG5zbGlkZXJBID0ge1xuICBjb25zdCBpbnB1dCA9IGh0bWxgPGlucHV0IHR5cGU9XCJyYW5nZVwiIG1pbj1cIjBcIiBtYXg9JHtOX0F9IHN0ZXA9XCIxXCIgdmFsdWU9JHtuQUFuZEJ9IC8+YFxuICBpbnB1dC5vbmlucHV0ID0gKCkgPT4ge1xuICAgIGlmKGlucHV0LnZhbHVlQXNOdW1iZXIgPD0gbWF4TkFBbmRCKXtcbiAgICAgIG11dGFibGUgbkFBbmRCID0gaW5wdXQudmFsdWVBc051bWJlcjtcbiAgICB9XG4gICAgZWxzZXtcbiAgICAgbXV0YWJsZSBuQUFuZEIgPSBtYXhOQUFuZEI7XG4gICAgfVxuICB9O1xuICByZXR1cm4gaHRtbGAwICR7aW5wdXR9IG5BYDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im5BQW5kTm90QiA9IE5fQSAtIG5BQW5kQjtcbm11dGFibGUgTl9CID0gNVxubkJBbmROb3RBID0gTl9CIC0gbkFBbmRCXG5tYXhOQUFuZEIgPSBNYXRoLm1pbihOX0EsIE5fQilcblxuc2xpZGVyQiA9IHtcbiAgY29uc3QgaW5wdXQgPSBodG1sYDxpbnB1dCB0eXBlPVwicmFuZ2VcIiBtaW49XCIwXCIgbWF4PSR7Tl9CfSBzdGVwPVwiMVwiIHZhbHVlPSR7bkFBbmRCfSAvPmBcbiAgaW5wdXQub25pbnB1dCA9ICgpID0+IHtcbiAgICBpZihpbnB1dC52YWx1ZUFzTnVtYmVyIDw9IG1heE5BQW5kQil7XG4gICAgICBtdXRhYmxlIG5BQW5kQiA9IGlucHV0LnZhbHVlQXNOdW1iZXI7XG4gICAgfVxuICAgIGVsc2V7XG4gICAgIG11dGFibGUgbkFBbmRCID0gbWF4TkFBbmRCO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGh0bWxgMCAke2lucHV0fSBuQmA7XG59XG5cbm11dGFibGUgbk5vdE9yQUIgPTBcblxuXG5zbGlkZXJDID0ge1xuICBjb25zdCBpbnB1dCA9IGh0bWxgPGlucHV0IHR5cGU9XCJyYW5nZVwiIG1pbj1cIjBcIiBtYXg9JHtOX0EgKyBOX0IgKyBuTm90T3JBQn0gc3RlcD1cIjFcIiB2YWx1ZT0ke25BQW5kQn0gLz5gXG4gIGlucHV0Lm9uaW5wdXQgPSAoKSA9PiB7XG4gICAgaWYoaW5wdXQudmFsdWVBc051bWJlciA8PSBtYXhOQUFuZEIpe1xuICAgICAgbXV0YWJsZSBuQUFuZEIgPSBpbnB1dC52YWx1ZUFzTnVtYmVyO1xuICAgIH1cbiAgICBlbHNle1xuICAgICBtdXRhYmxlIG5BQW5kQiA9IG1heE5BQW5kQjtcbiAgICB9XG4gIH07XG4gIHJldHVybiBodG1sYDAgJHtpbnB1dH0gbkEgKyBuQiArIG5Ob3QoQW9yQilgO1xufVxuXG5kYXRhID0ge1xuICByZXR1cm57XG4gICAgXCJzZXRzXCI6IFtcbiAgICAgIHtcImxhYmVsXCI6IFwiQVwiLCBcInNpemVcIjogc0EsIFwibnVtYmVyXCI6IE5fQX0sXG4gICAgICB7XCJsYWJlbFwiOiBcIkJcIiwgXCJzaXplXCI6IHNCLFwibnVtYmVyXCI6IE5fQn0sXG4gICAgICAvLyB7XCJsYWJlbFwiOiBcIkNcIiwgXCJzaXplXCI6IDQwMDAwLFwibnVtYmVyXCI6IE5fQn0sXG4gICAgXSxcbiAgICBcIm92ZXJsYXBzXCI6IFtcbiAgICAgIHsgXCJzZXRzXCI6IFswLCAxXSwgXCJzaXplXCI6IHNCb3RoLCBcIm51bWJlclwiOiBuQUFuZEJ9LFxuICAgICAgLy8ge1wic2V0c1wiOiBbMCwgMl0sIFwic2l6ZVwiOiAxMDAwMCwgXCJudW1iZXJcIjogbkFBbmRCfSxcbiAgICAgIC8vIHtcInNldHNcIjogWzEsIDJdLCBcInNpemVcIjogMTAwMDAsIFwibnVtYmVyXCI6IG5BQW5kQn0sXG4gICAgXVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVubiA9IHtcbiBsZXQgdmVubiA9IHt9O1xuICAvKiogZ2l2ZW4gYSBsaXN0IG9mIHNldCBvYmplY3RzLCBhbmQgdGhlaXIgY29ycmVzcG9uZGluZyBvdmVybGFwcy5cbiAgICB1cGRhdGVzIHRoZSAoeCwgeSwgcmFkaXVzKSBhdHRyaWJ1dGUgb24gZWFjaCBzZXQgc3VjaCB0aGF0IHRoZWlyIHBvc2l0aW9uc1xuICAgIHJvdWdobHkgY29ycmVzcG9uZCB0byB0aGUgZGVzaXJlZCBvdmVybGFwcyAqL1xuICAgIHZlbm4udmVubiA9IGZ1bmN0aW9uKHNldHMsIG92ZXJsYXBzLCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgIHBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzIHx8IHt9O1xuICAgICAgICBwYXJhbWV0ZXJzLm1heEl0ZXJhdGlvbnMgPSBwYXJhbWV0ZXJzLm1heEl0ZXJhdGlvbnMgfHwgNTAwO1xuICAgICAgICB2YXIgbG9zc0Z1bmN0aW9uID0gcGFyYW1ldGVycy5sb3NzRnVuY3Rpb24gfHwgdmVubi5sb3NzRnVuY3Rpb247XG4gICAgICAgIHZhciBpbml0aWFsTGF5b3V0ID0gcGFyYW1ldGVycy5sYXlvdXRGdW5jdGlvbiB8fCB2ZW5uLmdyZWVkeUxheW91dDtcblxuICAgICAgICAvLyBpbml0aWFsIGxheW91dCBpcyBkb25lIGdyZWVkaWx5XG4gICAgICAgIHNldHMgPSBpbml0aWFsTGF5b3V0KHNldHMsIG92ZXJsYXBzKTtcblxuICAgICAgICAvLyB0cmFuc2Zvcm0geC95IGNvb3JkaW5hdGVzIHRvIGEgdmVjdG9yIHRvIG9wdGltaXplXG4gICAgICAgIHZhciBpbml0aWFsID0gbmV3IEFycmF5KDIqc2V0cy5sZW5ndGgpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNldHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGluaXRpYWxbMiAqIGldID0gc2V0c1tpXS54O1xuICAgICAgICAgICAgaW5pdGlhbFsyICogaSArIDFdID0gc2V0c1tpXS55O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gb3B0aW1pemUgaW5pdGlhbCBsYXlvdXQgZnJvbSBvdXIgbG9zcyBmdW5jdGlvblxuICAgICAgICB2YXIgdG90YWxGdW5jdGlvbkNhbGxzID0gMDtcbiAgICAgICAgdmFyIHNvbHV0aW9uID0gdmVubi5mbWluKFxuICAgICAgICAgICAgZnVuY3Rpb24odmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgdG90YWxGdW5jdGlvbkNhbGxzICs9IDE7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBuZXcgQXJyYXkoc2V0cy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2V0cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50W2ldID0ge3g6IHZhbHVlc1syICogaV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogdmFsdWVzWzIgKiBpICsgMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaXVzIDogc2V0c1tpXS5yYWRpdXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSA6IHNldHNbaV0uc2l6ZX07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBsb3NzRnVuY3Rpb24oY3VycmVudCwgb3ZlcmxhcHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluaXRpYWwsXG4gICAgICAgICAgICBwYXJhbWV0ZXJzKTtcblxuICAgICAgICAvLyB0cmFuc2Zvcm0gc29sdXRpb24gdmVjdG9yIGJhY2sgdG8geC95IHBvaW50c1xuICAgICAgICB2YXIgcG9zaXRpb25zID0gc29sdXRpb24uc29sdXRpb247XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBzZXRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBzZXRzW2ldLnggPSBwb3NpdGlvbnNbMiAqIGldO1xuICAgICAgICAgICAgc2V0c1tpXS55ID0gcG9zaXRpb25zWzIgKiBpICsgMV07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2V0cztcbiAgICB9O1xuXG4gICAgLyoqIFJldHVybnMgdGhlIGRpc3RhbmNlIG5lY2Vzc2FyeSBmb3IgdHdvIGNpcmNsZXMgb2YgcmFkaXVzIHIxICsgcjIgdG9cbiAgICBoYXZlIHRoZSBvdmVybGFwIGFyZWEgJ292ZXJsYXAnICovXG4gICAgdmVubi5kaXN0YW5jZUZyb21JbnRlcnNlY3RBcmVhID0gZnVuY3Rpb24ocjEsIHIyLCBvdmVybGFwKSB7XG4gICAgICAgIC8vIGhhbmRsZSBjb21wbGV0ZSBvdmVybGFwcGVkIGNpcmNsZXNcbiAgICAgICAgaWYgKE1hdGgubWluKHIxLCByMikgKiBNYXRoLm1pbihyMSxyMikgKiBNYXRoLlBJIDw9IG92ZXJsYXApIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmFicyhyMSAtIHIyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2ZW5uLmJpc2VjdChmdW5jdGlvbihkaXN0YW5jZSkge1xuICAgICAgICAgICAgcmV0dXJuIGNpcmNsZUludGVyc2VjdGlvbi5jaXJjbGVPdmVybGFwKHIxLCByMiwgZGlzdGFuY2UpIC0gb3ZlcmxhcDtcbiAgICAgICAgfSwgMCwgcjEgKyByMik7XG4gICAgfTtcblxuICAgIC8vLyBnZXRzIGEgbWF0cml4IG9mIGV1Y2xpZGVhbiBkaXN0YW5jZXMgYmV0d2VlbiBhbGwgc2V0cyBpbiB2ZW5uIGRpYWdyYW1cbiAgICB2ZW5uLmdldERpc3RhbmNlTWF0cml4ID0gZnVuY3Rpb24oc2V0cywgb3ZlcmxhcHMpIHtcbiAgICAgICAgLy8gaW5pdGlhbGl6ZSBhbiBlbXB0eSBkaXN0YW5jZSBtYXRyaXggYmV0d2VlbiBhbGwgdGhlIHBvaW50c1xuICAgICAgICB2YXIgZGlzdGFuY2VzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2V0cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgZGlzdGFuY2VzLnB1c2goW10pO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZXRzLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICAgICAgZGlzdGFuY2VzW2ldLnB1c2goMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjb21wdXRlIGRpc3RhbmNlcyBiZXR3ZWVuIGFsbCB0aGUgcG9pbnRzXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBvdmVybGFwcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBvdmVybGFwc1tpXTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50LnNldHMubGVuZ3RoICE9PSAyKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBsZWZ0ID0gY3VycmVudC5zZXRzWzBdLFxuICAgICAgICAgICAgICAgIHJpZ2h0ID0gY3VycmVudC5zZXRzWzFdLFxuICAgICAgICAgICAgICAgIHIxID0gTWF0aC5zcXJ0KHNldHNbbGVmdF0uc2l6ZSAvIE1hdGguUEkpLFxuICAgICAgICAgICAgICAgIHIyID0gTWF0aC5zcXJ0KHNldHNbcmlnaHRdLnNpemUgLyBNYXRoLlBJKSxcbiAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IHZlbm4uZGlzdGFuY2VGcm9tSW50ZXJzZWN0QXJlYShyMSwgcjIsIGN1cnJlbnQuc2l6ZSk7XG4gICAgICAgICAgICBkaXN0YW5jZXNbbGVmdF1bcmlnaHRdID0gZGlzdGFuY2VzW3JpZ2h0XVtsZWZ0XSA9IGRpc3RhbmNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkaXN0YW5jZXM7XG4gICAgfTtcblxuICAgIC8qKiBMYXlzIG91dCBhIFZlbm4gZGlhZ3JhbSBncmVlZGlseSwgZ29pbmcgZnJvbSBtb3N0IG92ZXJsYXBwZWQgc2V0cyB0b1xuICAgIGxlYXN0IG92ZXJsYXBwZWQsIGF0dGVtcHRpbmcgdG8gcG9zaXRpb24gZWFjaCBuZXcgc2V0IHN1Y2ggdGhhdCB0aGVcbiAgICBvdmVybGFwcGluZyBhcmVhcyB0byBhbHJlYWR5IHBvc2l0aW9uZWQgc2V0cyBhcmUgYmFzaWNhbGx5IHJpZ2h0ICovXG4gICAgdmVubi5ncmVlZHlMYXlvdXQgPSBmdW5jdGlvbihzZXRzLCBvdmVybGFwcykge1xuICAgICAgICAvLyBnaXZlIGVhY2ggc2V0IGEgZGVmYXVsdCBwb3NpdGlvbiArIHJhZGl1c1xuICAgICAgICB2YXIgc2V0T3ZlcmxhcHMgPSB7fTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZXRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBzZXRPdmVybGFwc1tpXSA9IFtdO1xuICAgICAgICAgICAgc2V0c1tpXS5yYWRpdXMgPSBNYXRoLnNxcnQoc2V0c1tpXS5zaXplIC8gTWF0aC5QSSk7XG4gICAgICAgICAgICBzZXRzW2ldLnggPSBzZXRzW2ldLnkgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gbWFwIGVhY2ggc2V0IHRvIGEgbGlzdCBvZiBhbGwgdGhlIG90aGVyIHNldHMgdGhhdCBvdmVybGFwIGl0XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBvdmVybGFwcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBvdmVybGFwc1tpXTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50LnNldHMubGVuZ3RoICE9PSAyKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBsZWZ0ID0gY3VycmVudC5zZXRzWzBdLCByaWdodCA9IGN1cnJlbnQuc2V0c1sxXTtcbiAgICAgICAgICAgIHNldE92ZXJsYXBzW2xlZnRdLnB1c2ggKHtzZXQ6cmlnaHQsIHNpemU6Y3VycmVudC5zaXplfSk7XG4gICAgICAgICAgICBzZXRPdmVybGFwc1tyaWdodF0ucHVzaCh7c2V0OmxlZnQsICBzaXplOmN1cnJlbnQuc2l6ZX0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZ2V0IGxpc3Qgb2YgbW9zdCBvdmVybGFwcGVkIHNldHNcbiAgICAgICAgdmFyIG1vc3RPdmVybGFwcGVkID0gW107XG4gICAgICAgIGZvciAodmFyIHNldCBpbiBzZXRPdmVybGFwcykge1xuICAgICAgICAgICAgaWYgKHNldE92ZXJsYXBzLmhhc093blByb3BlcnR5KHNldCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IDA7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNldE92ZXJsYXBzW3NldF0ubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZSArPSBzZXRPdmVybGFwc1tzZXRdW2ldLnNpemU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbW9zdE92ZXJsYXBwZWQucHVzaCh7c2V0OiBzZXQsIHNpemU6c2l6ZX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gc29ydCBieSBzaXplIGRlc2NcbiAgICAgICAgZnVuY3Rpb24gc29ydE9yZGVyKGEsYikge1xuICAgICAgICAgICAgcmV0dXJuIGIuc2l6ZSAtIGEuc2l6ZTtcbiAgICAgICAgfVxuICAgICAgICBtb3N0T3ZlcmxhcHBlZC5zb3J0KHNvcnRPcmRlcik7XG5cbiAgICAgICAgLy8ga2VlcCB0cmFjayBvZiB3aGF0IHNldHMgaGF2ZSBiZWVuIGxhaWQgb3V0XG4gICAgICAgIHZhciBwb3NpdGlvbmVkID0ge307XG4gICAgICAgIGZ1bmN0aW9uIGlzUG9zaXRpb25lZChlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXQgaW4gcG9zaXRpb25lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZHMgYSBwb2ludCB0byB0aGUgb3V0cHV0XG4gICAgICAgIGZ1bmN0aW9uIHBvc2l0aW9uU2V0KHBvaW50LCBpbmRleCkge1xuICAgICAgICAgICAgc2V0c1tpbmRleF0ueCA9IHBvaW50Lng7XG4gICAgICAgICAgICBzZXRzW2luZGV4XS55ID0gcG9pbnQueTtcbiAgICAgICAgICAgIHBvc2l0aW9uZWRbaW5kZXhdID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZCBtb3N0IG92ZXJsYXBwZWQgc2V0IGF0ICgwLDApXG4gICAgICAgIHBvc2l0aW9uU2V0KHt4OiAwLCB5OiAwfSwgbW9zdE92ZXJsYXBwZWRbMF0uc2V0KTtcblxuICAgICAgICAvLyBnZXQgZGlzdGFuY2VzIGJldHdlZW4gYWxsIHBvaW50c1xuICAgICAgICB2YXIgZGlzdGFuY2VzID0gdmVubi5nZXREaXN0YW5jZU1hdHJpeChzZXRzLCBvdmVybGFwcyk7XG5cbiAgICAgICAgZm9yIChpID0gMTsgaSA8IG1vc3RPdmVybGFwcGVkLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgc2V0SW5kZXggPSBtb3N0T3ZlcmxhcHBlZFtpXS5zZXQsXG4gICAgICAgICAgICAgICAgb3ZlcmxhcCA9IHNldE92ZXJsYXBzW3NldEluZGV4XS5maWx0ZXIoaXNQb3NpdGlvbmVkKTtcbiAgICAgICAgICAgIHNldCA9IHNldHNbc2V0SW5kZXhdO1xuICAgICAgICAgICAgb3ZlcmxhcC5zb3J0KHNvcnRPcmRlcik7XG5cbiAgICAgICAgICAgIGlmIChvdmVybGFwLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRocm93IFwiTmVlZCBvdmVybGFwIGluZm9ybWF0aW9uIGZvciBzZXQgXCIgKyBKU09OLnN0cmluZ2lmeSggc2V0ICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwb2ludHMgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb3ZlcmxhcC5sZW5ndGg7ICsraikge1xuICAgICAgICAgICAgICAgIC8vIGdldCBhcHByb3ByaWF0ZSBkaXN0YW5jZSBmcm9tIG1vc3Qgb3ZlcmxhcHBlZCBhbHJlYWR5IGFkZGVkIHNldFxuICAgICAgICAgICAgICAgIHZhciBwMSA9IHNldHNbb3ZlcmxhcFtqXS5zZXRdLFxuICAgICAgICAgICAgICAgICAgICBkMSA9IGRpc3RhbmNlc1tzZXRJbmRleF1bb3ZlcmxhcFtqXS5zZXRdO1xuXG4gICAgICAgICAgICAgICAgLy8gc2FtcGxlIHBvc2l0aW9ucyBhdCA5MCBkZWdyZWVzIGZvciBtYXhpbXVtIGFlc3RoZXRpY3NcbiAgICAgICAgICAgICAgICBwb2ludHMucHVzaCh7eCA6IHAxLnggKyBkMSwgeSA6IHAxLnl9KTtcbiAgICAgICAgICAgICAgICBwb2ludHMucHVzaCh7eCA6IHAxLnggLSBkMSwgeSA6IHAxLnl9KTtcbiAgICAgICAgICAgICAgICBwb2ludHMucHVzaCh7eSA6IHAxLnkgKyBkMSwgeCA6IHAxLnh9KTtcbiAgICAgICAgICAgICAgICBwb2ludHMucHVzaCh7eSA6IHAxLnkgLSBkMSwgeCA6IHAxLnh9KTtcblxuICAgICAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgYXQgbGVhc3QgMiBvdmVybGFwcywgdGhlbiBmaWd1cmUgb3V0IHdoZXJlIHRoZVxuICAgICAgICAgICAgICAgIC8vIHNldCBzaG91bGQgYmUgcG9zaXRpb25lZCBhbmFseXRpY2FsbHkgYW5kIHRyeSB0aG9zZSB0b29cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gaiArIDE7IGsgPCBvdmVybGFwLmxlbmd0aDsgKytrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwMiA9IHNldHNbb3ZlcmxhcFtrXS5zZXRdLFxuICAgICAgICAgICAgICAgICAgICAgICAgZDIgPSBkaXN0YW5jZXNbc2V0SW5kZXhdW292ZXJsYXBba10uc2V0XTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZXh0cmFQb2ludHMgPSBjaXJjbGVJbnRlcnNlY3Rpb24uY2lyY2xlQ2lyY2xlSW50ZXJzZWN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgeyB4OiBwMS54LCB5OiBwMS55LCByYWRpdXM6IGQxfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgeDogcDIueCwgeTogcDIueSwgcmFkaXVzOiBkMn0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGwgPSAwOyBsIDwgZXh0cmFQb2ludHMubGVuZ3RoOyArK2wpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cy5wdXNoKGV4dHJhUG9pbnRzW2xdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gd2UgaGF2ZSBzb21lIGNhbmRpZGF0ZSBwb3NpdGlvbnMgZm9yIHRoZSBzZXQsIGV4YW1pbmUgbG9zc1xuICAgICAgICAgICAgLy8gYXQgZWFjaCBwb3NpdGlvbiB0byBmaWd1cmUgb3V0IHdoZXJlIHRvIHB1dCBpdCBhdFxuICAgICAgICAgICAgdmFyIGJlc3RMb3NzID0gMWU1MCwgYmVzdFBvaW50ID0gcG9pbnRzWzBdO1xuICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IHBvaW50cy5sZW5ndGg7ICsraikge1xuICAgICAgICAgICAgICAgIHNldHNbc2V0SW5kZXhdLnggPSBwb2ludHNbal0ueDtcbiAgICAgICAgICAgICAgICBzZXRzW3NldEluZGV4XS55ID0gcG9pbnRzW2pdLnk7XG4gICAgICAgICAgICAgICAgdmFyIGxvc3MgPSB2ZW5uLmxvc3NGdW5jdGlvbihzZXRzLCBvdmVybGFwcyk7XG4gICAgICAgICAgICAgICAgaWYgKGxvc3MgPCBiZXN0TG9zcykge1xuICAgICAgICAgICAgICAgICAgICBiZXN0TG9zcyA9IGxvc3M7XG4gICAgICAgICAgICAgICAgICAgIGJlc3RQb2ludCA9IHBvaW50c1tqXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBvc2l0aW9uU2V0KGJlc3RQb2ludCwgc2V0SW5kZXgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNldHM7XG4gICAgfTtcblxuICAgIC8vLyBVc2VzIG11bHRpZGltZW5zaW9uYWwgc2NhbGluZyB0byBhcHByb3hpbWF0ZSBhIGZpcnN0IGxheW91dCBoZXJlXG4gICAgdmVubi5jbGFzc2ljTURTTGF5b3V0ID0gZnVuY3Rpb24oc2V0cywgb3ZlcmxhcHMpIHtcbiAgICAgICAgLy8gZ2V0IHRoZSBkaXN0YW5jZSBtYXRyaXhcbiAgICAgICAgdmFyIGRpc3RhbmNlcyA9IHZlbm4uZ2V0RGlzdGFuY2VNYXRyaXgoc2V0cywgb3ZlcmxhcHMpO1xuXG4gICAgICAgIC8vIGdldCBwb3NpdGlvbnMgZm9yIGVhY2ggc2V0XG4gICAgICAgIHZhciBwb3NpdGlvbnMgPSBtZHMuY2xhc3NpYyhkaXN0YW5jZXMpO1xuXG4gICAgICAgIC8vIHRyYW5zbGF0ZSBiYWNrIHRvICh4LHkscmFkaXVzKSBjb29yZGluYXRlc1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNldHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHNldHNbaV0ueCA9IHBvc2l0aW9uc1tpXVswXTtcbiAgICAgICAgICAgIHNldHNbaV0ueSA9IHBvc2l0aW9uc1tpXVsxXTtcbiAgICAgICAgICAgIHNldHNbaV0ucmFkaXVzID0gTWF0aC5zcXJ0KHNldHNbaV0uc2l6ZSAvIE1hdGguUEkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZXRzO1xuICAgIH07XG5cbiAgICAvKiogR2l2ZW4gYSBidW5jaCBvZiBzZXRzLCBhbmQgdGhlIGRlc2lyZWQgb3ZlcmxhcHMgYmV0d2VlbiB0aGVzZSBzZXRzIC0gY29tcHV0ZXNcbiAgICB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgYWN0dWFsIG92ZXJsYXBzIHRvIHRoZSBkZXNpcmVkIG92ZXJsYXBzLiBOb3RlIHRoYXRcbiAgICB0aGlzIG1ldGhvZCBpZ25vcmVzIG92ZXJsYXBzIG9mIG1vcmUgdGhhbiAyIGNpcmNsZXMgKi9cbiAgICB2ZW5uLmxvc3NGdW5jdGlvbiA9IGZ1bmN0aW9uKHNldHMsIG92ZXJsYXBzKSB7XG4gICAgICAgIHZhciBvdXRwdXQgPSAwO1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldENpcmNsZXMoaW5kaWNlcykge1xuICAgICAgICAgICAgcmV0dXJuIGluZGljZXMubWFwKGZ1bmN0aW9uKGkpIHsgcmV0dXJuIHNldHNbaV07IH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdmVybGFwcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGFyZWEgPSBvdmVybGFwc1tpXSwgb3ZlcmxhcDtcbiAgICAgICAgICAgIGlmIChhcmVhLnNldHMubGVuZ3RoID09IDIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGVmdCA9IHNldHNbYXJlYS5zZXRzWzBdXSxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHQgPSBzZXRzW2FyZWEuc2V0c1sxXV07XG4gICAgICAgICAgICAgICAgb3ZlcmxhcCA9IGNpcmNsZUludGVyc2VjdGlvbi5jaXJjbGVPdmVybGFwKGxlZnQucmFkaXVzLCByaWdodC5yYWRpdXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpcmNsZUludGVyc2VjdGlvbi5kaXN0YW5jZShsZWZ0LCByaWdodCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvdmVybGFwID0gY2lyY2xlSW50ZXJzZWN0aW9uLmludGVyc2VjdGlvbkFyZWEoZ2V0Q2lyY2xlcyhhcmVhLnNldHMpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb3V0cHV0ICs9IChvdmVybGFwIC0gYXJlYS5zaXplKSAqIChvdmVybGFwIC0gYXJlYS5zaXplKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfTtcblxuICAgIC8qKiBTY2FsZXMgYSBzb2x1dGlvbiBmcm9tIHZlbm4udmVubiBvciB2ZW5uLmdyZWVkeUxheW91dCBzdWNoIHRoYXQgaXQgZml0cyBpblxuICAgIGEgcmVjdGFuZ2xlIG9mIHdpZHRoL2hlaWdodCAtIHdpdGggcGFkZGluZyBhcm91bmQgdGhlIGJvcmRlcnMuICovXG4gICAgdmVubi5zY2FsZVNvbHV0aW9uID0gZnVuY3Rpb24oc29sdXRpb24sIHdpZHRoLCBoZWlnaHQsIHBhZGRpbmcpIHtcbiAgICAgICAgdmFyIG1pbk1heCA9IGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgIHZhciBoaSA9IE1hdGgubWF4LmFwcGx5KG51bGwsIHNvbHV0aW9uLm1hcChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGMpIHsgcmV0dXJuIGNbZF0gKyBjLnJhZGl1czsgfSApKSxcbiAgICAgICAgICAgICAgICBsbyA9IE1hdGgubWluLmFwcGx5KG51bGwsIHNvbHV0aW9uLm1hcChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGMpIHsgcmV0dXJuIGNbZF0gLSBjLnJhZGl1czt9ICkpO1xuICAgICAgICAgICAgcmV0dXJuIHttYXg6aGksIG1pbjpsb307XG4gICAgICAgIH07XG5cbiAgICAgICAgd2lkdGggLT0gMipwYWRkaW5nO1xuICAgICAgICBoZWlnaHQgLT0gMipwYWRkaW5nO1xuXG4gICAgICAgIHZhciB4UmFuZ2UgPSBtaW5NYXgoJ3gnKSxcbiAgICAgICAgICAgIHlSYW5nZSA9IG1pbk1heCgneScpLFxuICAgICAgICAgICAgeFNjYWxpbmcgPSB3aWR0aCAgLyAoeFJhbmdlLm1heCAtIHhSYW5nZS5taW4pLFxuICAgICAgICAgICAgeVNjYWxpbmcgPSBoZWlnaHQgLyAoeVJhbmdlLm1heCAtIHlSYW5nZS5taW4pLFxuICAgICAgICAgICAgc2NhbGluZyA9ICBNYXRoLm1pbih5U2NhbGluZywgeFNjYWxpbmcpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc29sdXRpb24ubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBzZXQgPSBzb2x1dGlvbltpXTtcbiAgICAgICAgICAgIHNldC5yYWRpdXMgPSBzY2FsaW5nICogc2V0LnJhZGl1cztcbiAgICAgICAgICAgIHNldC54ID0gcGFkZGluZyArIChzZXQueCAtIHhSYW5nZS5taW4pICogc2NhbGluZztcbiAgICAgICAgICAgIHNldC55ID0gcGFkZGluZyArIChzZXQueSAtIHlSYW5nZS5taW4pICogc2NhbGluZztcbiAgICAgICAgfVxuICAgICAgICBzb2x1dGlvbi5zY2FsaW5nID0gc2NhbGluZztcblxuICAgICAgICByZXR1cm4gc29sdXRpb247XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHdlaWdodGVkU3VtKGEsIGIpIHtcbiAgICAgICAgdmFyIHJldCA9IG5ldyBBcnJheShhWzFdLmxlbmd0aCB8fCAwKTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByZXQubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgIHJldFtqXSA9IGFbMF0gKiBhWzFdW2pdICsgYlswXSAqIGJbMV1bal07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjZW50ZXJWZW5uRGlhZ3JhbSggZGlhZ3JhbSwgd2lkdGgsIGhlaWdodCwgcGFkZGluZyApIHtcbiAgICAgICAgdmFyIGRpYWdyYW1Cb3VuZGFyaWVzO1xuICAgICAgICB2YXIgYWxsb3dlZFdpZHRoID0gd2lkdGggLSAoIDIgKiAoIHBhZGRpbmcgfHwgMTAgKSApO1xuICAgICAgICB2YXIgYWxsb3dlZEhlaWdodCA9IGhlaWdodCAtICggMiAqICggcGFkZGluZyB8fCAxMCApICk7XG4gICAgICAgIHZhciBzY2FsZTtcbiAgICAgICAgdmFyIHRyYW5zZm9ybVgsIHRyYW5zZm9ybVk7XG4gICAgICAgIHZhciB0cmFuc2Zvcm0gPSBcIlwiO1xuXG4gICAgICAgIGlmICggZGlhZ3JhbSApIHtcbiAgICAgICAgICAgIGRpYWdyYW1Cb3VuZGFyaWVzID0gZGlhZ3JhbVsgMCBdWyAwIF0uZ2V0QkJveCgpO1xuICAgICAgICAgICAgaWYgKCBkaWFncmFtQm91bmRhcmllcyAmJiB3aWR0aCAmJiBoZWlnaHQgKSB7XG5cbiAgICAgICAgICAgICAgICAvLyAgU2VlIGlmIHdlIG5lZWQgdG8gc2NhbGUgdG8gZml0IHRoZSB3aWR0aC9oZWlnaHRcbiAgICAgICAgICAgICAgICBpZiAoIGRpYWdyYW1Cb3VuZGFyaWVzLndpZHRoID4gYWxsb3dlZFdpZHRoICkge1xuICAgICAgICAgICAgICAgICAgICBzY2FsZSA9IGFsbG93ZWRXaWR0aCAvIGRpYWdyYW1Cb3VuZGFyaWVzLndpZHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIGRpYWdyYW1Cb3VuZGFyaWVzLmhlaWdodCA+IGFsbG93ZWRIZWlnaHQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggIXNjYWxlIHx8ICggYWxsb3dlZEhlaWdodCAvIGRpYWdyYW1Cb3VuZGFyaWVzLmhlaWdodCApIDwgc2NhbGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZSA9IGFsbG93ZWRIZWlnaHQgLyBkaWFncmFtQm91bmRhcmllcy5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIHNjYWxlICkge1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm0gPSBcInNjYWxlKFwiICsgc2NhbGUgKyBcIilcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjYWxlID0gMTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICBcbiAgICAgICAgICAgICAgbGV0IHZlbm5XaWR0aCA9IChkYXRhLnNldHNbMV0ueCAtIGRhdGEuc2V0c1swXS54KSArICBkYXRhLnNldHNbMF0ucmFkaXVzICsgZGF0YS5zZXRzWzFdLnJhZGl1c1xuICAgICAgICAgICAgICB0cmFuc2Zvcm1YID0gaFJlY3QgLyAyIC0gdmVubldpZHRoIC8gMjtcbiAgICAgICAgICAgICAgdHJhbnNmb3JtWSA9IHdSZWN0IC8gMiAtIGRhdGEuc2V0c1sxXS55O1xuICAgICAgICAgICAgICAgIGRpYWdyYW0uYXR0ciggXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyB0cmFuc2Zvcm1YICsgXCIsXCIgICsgdHJhbnNmb3JtWSArIFwiKSBcIiArIHRyYW5zZm9ybSApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIGZpbmRzIHRoZSB6ZXJvcyBvZiBhIGZ1bmN0aW9uLCBnaXZlbiB0d28gc3RhcnRpbmcgcG9pbnRzICh3aGljaCBtdXN0XG4gICAgICogaGF2ZSBvcHBvc2l0ZSBzaWducyAqL1xuICAgIHZlbm4uYmlzZWN0ID0gZnVuY3Rpb24oZiwgYSwgYiwgcGFyYW1ldGVycykge1xuICAgICAgICBwYXJhbWV0ZXJzID0gcGFyYW1ldGVycyB8fCB7fTtcbiAgICAgICAgdmFyIG1heEl0ZXJhdGlvbnMgPSBwYXJhbWV0ZXJzLm1heEl0ZXJhdGlvbnMgfHwgMTAwLFxuICAgICAgICAgICAgdG9sZXJhbmNlID0gcGFyYW1ldGVycy50b2xlcmFuY2UgfHwgMWUtMTAsXG4gICAgICAgICAgICBmQSA9IGYoYSksXG4gICAgICAgICAgICBmQiA9IGYoYiksXG4gICAgICAgICAgICBkZWx0YSA9IGIgLSBhO1xuXG4gICAgICAgIGlmIChmQSAqIGZCID4gMCkge1xuICAgICAgICAgICAgdGhyb3cgXCJJbml0aWFsIGJpc2VjdCBwb2ludHMgbXVzdCBoYXZlIG9wcG9zaXRlIHNpZ25zXCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZkEgPT09IDApIHJldHVybiBhO1xuICAgICAgICBpZiAoZkIgPT09IDApIHJldHVybiBiO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4SXRlcmF0aW9uczsgKytpKSB7XG4gICAgICAgICAgICBkZWx0YSAvPSAyO1xuICAgICAgICAgICAgdmFyIG1pZCA9IGEgKyBkZWx0YSxcbiAgICAgICAgICAgICAgICBmTWlkID0gZihtaWQpO1xuXG4gICAgICAgICAgICBpZiAoZk1pZCAqIGZBID49IDApIHtcbiAgICAgICAgICAgICAgICBhID0gbWlkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoKE1hdGguYWJzKGRlbHRhKSA8IHRvbGVyYW5jZSkgfHwgKGZNaWQgPT09IDApKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYSArIGRlbHRhO1xuICAgIH07XG5cbiAgICAvKiogbWluaW1pemVzIGEgZnVuY3Rpb24gdXNpbmcgdGhlIGRvd25oaWxsIHNpbXBsZXggbWV0aG9kICovXG4gICAgdmVubi5mbWluID0gZnVuY3Rpb24oZiwgeDAsIHBhcmFtZXRlcnMpIHtcbiAgICAgICAgcGFyYW1ldGVycyA9IHBhcmFtZXRlcnMgfHwge307XG5cbiAgICAgICAgdmFyIG1heEl0ZXJhdGlvbnMgPSBwYXJhbWV0ZXJzLm1heEl0ZXJhdGlvbnMgfHwgeDAubGVuZ3RoICogMjAwLFxuICAgICAgICAgICAgbm9uWmVyb0RlbHRhID0gcGFyYW1ldGVycy5ub25aZXJvRGVsdGEgfHwgMS4xLFxuICAgICAgICAgICAgemVyb0RlbHRhID0gcGFyYW1ldGVycy56ZXJvRGVsdGEgfHwgMC4wMDEsXG4gICAgICAgICAgICBtaW5FcnJvckRlbHRhID0gcGFyYW1ldGVycy5taW5FcnJvckRlbHRhIHx8IDFlLTUsXG4gICAgICAgICAgICByaG8gPSBwYXJhbWV0ZXJzLnJobyB8fCAxLFxuICAgICAgICAgICAgY2hpID0gcGFyYW1ldGVycy5jaGkgfHwgMixcbiAgICAgICAgICAgIHBzaSA9IHBhcmFtZXRlcnMucHNpIHx8IC0wLjUsXG4gICAgICAgICAgICBzaWdtYSA9IHBhcmFtZXRlcnMuc2lnbWEgfHwgMC41LFxuICAgICAgICAgICAgY2FsbGJhY2sgPSBwYXJhbWV0ZXJzLmNhbGxiYWNrO1xuXG4gICAgICAgIC8vIGluaXRpYWxpemUgc2ltcGxleC5cbiAgICAgICAgdmFyIE4gPSB4MC5sZW5ndGgsXG4gICAgICAgICAgICBzaW1wbGV4ID0gbmV3IEFycmF5KE4gKyAxKTtcbiAgICAgICAgc2ltcGxleFswXSA9IHgwO1xuICAgICAgICBzaW1wbGV4WzBdLmZ4ID0gZih4MCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTjsgKytpKSB7XG4gICAgICAgICAgICB2YXIgcG9pbnQgPSB4MC5zbGljZSgpO1xuICAgICAgICAgICAgcG9pbnRbaV0gPSBwb2ludFtpXSA/IHBvaW50W2ldICogbm9uWmVyb0RlbHRhIDogemVyb0RlbHRhO1xuICAgICAgICAgICAgc2ltcGxleFtpKzFdID0gcG9pbnQ7XG4gICAgICAgICAgICBzaW1wbGV4W2krMV0uZnggPSBmKHBvaW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzb3J0T3JkZXIgPSBmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhLmZ4IC0gYi5meDsgfTtcblxuICAgICAgICBmb3IgKHZhciBpdGVyYXRpb24gPSAwOyBpdGVyYXRpb24gPCBtYXhJdGVyYXRpb25zOyArK2l0ZXJhdGlvbikge1xuICAgICAgICAgICAgc2ltcGxleC5zb3J0KHNvcnRPcmRlcik7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzaW1wbGV4KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKE1hdGguYWJzKHNpbXBsZXhbMF0uZnggLSBzaW1wbGV4W05dLmZ4KSA8IG1pbkVycm9yRGVsdGEpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY29tcHV0ZSB0aGUgY2VudHJvaWQgb2YgYWxsIGJ1dCB0aGUgd29yc3QgcG9pbnQgaW4gdGhlIHNpbXBsZXhcbiAgICAgICAgICAgIHZhciBjZW50cm9pZCA9IG5ldyBBcnJheShOKTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBOOyArK2kpIHtcbiAgICAgICAgICAgICAgICBjZW50cm9pZFtpXSA9IDA7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBOOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgY2VudHJvaWRbaV0gKz0gc2ltcGxleFtqXVtpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2VudHJvaWRbaV0gLz0gTjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gcmVmbGVjdCB0aGUgd29yc3QgcG9pbnQgcGFzdCB0aGUgY2VudHJvaWQgIGFuZCBjb21wdXRlIGxvc3MgYXQgcmVmbGVjdGVkXG4gICAgICAgICAgICAvLyBwb2ludFxuICAgICAgICAgICAgdmFyIHdvcnN0ID0gc2ltcGxleFtOXTtcbiAgICAgICAgICAgIHZhciByZWZsZWN0ZWQgPSB3ZWlnaHRlZFN1bShbMStyaG8sIGNlbnRyb2lkXSwgWy1yaG8sIHdvcnN0XSk7XG4gICAgICAgICAgICByZWZsZWN0ZWQuZnggPSBmKHJlZmxlY3RlZCk7XG5cbiAgICAgICAgICAgIHZhciByZXBsYWNlbWVudCA9IHJlZmxlY3RlZDtcblxuICAgICAgICAgICAgLy8gaWYgdGhlIHJlZmxlY3RlZCBwb2ludCBpcyB0aGUgYmVzdCBzZWVuLCB0aGVuIHBvc3NpYmx5IGV4cGFuZFxuICAgICAgICAgICAgaWYgKHJlZmxlY3RlZC5meCA8PSBzaW1wbGV4WzBdLmZ4KSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4cGFuZGVkID0gd2VpZ2h0ZWRTdW0oWzErY2hpLCBjZW50cm9pZF0sIFstY2hpLCB3b3JzdF0pO1xuICAgICAgICAgICAgICAgIGV4cGFuZGVkLmZ4ID0gZihleHBhbmRlZCk7XG4gICAgICAgICAgICAgICAgaWYgKGV4cGFuZGVkLmZ4IDwgcmVmbGVjdGVkLmZ4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50ID0gZXhwYW5kZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiB0aGUgcmVmbGVjdGVkIHBvaW50IGlzIHdvcnNlIHRoYW4gdGhlIHNlY29uZCB3b3JzdCwgd2UgbmVlZCB0b1xuICAgICAgICAgICAgLy8gY29udHJhY3RcbiAgICAgICAgICAgIGVsc2UgaWYgKHJlZmxlY3RlZC5meCA+PSBzaW1wbGV4W04tMV0uZngpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2hvdWxkUmVkdWNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRyYWN0ZWQ7XG5cbiAgICAgICAgICAgICAgICBpZiAocmVmbGVjdGVkLmZ4IDw9IHdvcnN0LmZ4KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvIGFuIGluc2lkZSBjb250cmFjdGlvblxuICAgICAgICAgICAgICAgICAgICBjb250cmFjdGVkID0gd2VpZ2h0ZWRTdW0oWzErcHNpLCBjZW50cm9pZF0sIFstcHNpLCB3b3JzdF0pO1xuICAgICAgICAgICAgICAgICAgICBjb250cmFjdGVkLmZ4ID0gZihjb250cmFjdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRyYWN0ZWQuZnggPCB3b3JzdC5meCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZW1lbnQgPSBjb250cmFjdGVkO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkUmVkdWNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvIGFuIG91dHNpZGUgY29udHJhY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgY29udHJhY3RlZCA9IHdlaWdodGVkU3VtKFsxLXBzaSAqIHJobywgY2VudHJvaWRdLCBbcHNpKnJobywgd29yc3RdKTtcbiAgICAgICAgICAgICAgICAgICAgY29udHJhY3RlZC5meCA9IGYoY29udHJhY3RlZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250cmFjdGVkLmZ4IDw9IHJlZmxlY3RlZC5meCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZW1lbnQgPSBjb250cmFjdGVkO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkUmVkdWNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzaG91bGRSZWR1Y2UpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZG8gcmVkdWN0aW9uLiBkb2Vzbid0IGFjdHVhbGx5IGhhcHBlbiB0aGF0IG9mdGVuXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCBzaW1wbGV4Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGV4W2ldID0gd2VpZ2h0ZWRTdW0oWzEgLSBzaWdtYSwgc2ltcGxleFswXV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW3NpZ21hIC0gMSwgc2ltcGxleFtpXV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxleFtpXS5meCA9IGYoc2ltcGxleFtpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNpbXBsZXhbTl0gPSByZXBsYWNlbWVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIHNpbXBsZXguc29ydChzb3J0T3JkZXIpO1xuICAgICAgICByZXR1cm4ge2YgOiBzaW1wbGV4WzBdLmZ4LFxuICAgICAgICAgICAgICAgIHNvbHV0aW9uIDogc2ltcGxleFswXX07XG4gICAgfTtcblxuICAgIC8qKiByZXR1cm5zIGEgc3ZnIHBhdGggb2YgdGhlIGludGVyc2VjdGlvbiBhcmVhIG9mIGEgYnVuY2ggb2YgY2lyY2xlcyAqL1xuICAgIHZlbm4uaW50ZXJzZWN0aW9uQXJlYVBhdGggPSBmdW5jdGlvbihjaXJjbGVzKSB7XG4gICAgICAgIHZhciBzdGF0cyA9IHt9O1xuICAgICAgICBjaXJjbGVJbnRlcnNlY3Rpb24uaW50ZXJzZWN0aW9uQXJlYShjaXJjbGVzLCBzdGF0cyk7XG4gICAgICAgIHZhciBhcmNzID0gc3RhdHMuYXJjcztcblxuICAgICAgICBpZiAoYXJjcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFwiTSAwIDBcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZXQgPSBbXCJcXG5NXCIsIGFyY3NbMF0ucDIueCwgYXJjc1swXS5wMi55XTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmNzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgYXJjID0gYXJjc1tpXSwgciA9IGFyYy5jaXJjbGUucmFkaXVzLCB3aWRlID0gYXJjLndpZHRoID4gcjtcbiAgICAgICAgICAgIHJldC5wdXNoKFwiXFxuQVwiLCByLCByLCAwLCB3aWRlID8gMSA6IDAsIDEsIGFyYy5wMS54LCBhcmMucDEueSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmV0LmpvaW4oXCIgXCIpO1xuICAgIH1cbiAgXG4gICAgIHZlbm4uaW50ZXJzZWN0aW9uQXJlYVNwbGl0UGF0aCA9IGZ1bmN0aW9uKGNpcmNsZXMsIGlzUmlnaHRQYXRoLCBpc0xlZnRQYXRoKSB7XG4gICAgICAgIHZhciBzdGF0cyA9IHt9O1xuICAgICAgICBjaXJjbGVJbnRlcnNlY3Rpb24uaW50ZXJzZWN0aW9uQXJlYShjaXJjbGVzLCBzdGF0cyk7XG4gICAgICAgIHZhciBhcmNzID0gc3RhdHMuYXJjcztcblxuICAgICAgICBpZiAoYXJjcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFwiTSAwIDBcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZXQgPSBbXCJcXG5NXCIsIGFyY3NbMF0ucDIueCwgYXJjc1swXS5wMi55XTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmNzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgYXJjID0gYXJjc1tpXSwgciA9IGFyYy5jaXJjbGUucmFkaXVzLCB3aWRlID0gYXJjLndpZHRoID4gcjtcbiAgICAgICAgICAgIGlmKCAoaT09MSAmJiBpc1JpZ2h0UGF0aCkgfHwgKGk9PTAgJiYgaXNMZWZ0UGF0aCkpe1xuICAgICAgICAgICAgICByZXQucHVzaChcIlxcbkFcIiwgciwgciwgMCwgd2lkZSA/IDEgOiAwLCAxLCBhcmMucDEueCwgYXJjLnAxLnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgcmV0LnB1c2goXCJcXG5BXCIsIDAsIDAsIDAsIHdpZGUgPyAxIDogMCwgMSwgYXJjLnAxLngsIGFyYy5wMS55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmV0LmpvaW4oXCIgXCIpO1xuICAgIH1cbiAgICBcbiAgICB2ZW5uLmRyYXdEM0RpYWdyYW0gPSBmdW5jdGlvbihlbGVtZW50LCBkYXRhc2V0LCB3aWR0aCwgaGVpZ2h0LCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgIHBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzIHx8IHt9O1xuXG4gICAgICAgIHZhciBjb2xvdXJzID0gZDMuc2NhbGUuY2F0ZWdvcnkxMCgpLFxuICAgICAgICAgICAgY2lyY2xlRmlsbENvbG91cnMgPSBwYXJhbWV0ZXJzLmNpcmNsZUZpbGxDb2xvdXJzIHx8IGNvbG91cnMsXG4gICAgICAgICAgICBjaXJjbGVTdHJva2VDb2xvdXJzID0gcGFyYW1ldGVycy5jaXJjbGVTdHJva2VDb2xvdXJzIHx8IGNpcmNsZUZpbGxDb2xvdXJzLFxuICAgICAgICAgICAgY2lyY2xlU3Ryb2tlV2lkdGggPSBwYXJhbWV0ZXJzLmNpcmNsZVN0cm9rZVdpZHRoIHx8IGZ1bmN0aW9uKGkpIHsgcmV0dXJuIDA7IH0sXG4gICAgICAgICAgICB0ZXh0RmlsbENvbG91cnMgPSBwYXJhbWV0ZXJzLnRleHRGaWxsQ29sb3VycyB8fCBjb2xvdXJzLFxuICAgICAgICAgICAgdGV4dFN0cm9rZUNvbG91cnMgPSBwYXJhbWV0ZXJzLnRleHRTdHJva2VDb2xvdXJzIHx8IHRleHRGaWxsQ29sb3VycyxcbiAgICAgICAgICAgIG5vZGVPcGFjaXR5ID0gcGFyYW1ldGVycy5vcGFjaXR5IHx8IDAuMyxcbiAgICAgICAgICAgIHBhZGRpbmcgPSBwYXJhbWV0ZXJzLnBhZGRpbmcgfHwgMTA7XG5cbiAgICAgICAgZGF0YXNldCA9IHZlbm4uc2NhbGVTb2x1dGlvbihkYXRhc2V0LCB3aWR0aCwgaGVpZ2h0LCBwYWRkaW5nKTtcbiAgICAgICAgdmFyIHN2ZyA9IGVsZW1lbnQuYXBwZW5kKFwic3ZnXCIpLmF0dHIoJ2lkJywgJ3N2Zy13cmFwcGVyJyk7XG4gICAgICAgIHZhciBkaWFncmFtID0gc3ZnLmFwcGVuZCggXCJnXCIgKS5hdHRyKCdpZCcsICd1bmlvbi1hbGwnKTtcbiAgICAgICAgdmFyIG5vZGVzID0gZGlhZ3JhbS5hcHBlbmQoXCJnXCIpLnNlbGVjdEFsbChcImdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShkYXRhc2V0LCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5sYWJlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgdmFyIG5vZGVFbnRlciA9IG5vZGVzLmVudGVyKClcbiAgICAgICAgICAuYXBwZW5kKFwiZ1wiKS5hdHRyKFwic3R5bGVcIiwgXCJ0cmFuc2l0aW9uOiBvcGFjaXR5IDJzXCIpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ25vZGUnKTtcblxuICAgICAgICBub2RlRW50ZXIuYXBwZW5kKFwiY2lyY2xlXCIpLmF0dHIoXCJpZFwiLCAgZnVuY3Rpb24oZCkgeyByZXR1cm4gYGNpcmNsZS0ke2QubGFiZWx9YCB9KVxuICAgICAgICAgICAgICAgLmF0dHIoXCJyXCIsICBmdW5jdGlvbihkKSB7IHJldHVybiBkLnJhZGl1czsgfSlcbiAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGwtb3BhY2l0eVwiLCBub2RlT3BhY2l0eSlcbiAgICAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC54OyB9KVxuICAgICAgICAgICAgICAgLmF0dHIoXCJjeVwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnk7IH0pXG4gICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gY2lyY2xlU3Ryb2tlQ29sb3VycyhpKTsgfSlcbiAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiBjaXJjbGVTdHJva2VXaWR0aChpKTsgfSlcbiAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gY2lyY2xlRmlsbENvbG91cnMoaSk7IH0pO1xuXG4gICAgICAgIG5vZGVFbnRlci5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gZC54ICsgKGQucmFkaXVzICsgMjApICogTWF0aC5zaW4oLU1hdGguUEkgLyAzICsgaSAqIDIgKiAgTWF0aC5QSSAvIDMpOyB9KVxuICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuIGQueSAtIChkLnJhZGl1cyArIDIwKSAqIE1hdGguY29zKC1NYXRoLlBJIC8gMyArIGkgKiAyICogIE1hdGguUEkgLyAzKTsgfSlcbiAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIwLjM1ZW1cIilcbiAgICAgICAgICAgICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSlcbiAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiB0ZXh0U3Ryb2tlQ29sb3VycyhpKTsgfSlcbiAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gdGV4dEZpbGxDb2xvdXJzKGkpOyB9KVxuICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sYWJlbDsgfSk7XG5cbiAgICAgICAgdmFyIGNpcmNsZXMgPSBub2Rlcy5zZWxlY3RBbGwoXCJjaXJjbGVcIik7XG5cbiAgICAgICAgdmFyIHRleHQgPSBub2Rlcy5zZWxlY3RBbGwoXCJ0ZXh0XCIpO1xuICAgICAgICBjZW50ZXJWZW5uRGlhZ3JhbSggZGlhZ3JhbSwgd2lkdGgsIGhlaWdodCwgcGFkZGluZyApO1xuICAgICAgICByZXR1cm4geydzdmcnIDogc3ZnLFxuICAgICAgICAgICAgICAgICdub2RlcycgOiBub2RlcyxcbiAgICAgICAgICAgICAgICAnY2lyY2xlcycgOiBjaXJjbGVzLFxuICAgICAgICAgICAgICAgICd0ZXh0JyA6IHRleHQgfTtcbiAgICB9O1xuXG4gICAgdmVubi51cGRhdGVEM0RpYWdyYW0gPSBmdW5jdGlvbihlbGVtZW50LCBkYXRhc2V0LCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgIHBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzIHx8IHt9O1xuXG4gICAgICAgIHZhciBjb2xvdXJzID0gZDMuc2NhbGUuY2F0ZWdvcnkxMCgpLFxuICAgICAgICAgICAgY2lyY2xlRmlsbENvbG91cnMgPSBwYXJhbWV0ZXJzLmNpcmNsZUZpbGxDb2xvdXJzIHx8IGNvbG91cnMsXG4gICAgICAgICAgICBjaXJjbGVTdHJva2VDb2xvdXJzID0gcGFyYW1ldGVycy5jaXJjbGVTdHJva2VDb2xvdXJzIHx8IGNpcmNsZUZpbGxDb2xvdXJzLFxuICAgICAgICAgICAgY2lyY2xlU3Ryb2tlV2lkdGggPSBwYXJhbWV0ZXJzLmNpcmNsZVN0cm9rZVdpZHRoIHx8IGZ1bmN0aW9uKGkpIHsgcmV0dXJuIDA7IH0sXG4gICAgICAgICAgICB0ZXh0RmlsbENvbG91cnMgPSBwYXJhbWV0ZXJzLnRleHRGaWxsQ29sb3VycyB8fCBjb2xvdXJzLFxuICAgICAgICAgICAgdGV4dFN0cm9rZUNvbG91cnMgPSBwYXJhbWV0ZXJzLnRleHRTdHJva2VDb2xvdXJzIHx8IHRleHRGaWxsQ29sb3VycyxcbiAgICAgICAgICAgIG5vZGVPcGFjaXR5ID0gcGFyYW1ldGVycy5vcGFjaXR5IHx8IDAuMyxcbiAgICAgICAgICAgIHBhZGRpbmcgPSBwYXJhbWV0ZXJzLnBhZGRpbmcgfHwgMDtcblxuICAgICAgICB2YXIgc3ZnID0gZWxlbWVudC5zZWxlY3QoXCJzdmdcIiksXG4gICAgICAgICAgICB3aWR0aCA9IHBhcnNlSW50KHN2Zy5hdHRyKCd3aWR0aCcpLCAxMCksXG4gICAgICAgICAgICBoZWlnaHQgPSBwYXJzZUludChzdmcuYXR0cignaGVpZ2h0JyksIDEwKSxcbiAgICAgICAgICAgIGNpcmNsZXMsIHRleHRzO1xuXG4gICAgICAgIGRhdGFzZXQgPSB2ZW5uLnNjYWxlU29sdXRpb24oZGF0YXNldCwgd2lkdGgsIGhlaWdodCwgMCk7XG4gICAgICAgIHZhciBub2RlcyA9IHN2Zy5zZWxlY3QoJ2cnKS5zZWxlY3QoJ2cnKS5zZWxlY3RBbGwoXCJnLm5vZGVcIilcbiAgICAgICAgICAgIC5kYXRhKGRhdGFzZXQsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubGFiZWw7IH0pO1xuXG4gICAgICAgIG5vZGVzLmV4aXQoKS5yZW1vdmUoKTtcblxuICAgICAgICB2YXIgbm9kZUVudGVyID0gbm9kZXMuZW50ZXIoKVxuICAgICAgICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ25vZGUnKTtcblxuICAgICAgICBub2RlRW50ZXIuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsLW9wYWNpdHlcIiwgbm9kZU9wYWNpdHkpXG4gICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gY2lyY2xlU3Ryb2tlQ29sb3VycyhpKTsgfSlcbiAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiBjaXJjbGVTdHJva2VXaWR0aChpKTsgfSlcbiAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gY2lyY2xlRmlsbENvbG91cnMoaSk7IH0pO1xuXG4gICAgICAgIG5vZGVFbnRlci5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiMC4zNWVtXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgZm9udFNpemUpXG4gICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gdGV4dFN0cm9rZUNvbG91cnMoaSk7IH0pXG4gICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuIHRleHRGaWxsQ29sb3VycyhpKTsgfSlcblxuICAgICAgICBub2Rlcy5zZWxlY3QoXCJjaXJjbGVcIilcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5kdXJhdGlvbig0MDApXG4gICAgICAgICAgICAuYXR0cihcImN4XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueDsgfSlcbiAgICAgICAgICAgIC5hdHRyKFwiY3lcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC55OyB9KVxuICAgICAgICAgICAgLmF0dHIoXCJyXCIsICBmdW5jdGlvbihkKSB7IHJldHVybiBkLnJhZGl1czsgfSk7XG5cbiAgICAgICAgbm9kZXMuc2VsZWN0KFwidGV4dFwiKVxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmR1cmF0aW9uKDQwMClcbiAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubGFiZWw7IH0pXG4gICAgICAgICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIGZvbnRTaXplKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueDsgfSlcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnk7IH0pO1xuICAgIH07XG4gIFxuICByZXR1cm4gdmVubjtcblxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImNpcmNsZUludGVyc2VjdGlvbiA9IHtcbiAgbGV0IGNpcmNsZUludGVyc2VjdGlvbiA9IHt9XG4gIHZhciBTTUFMTCA9IDFlLTEwO1xuXG4gICAgLyoqIFJldHVybnMgdGhlIGludGVyc2VjdGlvbiBhcmVhIG9mIGEgYnVuY2ggb2YgY2lyY2xlcyAod2hlcmUgZWFjaCBjaXJjbGVcbiAgICAgaXMgYW4gb2JqZWN0IGhhdmluZyBhbiB4LHkgYW5kIHJhZGl1cyBwcm9wZXJ0eSkgKi9cbiAgICBjaXJjbGVJbnRlcnNlY3Rpb24uaW50ZXJzZWN0aW9uQXJlYSA9IGZ1bmN0aW9uKGNpcmNsZXMsIHN0YXRzKSB7XG4gICAgICAgIC8vIGdldCBhbGwgdGhlIGludGVyc2VjdGlvbiBwb2ludHMgb2YgdGhlIGNpcmNsZXNcbiAgICAgICAgdmFyIGludGVyc2VjdGlvblBvaW50cyA9IGdldEludGVyc2VjdGlvblBvaW50cyhjaXJjbGVzKTtcblxuICAgICAgICAvLyBmaWx0ZXIgb3V0IHBvaW50cyB0aGF0IGFyZW4ndCBpbmNsdWRlZCBpbiBhbGwgdGhlIGNpcmNsZXNcbiAgICAgICAgdmFyIGlubmVyUG9pbnRzID0gaW50ZXJzZWN0aW9uUG9pbnRzLmZpbHRlcihmdW5jdGlvbiAocCkge1xuICAgICAgICAgICAgcmV0dXJuIGNpcmNsZUludGVyc2VjdGlvbi5jb250YWluZWRJbkNpcmNsZXMocCwgY2lyY2xlcyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBhcmNBcmVhID0gMCwgcG9seWdvbkFyZWEgPSAwLCBhcmNzID0gW10sIGk7XG5cbiAgICAgICAgLy8gaWYgd2UgaGF2ZSBpbnRlcnNlY3Rpb24gcG9pbnRzIHRoYXQgYXJlIHdpdGhpbiBhbGwgdGhlIGNpcmNsZXMsXG4gICAgICAgIC8vIHRoZW4gZmlndXJlIG91dCB0aGUgYXJlYSBjb250YWluZWQgYnkgdGhlbVxuICAgICAgICBpZiAoaW5uZXJQb2ludHMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgLy8gc29ydCB0aGUgcG9pbnRzIGJ5IGFuZ2xlIGZyb20gdGhlIGNlbnRlciBvZiB0aGUgcG9seWdvbiwgd2hpY2ggbGV0c1xuICAgICAgICAgICAgLy8gdXMganVzdCBpdGVyYXRlIG92ZXIgcG9pbnRzIHRvIGdldCB0aGUgZWRnZXNcbiAgICAgICAgICAgIHZhciBjZW50ZXIgPSBjaXJjbGVJbnRlcnNlY3Rpb24uZ2V0Q2VudGVyKGlubmVyUG9pbnRzKTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpbm5lclBvaW50cy5sZW5ndGg7ICsraSApIHtcbiAgICAgICAgICAgICAgICB2YXIgcCA9IGlubmVyUG9pbnRzW2ldO1xuICAgICAgICAgICAgICAgIHAuYW5nbGUgPSBNYXRoLmF0YW4yKHAueCAtIGNlbnRlci54LCBwLnkgLSBjZW50ZXIueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbm5lclBvaW50cy5zb3J0KGZ1bmN0aW9uKGEsYikgeyByZXR1cm4gYi5hbmdsZSAtIGEuYW5nbGU7fSk7XG5cbiAgICAgICAgICAgIC8vIGl0ZXJhdGUgb3ZlciBhbGwgcG9pbnRzLCBnZXQgYXJjIGJldHdlZW4gdGhlIHBvaW50c1xuICAgICAgICAgICAgLy8gYW5kIHVwZGF0ZSB0aGUgYXJlYXNcbiAgICAgICAgICAgIHZhciBwMiA9IGlubmVyUG9pbnRzW2lubmVyUG9pbnRzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGlubmVyUG9pbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHAxID0gaW5uZXJQb2ludHNbaV07XG5cbiAgICAgICAgICAgICAgICAvLyBwb2x5Z29uIGFyZWEgdXBkYXRlcyBlYXNpbHkgLi4uXG4gICAgICAgICAgICAgICAgcG9seWdvbkFyZWEgKz0gKHAyLnggKyBwMS54KSAqIChwMS55IC0gcDIueSk7XG5cbiAgICAgICAgICAgICAgICAvLyB1cGRhdGluZyB0aGUgYXJjIGFyZWEgaXMgYSBsaXR0bGUgbW9yZSBpbnZvbHZlZFxuICAgICAgICAgICAgICAgIHZhciBtaWRQb2ludCA9IHt4IDogKHAxLnggKyBwMi54KSAvIDIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgOiAocDEueSArIHAyLnkpIC8gMn0sXG4gICAgICAgICAgICAgICAgICAgIGFyYyA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHAxLnBhcmVudEluZGV4Lmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwMi5wYXJlbnRJbmRleC5pbmRleE9mKHAxLnBhcmVudEluZGV4W2pdKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBmaWd1cmUgb3V0IHRoZSBhbmdsZSBoYWxmd2F5IGJldHdlZW4gdGhlIHR3byBwb2ludHNcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9uIHRoZSBjdXJyZW50IGNpcmNsZVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNpcmNsZSA9IGNpcmNsZXNbcDEucGFyZW50SW5kZXhbal1dLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGExID0gTWF0aC5hdGFuMihwMS54IC0gY2lyY2xlLngsIHAxLnkgLSBjaXJjbGUueSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYTIgPSBNYXRoLmF0YW4yKHAyLnggLSBjaXJjbGUueCwgcDIueSAtIGNpcmNsZS55KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFuZ2xlRGlmZiA9IChhMiAtIGExKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbmdsZURpZmYgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5nbGVEaWZmICs9IDIqTWF0aC5QSTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHVzZSB0aGF0IGFuZ2xlIHRvIGZpZ3VyZSBvdXQgdGhlIHdpZHRoIG9mIHRoZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXJjXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGEyIC0gYW5nbGVEaWZmLzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBjaXJjbGVJbnRlcnNlY3Rpb24uZGlzdGFuY2UobWlkUG9pbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCA6IGNpcmNsZS54ICsgY2lyY2xlLnJhZGl1cyAqIE1hdGguc2luKGEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5IDogY2lyY2xlLnkgKyBjaXJjbGUucmFkaXVzICogTWF0aC5jb3MoYSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGljayB0aGUgY2lyY2xlIHdob3NlIGFyYyBoYXMgdGhlIHNtYWxsZXN0IHdpZHRoXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGFyYyA9PT0gbnVsbCkgfHwgKGFyYy53aWR0aCA+IHdpZHRoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyYyA9IHsgY2lyY2xlIDogY2lyY2xlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggOiB3aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAxIDogcDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMiA6IHAyfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhcmNzLnB1c2goYXJjKTtcbiAgICAgICAgICAgICAgICBhcmNBcmVhICs9IGNpcmNsZUludGVyc2VjdGlvbi5jaXJjbGVBcmVhKGFyYy5jaXJjbGUucmFkaXVzLCBhcmMud2lkdGgpO1xuICAgICAgICAgICAgICAgIHAyID0gcDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBubyBpbnRlcnNlY3Rpb24gcG9pbnRzLCBpcyBlaXRoZXIgZGlzam9pbnQgLSBvciBpcyBjb21wbGV0ZWx5XG4gICAgICAgICAgICAvLyBvdmVybGFwcGVkLiBmaWd1cmUgb3V0IHdoaWNoIGJ5IGV4YW1pbmluZyB0aGUgc21hbGxlc3QgY2lyY2xlXG4gICAgICAgICAgICB2YXIgc21hbGxlc3QgPSBjaXJjbGVzWzBdO1xuICAgICAgICAgICAgZm9yIChpID0gMTsgaSA8IGNpcmNsZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2lyY2xlc1tpXS5yYWRpdXMgPCBzbWFsbGVzdC5yYWRpdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgc21hbGxlc3QgPSBjaXJjbGVzW2ldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBzbWFsbGVzdCBjaXJjbGUgaXMgY29tcGxldGVseSBjb250YWluZWQgaW4gYWxsXG4gICAgICAgICAgICAvLyB0aGUgb3RoZXIgY2lyY2xlc1xuICAgICAgICAgICAgdmFyIGRpc2pvaW50ID0gZmFsc2U7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2lyY2xlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIGlmIChjaXJjbGVJbnRlcnNlY3Rpb24uZGlzdGFuY2UoY2lyY2xlc1tpXSwgc21hbGxlc3QpID4gTWF0aC5hYnMoc21hbGxlc3QucmFkaXVzIC0gY2lyY2xlc1tpXS5yYWRpdXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc2pvaW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGlzam9pbnQpIHtcbiAgICAgICAgICAgICAgICBhcmNBcmVhID0gcG9seWdvbkFyZWEgPSAwO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFyY0FyZWEgPSBzbWFsbGVzdC5yYWRpdXMgKiBzbWFsbGVzdC5yYWRpdXMgKiBNYXRoLlBJO1xuICAgICAgICAgICAgICAgIGFyY3MucHVzaCh7Y2lyY2xlIDogc21hbGxlc3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBwMTogeyB4OiBzbWFsbGVzdC54LCAgICAgICAgeSA6IHNtYWxsZXN0LnkgKyBzbWFsbGVzdC5yYWRpdXN9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgcDI6IHsgeDogc21hbGxlc3QueCAtIFNNQUxMLCB5IDogc21hbGxlc3QueSArIHNtYWxsZXN0LnJhZGl1c30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA6IHNtYWxsZXN0LnJhZGl1cyAqIDIgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBwb2x5Z29uQXJlYSAvPSAyO1xuICAgICAgICBpZiAoc3RhdHMpIHtcbiAgICAgICAgICAgIHN0YXRzLmFyZWEgPSBhcmNBcmVhICsgcG9seWdvbkFyZWE7XG4gICAgICAgICAgICBzdGF0cy5hcmNBcmVhID0gYXJjQXJlYTtcbiAgICAgICAgICAgIHN0YXRzLnBvbHlnb25BcmVhID0gcG9seWdvbkFyZWE7XG4gICAgICAgICAgICBzdGF0cy5hcmNzID0gYXJjcztcbiAgICAgICAgICAgIHN0YXRzLmlubmVyUG9pbnRzID0gaW5uZXJQb2ludHM7XG4gICAgICAgICAgICBzdGF0cy5pbnRlcnNlY3Rpb25Qb2ludHMgPSBpbnRlcnNlY3Rpb25Qb2ludHM7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXJjQXJlYSArIHBvbHlnb25BcmVhO1xuICAgIH07XG5cbiAgICAvKiogcmV0dXJucyB3aGV0aGVyIGEgcG9pbnQgaXMgY29udGFpbmVkIGJ5IGFsbCBvZiBhIGxpc3Qgb2YgY2lyY2xlcyAqL1xuICAgIGNpcmNsZUludGVyc2VjdGlvbi5jb250YWluZWRJbkNpcmNsZXMgPSBmdW5jdGlvbihwb2ludCwgY2lyY2xlcykge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNpcmNsZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChjaXJjbGVJbnRlcnNlY3Rpb24uZGlzdGFuY2UocG9pbnQsIGNpcmNsZXNbaV0pID4gY2lyY2xlc1tpXS5yYWRpdXMgKyBTTUFMTCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgLyoqIEdldHMgYWxsIGludGVyc2VjdGlvbiBwb2ludHMgYmV0d2VlbiBhIGJ1bmNoIG9mIGNpcmNsZXMgKi9cbiAgICBmdW5jdGlvbiBnZXRJbnRlcnNlY3Rpb25Qb2ludHMoY2lyY2xlcykge1xuICAgICAgICB2YXIgcmV0ID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2lyY2xlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IGkgKyAxOyBqIDwgY2lyY2xlcy5sZW5ndGg7ICsraikge1xuICAgICAgICAgICAgICAgIHZhciBpbnRlcnNlY3QgPSBjaXJjbGVJbnRlcnNlY3Rpb24uY2lyY2xlQ2lyY2xlSW50ZXJzZWN0aW9uKGNpcmNsZXNbaV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpcmNsZXNbal0pO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgaW50ZXJzZWN0Lmxlbmd0aDsgKytrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gaW50ZXJzZWN0W2tdO1xuICAgICAgICAgICAgICAgICAgICBwLnBhcmVudEluZGV4ID0gW2ksal07XG4gICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKHApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cblxuICAgIGNpcmNsZUludGVyc2VjdGlvbi5jaXJjbGVJbnRlZ3JhbCA9IGZ1bmN0aW9uKHIsIHgpIHtcbiAgICAgICAgdmFyIHkgPSBNYXRoLnNxcnQociAqIHIgLSB4ICogeCk7XG4gICAgICAgIHJldHVybiB4ICogeSArIHIgKiByICogTWF0aC5hdGFuMih4LCB5KTtcbiAgICB9O1xuXG4gICAgLyoqIFJldHVybnMgdGhlIGFyZWEgb2YgYSBjaXJjbGUgb2YgcmFkaXVzIHIgLSB1cCB0byB3aWR0aCAqL1xuICAgIGNpcmNsZUludGVyc2VjdGlvbi5jaXJjbGVBcmVhID0gZnVuY3Rpb24ociwgd2lkdGgpIHtcbiAgICAgICAgcmV0dXJuIGNpcmNsZUludGVyc2VjdGlvbi5jaXJjbGVJbnRlZ3JhbChyLCB3aWR0aCAtIHIpIC0gY2lyY2xlSW50ZXJzZWN0aW9uLmNpcmNsZUludGVncmFsKHIsIC1yKTtcbiAgICB9O1xuXG5cbiAgICAvKiogZXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50cyAqL1xuICAgIGNpcmNsZUludGVyc2VjdGlvbi5kaXN0YW5jZSA9IGZ1bmN0aW9uKHAxLCBwMikge1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KChwMS54IC0gcDIueCkgKiAocDEueCAtIHAyLngpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAocDEueSAtIHAyLnkpICogKHAxLnkgLSBwMi55KSk7XG4gICAgfTtcblxuXG4gICAgLyoqIFJldHVybnMgdGhlIG92ZXJsYXAgYXJlYSBvZiB0d28gY2lyY2xlcyBvZiByYWRpdXMgcjEgYW5kIHIyIC0gdGhhdFxuICAgIGhhdmUgdGhlaXIgY2VudGVycyBzZXBhcmF0ZWQgYnkgZGlzdGFuY2UgZC4gU2ltcGxlciBmYXN0ZXJcbiAgICBjaXJjbGUgaW50ZXJzZWN0aW9uIGZvciBvbmx5IHR3byBjaXJjbGVzICovXG4gICAgY2lyY2xlSW50ZXJzZWN0aW9uLmNpcmNsZU92ZXJsYXAgPSBmdW5jdGlvbihyMSwgcjIsIGQpIHtcbiAgICAgICAgLy8gbm8gb3ZlcmxhcFxuICAgICAgICBpZiAoZCA+PSByMSArIHIyKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNvbXBsZXRlbHkgb3ZlcmxhcHBlZFxuICAgICAgICBpZiAoZCA8PSBNYXRoLmFicyhyMSAtIHIyKSkge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguUEkgKiBNYXRoLm1pbihyMSwgcjIpICogTWF0aC5taW4ocjEsIHIyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB3MSA9IHIxIC0gKGQgKiBkIC0gcjIgKiByMiArIHIxICogcjEpIC8gKDIgKiBkKSxcbiAgICAgICAgICAgIHcyID0gcjIgLSAoZCAqIGQgLSByMSAqIHIxICsgcjIgKiByMikgLyAoMiAqIGQpO1xuICAgICAgICByZXR1cm4gY2lyY2xlSW50ZXJzZWN0aW9uLmNpcmNsZUFyZWEocjEsIHcxKSArIGNpcmNsZUludGVyc2VjdGlvbi5jaXJjbGVBcmVhKHIyLCB3Mik7XG4gICAgfTtcblxuXG4gICAgLyoqIEdpdmVuIHR3byBjaXJjbGVzIChjb250YWluaW5nIGEgeC95L3JhZGl1cyBhdHRyaWJ1dGVzKSxcbiAgICByZXR1cm5zIHRoZSBpbnRlcnNlY3RpbmcgcG9pbnRzIGlmIHBvc3NpYmxlLlxuICAgIG5vdGU6IGRvZXNuJ3QgaGFuZGxlIGNhc2VzIHdoZXJlIHRoZXJlIGFyZSBpbmZpbml0ZWx5IG1hbnlcbiAgICBpbnRlcnNlY3Rpb24gcG9pbnRzIChjaXJjbGVzIGFyZSBlcXVpdmFsZW50KTosIG9yIG9ubHkgb25lIGludGVyc2VjdGlvbiBwb2ludCovXG4gICAgY2lyY2xlSW50ZXJzZWN0aW9uLmNpcmNsZUNpcmNsZUludGVyc2VjdGlvbiA9IGZ1bmN0aW9uKHAxLCBwMikge1xuICAgICAgICB2YXIgZCA9IGNpcmNsZUludGVyc2VjdGlvbi5kaXN0YW5jZShwMSwgcDIpLFxuICAgICAgICAgICAgcjEgPSBwMS5yYWRpdXMsXG4gICAgICAgICAgICByMiA9IHAyLnJhZGl1cztcblxuICAgICAgICAvLyBpZiB0byBmYXIgYXdheSwgb3Igc2VsZiBjb250YWluZWQgLSBjYW4ndCBiZSBkb25lXG4gICAgICAgIGlmICgoZCA+PSAocjEgKyByMikpIHx8IChkIDw9IE1hdGguYWJzKHIxIC0gcjIpKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGEgPSAocjEgKiByMSAtIHIyICogcjIgKyBkICogZCkgLyAoMiAqIGQpLFxuICAgICAgICAgICAgaCA9IE1hdGguc3FydChyMSAqIHIxIC0gYSAqIGEpLFxuICAgICAgICAgICAgeDAgPSBwMS54ICsgYSAqIChwMi54IC0gcDEueCkgLyBkLFxuICAgICAgICAgICAgeTAgPSBwMS55ICsgYSAqIChwMi55IC0gcDEueSkgLyBkLFxuICAgICAgICAgICAgcnggPSAtKHAyLnkgLSBwMS55KSAqIChoIC8gZCksXG4gICAgICAgICAgICByeSA9IC0ocDIueCAtIHAxLngpICogKGggLyBkKTtcblxuICAgICAgICByZXR1cm4gW3sgeDogeDAgKyByeCwgeSA6IHkwIC0gcnkgfSxcbiAgICAgICAgICAgICAgICB7IHg6IHgwIC0gcngsIHkgOiB5MCArIHJ5IH1dO1xuICAgIH07XG5cbiAgICAvKiogUmV0dXJucyB0aGUgY2VudGVyIG9mIGEgYnVuY2ggb2YgcG9pbnRzICovXG4gICAgY2lyY2xlSW50ZXJzZWN0aW9uLmdldENlbnRlciA9IGZ1bmN0aW9uKHBvaW50cykge1xuICAgICAgICB2YXIgY2VudGVyID0geyB4OiAwLCB5OiAwfTtcbiAgICAgICAgZm9yICh2YXIgaSA9MDsgaSA8IHBvaW50cy5sZW5ndGg7ICsraSApIHtcbiAgICAgICAgICAgIGNlbnRlci54ICs9IHBvaW50c1tpXS54O1xuICAgICAgICAgICAgY2VudGVyLnkgKz0gcG9pbnRzW2ldLnk7XG4gICAgICAgIH1cbiAgICAgICAgY2VudGVyLnggLz0gcG9pbnRzLmxlbmd0aDtcbiAgICAgICAgY2VudGVyLnkgLz0gcG9pbnRzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIGNlbnRlcjtcbiAgICB9O1xucmV0dXJuIGNpcmNsZUludGVyc2VjdGlvbjtcbn1cblxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRzID0ge1xuICBsZXQgbWRzID0ge31cbiAgbWRzLmNsYXNzaWMgPSBmdW5jdGlvbihkaXN0YW5jZXMsIGRpbWVuc2lvbnMpIHtcbiAgICBkaW1lbnNpb25zID0gZGltZW5zaW9ucyB8fCAyO1xuXG4gICAgLy8gc3F1YXJlIGRpc3RhbmNlc1xuICAgIHZhciBNID0gbnVtZXJpYy5tdWwoLS41LCBudW1lcmljLnBvdyhkaXN0YW5jZXMsIDIpKTtcblxuICAgIC8vIGRvdWJsZSBjZW50cmUgdGhlIHJvd3MvY29sdW1uc1xuICAgIGZ1bmN0aW9uIG1lYW4oQSkgeyByZXR1cm4gbnVtZXJpYy5kaXYobnVtZXJpYy5hZGQuYXBwbHkobnVsbCwgQSksIEEubGVuZ3RoKTsgfVxuICAgIHZhciByb3dNZWFucyA9IG1lYW4oTSksXG4gICAgICAgIGNvbE1lYW5zID0gbWVhbihudW1lcmljLnRyYW5zcG9zZShNKSksXG4gICAgICAgIHRvdGFsTWVhbiA9IG1lYW4ocm93TWVhbnMpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBNLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGZvciAodmFyIGogPTA7IGogPCBNWzBdLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICBNW2ldW2pdICs9IHRvdGFsTWVhbiAtIHJvd01lYW5zW2ldIC0gY29sTWVhbnNbal07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB0YWtlIHRoZSBTVkQgb2YgdGhlIGRvdWJsZSBjZW50cmVkIG1hdHJpeCwgYW5kIHJldHVybiB0aGVcbiAgICAvLyBwb2ludHMgZnJvbSBpdFxuICAgIHZhciByZXQgPSBudW1lcmljLnN2ZChNKSxcbiAgICAgICAgZWlnZW5WYWx1ZXMgPSBudW1lcmljLnNxcnQocmV0LlMpO1xuICAgIHJldHVybiByZXQuVS5tYXAoZnVuY3Rpb24ocm93KSB7XG4gICAgICAgIHJldHVybiBudW1lcmljLm11bChyb3csIGVpZ2VuVmFsdWVzKS5zcGxpY2UoMCwgZGltZW5zaW9ucyk7XG4gICAgfSk7XG59O1xuICByZXR1cm4gbWRzO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImQzID0gcmVxdWlyZSgnZDNAdjMnKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd2ZW5uRGlhZ3JhbVdpdGhMZWdlbmQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW50ZXJhY3RpdmVBJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2ludGVyYWN0aXZlQicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnRlcmFjdGl2ZU5vdE9yQUInKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../..";
window._ojs.paths.runtimeToRoot = "../../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
{
  "hash": "d867fe1b59a2219412c19204514dbc99",
  "result": {
    "markdown": "\n# Die Post befragen\n\n\n\n![Bayes:Start!](img/Golem_hex.png){width=5%}\n\n\n\n\n## Lernsteuerung\n\n\n### Lernziele\n\nNach Absolvieren des jeweiligen Kapitels sollen folgende Lernziele erreicht sein.\n\nSie k√∂nnen ...\n\n\n- die Post-Verteilung anhand einer Stichprobenverteilung auslesen\n- Fragen nach Wahrscheinlichkeitsanteilen der Post-Verteilung anhand der Stichprobenverteilung beantworten\n- Fragen nach Quantilen anhand der Stichprobenverteilung beantworten\n\n### Ben√∂tigte R-Pakete\n\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n### Begleitvideos\n\n\n- []()\n\n\n## Mit Stichproben die Post-Verteilung zusammenfassen\n\n\n### Zur Erinnerung: Gitterwerte in R berechnen\n\nBerechnen wir mit der Gittermethode (\"Bayes-Box\") die Postverteilung f√ºr den Globusversuch.\n\nDie Gittermethode ist ein Weg, die Posteriori-Verteilung zu berechnen. Die Posteriori-Verteilung birgt viele n√ºtzliche Informationen.\n\nModell: $W=6$ Wasser, $N=9$ W√ºrfen und $k=10$ Gitterwerten,\nalso mit 10 Wasseranteilswerten zwischen 0 und 1. \n\nAbb. @fig-post1 zeigt die resultierende Post-Verteilung.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 10\nn_success <- 6\nn_trials  <- 9\n\nd <-\n  tibble(p_grid = seq(from = 0, to = 1, length.out = n),\n         prior  = 1) %>% \n  mutate(likelihood = dbinom(n_success, \n                             size = n_trials, \n                             prob = p_grid)) %>% \n  mutate(unstand_post = (likelihood * prior),\n         post = unstand_post / sum(unstand_post))\n```\n:::\n\n\n\n\nVoil√†, die Post-Verteilung als Tabelle, auch \"Bayes-Box\" (oder Bayes-Gitter) genannt: s. @tbl-post1.\n\n\n\n\n::: {#tbl-post1 .cell tbl-cap='Postverteilung mit der Gittermethode berechnet'}\n::: {.cell-output-display}\n\\begin{longtable}{rrrrr}\n\\toprule\np\\_grid & prior & likelihood & unstand\\_post & post \\\\ \n\\midrule\n0.00 & 1 & 0.00 & 0.00 & 0.00 \\\\ \n0.11 & 1 & 0.00 & 0.00 & 0.00 \\\\ \n0.22 & 1 & 0.00 & 0.00 & 0.01 \\\\ \n0.33 & 1 & 0.03 & 0.03 & 0.04 \\\\ \n0.44 & 1 & 0.11 & 0.11 & 0.12 \\\\ \n0.56 & 1 & 0.22 & 0.22 & 0.24 \\\\ \n0.67 & 1 & 0.27 & 0.27 & 0.30 \\\\ \n0.78 & 1 & 0.20 & 0.20 & 0.23 \\\\ \n0.89 & 1 & 0.06 & 0.06 & 0.06 \\\\ \n1.00 & 1 & 0.00 & 0.00 & 0.00 \\\\ \n\\bottomrule\n\\end{longtable}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Die Postverteilung f√ºr W=6, N=9, k=10](Post_files/figure-pdf/fig-post1-1.pdf){#fig-post1}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\nViele n√ºtzliche Fragen (und Antworten) leiten sich ab aus Abb. @fig-post1.\n\n\n### Beispiele f√ºr Fragen an die Post-Verteilung\n\n- Mit welcher Wahrscheinlichkeit liegt der Parameter unter einem bestimmten Wert?\n- Mit welcher Wahrscheinlichkeit liegt der Parameter zwischen zwei bestimmten Werten?\n- Mit 5% Wahrscheinlichkeit liegt der Parameterwert nicht unter welchem Wert?\n- Welcher Parameterwert hat die h√∂chste Wahrscheinlichkeit?\n- Wie ungewiss ist das Modell √ºber die Parameterwerte?\n\n\nSolche Fragen kann man in zwei Gruppen aufteilen:\n\n1. Fragen zu Parametern\n3. Fragen zu Wahrscheinlichkeiten\n\n\n### Bayes-Box f√ºr komplexe Modelle\n\nBisher, f√ºr einfache Fragestellungen hat unsere Bayes-Box, das hei√üt die Gittermethode bestens funktioniert: einfach, robust, formsch√∂n^[naja, nicht unbedingt formsch√∂n, aber mir fiel kein dritter Vorzug ein.].\nAllerdings: Funktioniert sie auch bei komplexeren Modellen?\nSchlie√ülich wollen wir ja auch irgendwann Regressionsmodelle berechnen.\nAngenommen, wir haben ein Regressionsmodell mit 1 Pr√§diktor,\ndann haben wir folgende drei Gr√∂√üen^[Modellparameter genannt] zu sch√§tzen: $\\beta_0, \\beta_1, \\sigma$.\nH√∂rt sich gar nicht so viel an. \nAber Moment, wir m√ºssten dann z.B. die Frage beantworten, \nwie wahrscheinlich die Daten aposteriori sind,\nwenn z.B. $\\beta_0 = -3.14$ und $\\beta_1 = 2.71$ und $\\sigma = 0.70$.\nDemnach m√ºssen wir alle Auspr√§gungen (\"Gitterwerte\") der Variablen multiplizieren.\nPuh, das wird eine gro√üe Zahl. \nWenn wir f√ºr die drei Gr√∂√üen jeweils 10 Auspr√§gungen annehmen, was wenig ist,\nk√§men wir $10\\cdot10\\cdot10= 1000=10^3$ Kombinationen.\nBei 100 Auspr√§gungen w√§ren es schon $100^3=10^6$ Kombinationen.\nDas w√§re doch eine recht lange Tabelle.\n\nBei einer multiplen Regression mit sagen wir 10 Pr√§diktoren mit jeweils 100 Auspr√§gungen rechnet das arme R bis zum j√ºngsten Tag: $10^{100}.\nNein, das k√∂nnen wir R nicht zumuten.\nWir brauchen eine andere L√∂sung!\n\n\n### Wir arbeiten jetzt mit H√§ufigkeit, nicht mit Wahrscheinlichkeit\n\nKurz gesagt: Komplexere Bayes-Modelle k√∂nnen nicht mehr \"einfach mal eben\" ausgerechnet werden; die Mathematik wird so umfangreich bzw. zu komplex.\n\nGl√ºcklicherwei√üe gibt es einen Trick, der die Sache nicht nur rechnerisch, sondern auch konzeptionell viel einfacher macht.\n\nDieser Trick lautet: Wir arbeiten nicht mehr mit Wahrscheinlichkeiten, sondern mit *H√§ufigkeiten.*\n\n\nPraktischerweise werden wir in K√ºrze einen R-Golem kennenlernen,\nder das f√ºr uns erledigt. \nDieser Golem liefert uns Stichproben aus der Post-Verteilung zur√ºck.\n\nLernen wir jetzt also, wie man mit solchen Stichproben umgeht.\n\n\n:::callout-important\nDie Post-Verteilung in Stichprobenform ist viel einfach zu handhaben als das direkte Arbeiten mit Wahrscheinlichkeiten. Daher sind viele R-Funktionen f√ºr Bayes auf Stichproben eingestellt.\n:::\n\nDie Grid-Methode ist bei gr√∂√üeren Datens√§tzen (oder gr√∂√üeren Modellen) zu rechenintensiv.\nIn der Praxis werden daher andere, schnellere Verfahren verwendet, sog. Monte-Carlo-Markov-Ketten (MCMC).\nWie diese Verfahren funktionieren sind aber nicht mehr Gegenstand dieses Kurses.\nWir wenden Sie einfach an, freuen uns und lassen es damit gut sein[Eine gute Einf√ºhrung in die Hintergr√ºnde findet sich bei @mcelreath_statistical_2020.]\n\n\n### H√§ufigkeiten sind einfacher als Wahrscheinlichkeiten\n\n\nWie gesagt, typische R-Werkzeuge (\"R-Golems\") liefern uns die Post-Verteilung in Stichprobenform zur√ºck.\n\nBevor wir uns aber mit diesen R-Werkzeugen besch√§ftigen,\nsollten wir uns vertraut machen mit einer Post-Verteilung in Stichprobenform.\n\n\nErstellen wir uns also einen Tabelle mit Stichprobendaten aus der Posteriori-Verteilung (Tabelle `d`), s. @lst-post-sample.\n\n\n\n```{#lst-post-sample .r lst-cap=\"Wir stellen eine Tabelle mit Stichproben aus der Post-Verteilung\"}\nsamples <-\n  d %>%  # nimmt die Tabelle mit Posteriori-Daten,\n  slice_sample(  # Ziehe daraus eine Stichprobe,\n    n = 1e4,  # mit insgesamt n=10000 Zeilen,\n    weight_by = post,  # Gewichte nach Post-Wskt.,\n    replace = T)  %>%  # Ziehe mit Zur√ºcklegen\n  select(p_grid)\n```\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\nDie Wahrscheinlichkeit, einen bestimmten Parameterwert (d.h. aus der Spalte `p_grid`) aus Tabelle `d` zu ziehen, \nist proportional zur Posteriori-Wahrscheinlichkeit (`post`) dieses Werts. \nZiehen mit Zur√ºcklegen h√§lt die Wahrscheinlichkeiten w√§hrend des Ziehens konstant.\nDas Argument `weight_by` legt die Wahrscheinlichkeit fest, mit der eine Zeile gezogen wird.\n\nWir begn√ºgen uns mit der Spalte mit den Wasseranteilswerten (Parameterwerten), `p_grid`, \ndie anderen Spalten brauchen wir nicht.\n\n\nDas Ergebnis, Tabelle `samples`, die aus Stichproben aus der Post-Verteilung besteht, ist (in Ausz√ºgen) in @tbl-postsample1 dargestellt.\n\n\n\n\n::: {#tbl-postsample1 .cell tbl-cap='Die ersten Zeilen der Stichproben aus der Post-Verteilung'}\n::: {.cell-output-display}\n\\begin{longtable}{r}\n\\toprule\np\\_grid \\\\ \n\\midrule\n$0.778$ \\\\ \n$0.444$ \\\\ \n$0.667$ \\\\ \n$0.556$ \\\\ \n$0.556$ \\\\ \n\\bottomrule\n\\end{longtable}\n:::\n:::\n\n\n\n\nWenn Sie jetzt denken: \"Warum machen wir das jetzt? Brauchen wir doch gar nicht!\" - Dann haben Sie Recht.\nK√ºnftig werden wir aber, wenn wir mit komplexeren Modellen zu tun haben, nur noch mit Post-Verteilungen auf Stichprobenbasis arbeiten, weil es damit viel einfacher ist.\n\n\n\n\n\n\nHier erstmal die ersten 100 gesampelten Gitterwerte (`p_grid`):\n\n\n\n::: {.cell}\n\n```\n##   [1] 0.78 0.44 0.67 0.56 0.56 0.67 0.67 0.89 0.44 0.78 0.44 0.56 0.67 0.56 0.56\n##  [16] 0.78 0.67 0.67 0.67 0.44 0.33 0.67 0.56 0.78 0.56 0.78 0.78 0.44 0.78 0.56\n##  [31] 0.56 0.44 0.67 0.56 0.67 0.78 0.44 0.44 0.78 0.78 0.89 0.67 0.56 0.44 0.56\n##  [46] 0.67 0.44 0.78 0.67 0.44 0.78 0.56 0.56 0.56 0.44 0.67 0.22 0.89 0.67 0.44\n##  [61] 0.78 0.67 0.67 0.89 0.56 0.56 0.67 0.67 0.56 0.89 0.78 0.67 0.78 0.78 0.78\n##  [76] 0.56 0.67 0.67 0.67 0.44 0.89 0.56 0.56 0.56 0.67 0.78 0.78 0.67 0.67 0.56\n##  [91] 0.67 0.56 0.56 0.56 0.67 0.78 0.67 0.67 0.67 0.56\n```\n:::\n\n\n\n\n\nWie sieht diese Tabelle wohl als Histogramm^[hier als Balkendiagramm, kommt fast aufs selbe raus, sieht aber etwas sch√∂ner aus in diesem Fall, da er nur wenige Balken sind] aus?\n\n\nSo sieht die Post-Verteilung auf Basis von Stichproben dann aus, s.  @fig-samples1.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Stichprobenverteilung auf Basis von Stichproben](Post_files/figure-pdf/fig-samples1-1.pdf){#fig-samples1}\n:::\n:::\n\n\n\nAus @fig-samples1 k√∂nnen wir einfach auslesen, wie wahrscheinlich gewisse Parameterwerte sind.\nSo sehen wir, dass das Modell Parameterwerte (Wasseranteil, $\\pi$) zwischen ca. 50% und 70% f√ºr am wahrscheinlichsten h√§lt.\nAber auch kleine Anteile wie 25% sind nicht auszuschlie√üen (auf Basis der Daten und der Modellannahmen).\n\nVergleichen Sie  @fig-samples1 mit @fig-gitter: beide sind sehr √§hnlich!\nDas Stichprobenziehen (@fig-samples1) n√§hert sich recht gut an die exakte Berechnung an (@fig-gitter).\n\n\n### Visualisierung der Stichprobendaten mit $k=100$ Gitterwerten\n\n$k=10$ Gitterwerte ist ein grobes Raster.\nDrehen wir mal die Aufl√∂sung auf $k=100$ Gitterwerte (Auspr√§gungen) nach oben.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nk <- 100\nn_success <- 6\nn_trials  <- 9\n\nd_k100 <-\n  tibble(p_grid = seq(from = 0, \n                      to = 1, \n                      length.out = k),  # 100 Gitterwerte\n         prior  = 1) %>% \n  mutate(likelihood = dbinom(n_success, \n                             size = n_trials, \n                             prob = p_grid)) %>% \n  mutate(unstand_post = (likelihood * prior),\n         post = unstand_post / sum(unstand_post))\n```\n:::\n\n\n\n\n\n\n\n$d_k100$ ist eine Bayes-Box mit $W=6, N=9, k=100$.\n\nUnd daraus ziehen wir uns $n=1000$ Stichproben:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples_k100 <-\n  d_k100 %>%  # nimmt die Tabelle mit Posteriori-Daten,\n  slice_sample(  # Ziehe daraus eine Stichprobe,\n    n = 1000,  # mit insgesamt n=1000 Elementen,\n    weight_by = post,  # Gewichte nach Spalte mit Post-Wskt.,\n    replace = T)  # Ziehe mit Zur√ºcklegen\n```\n:::\n\n\n\n\n@fig-post100 zeigt sowohl die exakte Post-Verteilung als auch die Post-Verteilung auf Basis von Stichproben. \nIm mittleren Teildiagramm sind die Stichproben einzeln als Kreis dargestellt.\nIm rechten Teildiagramm sind die gleichen Daten als Dichtediagramm dargestellt.\nIn allen F√§llen erkennt man gut die zentrale Tendenz: ein Wasseranteil von 70% scheint der \"typische\" Wert des Modells zu sein.\nAu√üerdem erkennt man, dass das Modell durchaus einige Streuung in der Sch√§tzung des Wasseranteils bereith√§lt.\nDas Modell ist sich nicht sehr sicher, k√∂nnte man sagen.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Post-Verteilung mit 100 Gitterwerten, exakt vs. auf Basis von Stichproben](Post_files/figure-pdf/fig-post100-1.pdf){#fig-post100}\n:::\n:::\n\n\n\nDie Stichprobendaten n√§hern sich der \"echten\" Posteriori-Verteilung an:\nDie Stichproben-Post-Verteilung hat jetzt \"glattere\" R√§nder.\n\n\n::: callout-note\nMehr Stichproben und mehr Gitterwerte gl√§tten die Verteilung.\n:::\n\nJetzt noch mal mit mehr Stichproben: $n=10^6$ Stichproben bei $k=100$ Gitterwerten aus der Posteriori-Verteilung, s. @fig-post-dk100.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Post-Verteilung mit vielen Stichproben und vielen Parameterwerten (Gitterwerten): sch√∂n 'glatt'. Mittelwert (MW), Modus und Median (Md) liegen eng nebeneinander, da die Verteilung recht symmetrisch ist.](Post_files/figure-pdf/fig-post-dk100-1.pdf){#fig-post-dk100}\n:::\n:::\n\n\n\n\n## Die Post-Verteilung befragen\n\n\n\nSo, jetzt befragen wir die Post-Verteilung.\n\n\n:::callout-important\nDie Post-Verteilung ist das zentrale Ergebnis einer Bayes-Analyse.\nWir k√∂nnen viele n√ºtzliche Fragen an sie stellen.\n:::\n\nEs gibt zwei Arten von Fragen:\n\n1. nach Wahrscheinlichkeiten (p)\n2. nach Parameterwerten (Quantilen, q)\n\n\nDer Unterschied zwischen beiden Arten von Fragen ist in  @fig-p-vs-q illustriert.\n\n![Fragen nach p vs. Fragen nach q](img/p-vs-q.png){#fig-p-vs-q width=\"50%\" fig-align=\"center\"}\n\nIm linken Teildiagramm von @fig-p-vs-q fragen wir: \"Wie wahrscheinlich ist ein Wasseranteil von h√∂chstens 80%?\".\nIm rechten Teildiagramm fragen wir: \"Welcher Wasseranteil wird mit einer Wahrscheinlichkeit von 78% nicht √ºberschritten?\".\n\n\n### Fragen nach Wahrscheinlichkeiten\n\n\n\n\nSagen wir, dass sei unsere Forschungsfrage: *Wie gro√ü ist die Wahrscheinlichkeit, dass der Wasseranteil unter 50% liegt?*\n\n\nUm diese Frage zu beantworten, z√§hlen wir einfach, wie viele Stichproben die Bedingung erf√ºllen:\n\nund und summieren die Wahrscheinlichkeiten dieser Stichproben:\n\n\n\n\n\nWir z√§hlen (`count`) also die Stichproben, die sich f√ºr einen Wasseranteil (`p_grid`) von weniger als 50% aussprechen:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>%\n  count(p_grid < .5) \n## # A tibble: 2 x 2\n##   `p_grid < 0.5`     n\n##   <lgl>          <int>\n## 1 FALSE           8355\n## 2 TRUE            1645\n```\n:::\n\n\n\nDa wir insgesamt 10000 (1e4) Stichproben gezogen haben, k√∂nnen wir noch durch diese Zahl teilen, um einen Anteil zu bekommen.\nDieser Anteil ist die Antwort auf die Forschungsfrage: \nWie Wahrscheinlichkeit (laut Modell) f√ºr einen Wasseranteil kleiner als 50%.^[Der Befehl `count` macht Folgendes: Er gruppiert die Stichprobe nach dem Pr√ºfkriterium, Wasseranteil h√∂chstens 50%. Dann z√§hlt er in jeder der beiden Teiltabelle die Zeilen und liefert diese zwei Zahlen dann zur√ºck. Man k√∂nnte also auch in etwa schreiben:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd %>%\n  filter(p_grid < .5) %>%\n  summarise(sum = sum(post))\n## # A tibble: 1 x 1\n##     sum\n##   <dbl>\n## 1 0.167\n```\n:::\n\n\n\n\nEinfach wie üç∞ essen.\n\n\n\n\n\n:::{#exm-param2}\n\n## Wasseranteil zwischen 50 und 75%?\n\nNoch eine Forschungsfrage: *Mit welcher Wahrscheinlichkeit liegt der Parameter (Wasseranteil) zwischen 0.5 und 0.75?*\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  count(p_grid > .5 & p_grid < .75)\n## # A tibble: 2 x 2\n##   `p_grid > 0.5 & p_grid < 0.75`     n\n##   <lgl>                          <int>\n## 1 FALSE                           4504\n## 2 TRUE                            5496\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  count(p_grid > .5 & p_grid < .75) %>% \n  summarise(Anteil = n / 1e4,\n            Prozent = 100 * n / 1e4)  # In Prozent\n## # A tibble: 2 x 2\n##   Anteil Prozent\n##    <dbl>   <dbl>\n## 1  0.450    45.0\n## 2  0.550    55.0\n```\n:::\n\n\n\nAnteile von `count()` k√∂nnte man, wenn man m√∂chte, auch `filter()` verwenden:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  filter(p_grid > .5 & p_grid < .75) %>% \n  summarise(sum     =       n() / 1e4,\n            anteil = 100 * n() / 1e4)  # In Prozent\n## # A tibble: 1 x 2\n##     sum anteil\n##   <dbl>  <dbl>\n## 1 0.550   55.0\n```\n:::\n\n\n\n\n:::\n\n:::{#exm-param3}\n\n## Wasseranteil zwischen 90 und 100%?\n\nNoch ein Beispiel f√ºr eine Forschungsfrage: Mit welcher Wahrscheinlichkeit liegt der Parameter zwischen 0.9 und 1?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  count(p_grid >= .9 & p_grid <= 1) %>% \n  summarise(prop = 100 * n() / 1e4)  # prop wie \"proportion\", Anteil\n## # A tibble: 1 x 1\n##    prop\n##   <dbl>\n## 1  0.01\n```\n:::\n\n\n\nLaut unserem Modell ist es also sehr unwahrscheinlich, dass der Wasseranteil der Erde mind.  90% betr√§gt.\n\n\n:::\n\n\nWir k√∂nnen auch fragen, welcher Parameterwert am wahrscheinlichsten ist;\ndieser Wert entspricht dem \"Gipfel\" des Berges, s.  @fig-post-dk100.\n\n\nF√ºr unsere Stichproben-Postverteilung, `samples`, s. @fig-samples1, l√§sst sich der Modus so berechnen:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_estimate(samples$p_grid)  \n## MAP Estimate: 0.67\n```\n:::\n\n\n\n\nDabei steht `map` f√ºr [Maximum Aposteriori](https://easystats.github.io/bayestestR/reference/map_estimate.html), also das Maximum der Post-Verteilung.\n\n\nBei der Gelegenheit k√∂nnten wir folgende, √§hnliche Fragen stellen:\n\n- Was ist der mittlere Sch√§tzwert (Mittelwert) zum Wasseranteil laut Post-Verteilung?\n- Was ist der mediane Sch√§tzwert (Median)?\n\n\nAuf Errisch:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  summarise(mean(p_grid),\n            median(p_grid))\n## # A tibble: 1 x 2\n##   `mean(p_grid)` `median(p_grid)`\n##            <dbl>            <dbl>\n## 1          0.636            0.667\n```\n:::\n\n\n\n\n### Fragen nach Parameterwerten\n\n::: callout-important\nSch√§tzbereiche von Parameterwerten nennt man auch *Konfidenz- oder Vertrauensintervall*^[Tats√§chlich gibt es eine Vielzahl an Begriffen, die in der Literatur nicht immer konsistent verwendet werden, etwa Kompatibilit√§tsintervall, Ungewissheitsintervall, Passungsbereich.].\n:::\n\n\n\nWelcher Parameterwert wird mit 90% Wahrscheinlichkeit nicht √ºberschritten, laut unserem Modell? (Gesucht sind also die unteren 90% der Posteriori-Wahrscheinlichkeit)\nWir m√∂chten also ziemlich sicher, was die Obergrenze an Wasser auf diesem Planeten ist^[Vielleicht damit es genug Berge zum Schifahren gibt.].\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  summarise(quantil90 = quantile(p_grid, p = .9))\n## # A tibble: 1 x 1\n##   quantil90\n##       <dbl>\n## 1     0.778\n```\n:::\n\n\n\n\nLaut unserem Modell k√∂nnen wir zu 90% sicher sein, dass der Wasseranteil kleiner ist als ca. 78%.\n\nEs hilft vielleicht, sich die Post-Verteilung noch einmal vor Augen zu f√ºhren, s. fig-post99.\n\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\nsamples %>% \n  ggplot(aes(x = p_grid)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![Die Post-Verteilung im Globusversuch](Post_files/figure-pdf/fig-post99-1.pdf){#fig-post99 fig-pos='H' width=50%}\n:::\n:::\n\n\n\n\n\n\nWas ist das *mittlere* Intervall, das mit 90% Wahrscheinlichkeit den Parameterwert enth√§lt, laut dem Modell?\n\nDaf√ºr \"schneiden\" wir links und rechts die 5% der Stichproben mit den extremsten Werten ab und schauen, bei welchen Parameterwerten wir als Grenzwerte landen:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  summarise(\n    quant_05 = quantile(p_grid, 0.05),\n    quant_95 = quantile(p_grid, 0.95))\n## # A tibble: 1 x 2\n##   quant_05 quant_95\n##      <dbl>    <dbl>\n## 1    0.444    0.889\n```\n:::\n\n\n\n\nSolche Fragen lassen sich also mit Hilfe von *Quantilen* beantworten.\n\n\n\n### Zur Erinnerung: Quantile\n\nBeispiel: Wie gro√ü sind die Studentis ([Quelle des Datensatzes](https://rdrr.io/cran/openintro/man/speed_gender_height.html))? \n\nDas Quantil von z.B. 25% zeigt die K√∂rpergr√∂√üe der 25% kleinsten Studentis an, analog f√ºr 50%, 75%, in Inches^[1 Inch entspricht 2.54cm]:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspeed_gender_height <- read_csv(\"https://raw.githubusercontent.com/rpruim/OpenIntro/master/data/speed_gender_height.csv\")\n\nheight_summary <- \n  speed_gender_height %>% \n  mutate(height_cm = height*2.54) %>% \n  select(height_inch = height, height_cm) %>% \n  drop_na() %>% \n  pivot_longer(everything(), names_to = \"Einheit\", values_to = \"Messwert\") %>% \n  group_by(Einheit) %>% \n  summarise(q25 = quantile(Messwert, prob = .25),\n            q50 = quantile(Messwert, prob = .5),\n            q75 = quantile(Messwert, prob = .75))\n\nheight_summary\n## # A tibble: 2 x 4\n##   Einheit       q25   q50   q75\n##   <chr>       <dbl> <dbl> <dbl>\n## 1 height_cm    160.  168.  175.\n## 2 height_inch   63    66    69\n```\n:::\n\n\n\nDas 25%-Quantil nennt man auch 1. Quartil; das 50%-Quantil (Median) auch 2. Quartil und das 75%-Quantil auch 3. Quartil.\n\n\n@fig-stud-height visualisiert die Quantile und die H√§ufigkeitsverteilung.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Gr√∂√üenverteilung von 1325 amerikanischen Studentis](Post_files/figure-pdf/fig-stud-height-1.pdf){#fig-stud-height}\n:::\n:::\n\n\n\n\n###  Den Quantilen unter die Motorhaube geschaut\n\nDen R-Befehl `quantile()` kann man sich, wenn man will, einfach nachbauen und entmystifizieren.\n\nAngenommen, wir wollen wissen, welcher Wasseranteil mit 90% Wahrscheinlichkeit nicht √ºberschritten wird.\nDas k√∂nnen wir mit im Datensatz `samples` so erreichen.\n\n1. Sortiere die Stichproben aufsteigend.\n2. Schneide die oberen 10% ab.\n3. Schaue, was der gr√∂√üte verbleibende Wert ist.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  arrange(p_grid) %>%   # sortiere\n  slice_head(n = 9000) %>%  # nur die ersten 90000, also die obersten 1000 abschneiden\n  summarise(p90 = max(p_grid))\n## # A tibble: 1 x 1\n##     p90\n##   <dbl>\n## 1 0.778\n```\n:::\n\n\n\n\nDas (ann√§hernd) gleiche Ergebnis liefert `quantile()`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  summarise(q90 = quantile(p_grid, .9))\n## # A tibble: 1 x 1\n##     q90\n##   <dbl>\n## 1 0.778\n```\n:::\n\n\n\n\n### Visualisierung der Intervalle\n\nIntervalle (Bereiche), die die \"abzuschneidende\" Wahrscheinlichkeitsmasse h√§lftig auf die beiden R√§nder aufteilen, nennen wir *Perzentilintervalle* oder *Equal-Tails-Intervalle* (ETI), s. Abb. @fig-eti, rechtes Teildiagramm.\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Perzintilintervalle](Post_files/figure-pdf/fig-eti-1.pdf){#fig-eti}\n:::\n:::\n\n\n\n\n\n## Schiefe Posteriori-Verteilungen sind m√∂glich\n\n\nNoch einmal zum Globusversuch: Gehen wir von 3 W√ºrfen mit 3 Treffern aus; auf welche Wasseranteile (Parameterwerte) werden wir jetzt schlie√üen?\n\nVermutlich ziemlich hohe.\n\nErstellen wir uns dazu mal eine Post-Verteilung (3 Treffer, 3 W√ºrfe):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_33 <- \n  tibble(p_grid = seq(0,1, by =.01),\n         prior = 1) %>% \n  mutate(likelihood = dbinom(3, size = 3, prob = p_grid)) %>% \n  mutate(unstand_post = likelihood * prior) %>% \n  mutate(post_33  = unstand_post / sum(unstand_post)) \n\nsamples_33 <- \n  d_33 %>% \n    slice_sample(n = 1e4, \n                 weight_by = post_33, \n                 replace = T)\n```\n:::\n\n\n\nSo sehen die ersten paar Zeilen der Post-Verteilung, `samples_33`, aus.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\\begin{longtable}{rrrr}\n\\toprule\np\\_grid & prior & likelihood & unstand\\_post \\\\ \n\\midrule\n$0.86$ & 1 & $0.64$ & $0.64$ \\\\ \n$0.96$ & 1 & $0.88$ & $0.88$ \\\\ \n$0.95$ & 1 & $0.86$ & $0.86$ \\\\ \n$0.78$ & 1 & $0.47$ & $0.47$ \\\\ \n$0.66$ & 1 & $0.29$ & $0.29$ \\\\ \n$0.94$ & 1 & $0.83$ & $0.83$ \\\\ \n\\bottomrule\n\\end{longtable}\n:::\n:::\n\n\n\n\nMit dieser \"schiefen\" Post-Verteilung k√∂nnen wir gut die Auswirkungen auf das Perzentil- und das H√∂chste-Dichte-Intervall anschauen.\n\n\n### 50%-Perzentil-Intervall\n\nHier z.B. ein 50%-Perzentilintervall, s. Abb. @fig-schief.\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Schiefe Intervalle](Post_files/figure-pdf/fig-schief-1.pdf){#fig-schief}\n:::\n:::\n\n\n\n\n\n\n\nDie Grenzwerte dieses ETI (oder jedes beliebig breiten) kann man sich z.B. so ausgeben lassen:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(easystats)\n\nsamples_33 %>% \n  select(p_grid) %>% \n  eti(ci = .5)\n## Equal-Tailed Interval\n## \n## Parameter |      50% ETI\n## ------------------------\n## p_grid    | [0.71, 0.93]\n```\n:::\n\n\n\n\n\nDer wahrscheinlichste Parameterwert (1) ist *nicht* im Intervall enthalten.\nDas ist ein Nachteil der ETI.\n\n\n\n\n### 50%-Intervall h√∂chster Dichte\n\nIntervalle h√∂chster Dichte (Highest density Intervals, HDI oder HDPI) sind definiert als die *schm√§lsten* Intervalle, die den gesuchten Parameter enthalten.\n\n\n\n\n\nDer wahrscheinlichste Parameterwert (1) *ist* im Intervall enthalten, was Sinn macht.\nBei einem HDI sind die abgeschnitten R√§nder nicht mehr gleich gro√ü, im Sinne von enthalten nicht (zwangsl√§ufig) die gleiche Wahrscheinlichkeitsmasse. \n\n\nJe symmetrischer die Verteilung, desto n√§her liegen die Punktsch√§tzer aneinander (und umgekehrt), s. Abb. @fig-post-pointestimates.\n\n\n\n\n::: {.cell fig.asp='0.5'}\n::: {.cell-output-display}\n![Visualisierung der Punktsch√§tzer bei einer schiefen Post-Verteilung](Post_files/figure-pdf/fig-post-pointestimates-1.pdf){#fig-post-pointestimates}\n:::\n:::\n\n\n\n\n\n\nSo kann man sich die Grenzwerte eines 50%-HDI ausgeben lassen:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  select(p_grid) %>% \n  bayestestR::hdi(ci = .5)  # aus dem Paket `bayestestR`\n## Highest Density Interval\n## \n## Parameter |      50% HDI\n## ------------------------\n## p_grid    | [0.67, 0.78]\n```\n:::\n\n\n\nDas Modell ist sich also zu 50% sicher, dass der gesuchte Parameter (der Wasseranteil der Erdoberfl√§che) sich in diesem Bereich befindet (auf Basis eines HDI).\n\n\n:::callout-note\nDas R-Paket `{bayestestR}` ist Teil des Meta-Pakets `{easystats}`.\nEs reicht, wenn Sie `easystats` laden, damit wird `bayestestR` automatisch geladen.\n:::\n\n\n## Fazit\n\n\n### Intervalle h√∂chster Dichte vs. Perzentilintervalle\n\n- Bei symmetrischer Posteriori-Verteilung sind beide Intervalle √§hnlich\n- Perzentilintervalle sind verbreiteter\n- *Intervalle h√∂chster Dichte* (Highest Density Interval, HDI) sind bei schiefen Post-Verteilungen zu bevorzugen\n- Intervalle h√∂chster Dichte sind die *schmalsten* Intervalle f√ºr eine gegebene Wahrscheinlichkeitsmasse\n\n\n\n\n### Zusammenfassung\n\nFassen wir zentrale Punkte an einem Beispiel zusammen.\n\nIm Globusversuch, Datendatz `samples`, s. @lst-post-sample. Sagen wir, wir haben 6 Treffer bei 9 W√ºrfen erzielt.\n\n\n\n\nLageparmameter: Welchen mittleren Wasseranteil muss man annehmen?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  summarise(\n    mean   = mean(p_grid),\n    median = median(p_grid))  \n## # A tibble: 1 x 2\n##    mean median\n##   <dbl>  <dbl>\n## 1 0.636  0.667\n```\n:::\n\n\n\nStreuungsparameter: Wie unsicher sind wir in der Sch√§tzung des Wasseranteils?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples %>% \n  summarise(\n    p_sd   = sd(p_grid),\n    p_iqr = IQR(p_grid),\n    p_mad = mad(p_grid))  \n## # A tibble: 1 x 3\n##    p_sd p_iqr p_mad\n##   <dbl> <dbl> <dbl>\n## 1 0.139 0.222 0.165\n```\n:::\n\n\n\nAnstelle der Streuungsparameter ist es aber √ºblicher, ein HDI oder PI anzugeben.\n\n\n\n:::callout-important\nAlles Wasser oder was?\nIm Beispiel dieses Kapitels haben wir unser gefragt, was wohl der Wasseranteil auf dem Planeten Erde ist. \nHalten Sie sich klar vor Augen: Der Wasseranteil ist ein Beispiel f√ºr einen *Parameter*, einer unbekannten Gr√∂√ües eines Modells.\n:::\n\n\n\n\n\n## Aufgaben\n\n\n1. [iq01](https://datenwerk.netlify.app/posts/iq01/iq01.html)\n2. [iq02](https://datenwerk.netlify.app/posts/iq02/iq02.html)\n3. [iq03](https://datenwerk.netlify.app/posts/iq03/iq03.html)\n4. [iq04](https://datenwerk.netlify.app/posts/iq04/iq04.html)\n5. [iq05](https://datenwerk.netlify.app/posts/iq05/iq05.html)\n6. [iq06](https://datenwerk.netlify.app/posts/iq06/iq06.html)\n7. [iq07](https://datenwerk.netlify.app/posts/iq07/iq07.html)\n8. [iq08](https://datenwerk.netlify.app/posts/iq08/iq08.html)\n8. [iq10](https://datenwerk.netlify.app/posts/iq10/iq10.html)\n9. [fattails1](https://datenwerk.netlify.app/posts/fattails01/fattails01.html)\n10. [fattails2](https://datenwerk.netlify.app/posts/fattails02/fattails02.html)\n11. [ReThink3e1-7](https://datenwerk.netlify.app/posts/rethink3e1-7/rethink3e1-7)\n\n\n\n\n\n\n\n\n\n\n\n\n\n## ---\n\n\n\n![](img/outro-06.jpg){width=100%}\n\n\n",
    "supporting": [
      "Post_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"tbl-post1\",\"tbl-post1\",\"tbl-post1\",\"tbl-post1\",\"tbl-postsample1\",\"tbl-postsample1\",\"tbl-postsample1\",\"tbl-postsample1\",\"QM2-Thema3-Post-befragen-14\",\"QM2-Thema3-Post-befragen-14\",\"QM2-Thema3-Post-befragen-14\",\"QM2-Thema3-Post-befragen-14\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"amsmath\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"amsmath\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"amsmath\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}